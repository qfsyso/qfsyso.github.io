<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Node Crawler | MLOG</title>
<meta name=keywords content="Node,Docker"><meta name=description content="Node.js Puppeteer 基于 Node.js + Puppeteer 的自动化帖子采集系统，专门用于采集资产版块的帖子信息。
核心代码
//app.js const express = require('express'); const cors = require('cors'); const helmet = require('helmet'); const path = require('path'); const logger = require('./utils/logger'); const CrawlerService = require('./services/CrawlerService'); const SchedulerService = require('./services/SchedulerService'); const PostController = require('./controllers/PostController'); class App { constructor() { this.app = express(); this.port = process.env.PORT || 3000; this.crawlerService = new CrawlerService(); this.schedulerService = new SchedulerService(this.crawlerService); this.postController = new PostController(this.crawlerService); this.initializeMiddlewares(); this.initializeRoutes(); this.initializeErrorHandling(); } initializeMiddlewares() { // 安全中间件 this."><meta name=author content="dwd"><link rel=canonical href=https://qfsyso.github.io/posts/node-crawler/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://qfsyso.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://qfsyso.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://qfsyso.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://qfsyso.github.io/apple-touch-icon.png><link rel=mask-icon href=https://qfsyso.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://qfsyso.github.io/posts/node-crawler/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://qfsyso.github.io/posts/node-crawler/"><meta property="og:site_name" content="MLOG"><meta property="og:title" content="Node Crawler"><meta property="og:description" content="Node.js Puppeteer 基于 Node.js + Puppeteer 的自动化帖子采集系统，专门用于采集资产版块的帖子信息。
核心代码
//app.js const express = require('express'); const cors = require('cors'); const helmet = require('helmet'); const path = require('path'); const logger = require('./utils/logger'); const CrawlerService = require('./services/CrawlerService'); const SchedulerService = require('./services/SchedulerService'); const PostController = require('./controllers/PostController'); class App { constructor() { this.app = express(); this.port = process.env.PORT || 3000; this.crawlerService = new CrawlerService(); this.schedulerService = new SchedulerService(this.crawlerService); this.postController = new PostController(this.crawlerService); this.initializeMiddlewares(); this.initializeRoutes(); this.initializeErrorHandling(); } initializeMiddlewares() { // 安全中间件 this."><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-22T22:09:55+08:00"><meta property="article:modified_time" content="2025-08-22T22:09:55+08:00"><meta property="article:tag" content="Node"><meta property="article:tag" content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:title content="Node Crawler"><meta name=twitter:description content="Node.js Puppeteer 基于 Node.js + Puppeteer 的自动化帖子采集系统，专门用于采集资产版块的帖子信息。
核心代码
//app.js const express = require('express'); const cors = require('cors'); const helmet = require('helmet'); const path = require('path'); const logger = require('./utils/logger'); const CrawlerService = require('./services/CrawlerService'); const SchedulerService = require('./services/SchedulerService'); const PostController = require('./controllers/PostController'); class App { constructor() { this.app = express(); this.port = process.env.PORT || 3000; this.crawlerService = new CrawlerService(); this.schedulerService = new SchedulerService(this.crawlerService); this.postController = new PostController(this.crawlerService); this.initializeMiddlewares(); this.initializeRoutes(); this.initializeErrorHandling(); } initializeMiddlewares() { // 安全中间件 this."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://qfsyso.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Node Crawler","item":"https://qfsyso.github.io/posts/node-crawler/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Node Crawler","name":"Node Crawler","description":"Node.js Puppeteer 基于 Node.js + Puppeteer 的自动化帖子采集系统，专门用于采集资产版块的帖子信息。\n核心代码\n//app.js const express = require(\u0026#39;express\u0026#39;); const cors = require(\u0026#39;cors\u0026#39;); const helmet = require(\u0026#39;helmet\u0026#39;); const path = require(\u0026#39;path\u0026#39;); const logger = require(\u0026#39;./utils/logger\u0026#39;); const CrawlerService = require(\u0026#39;./services/CrawlerService\u0026#39;); const SchedulerService = require(\u0026#39;./services/SchedulerService\u0026#39;); const PostController = require(\u0026#39;./controllers/PostController\u0026#39;); class App { constructor() { this.app = express(); this.port = process.env.PORT || 3000; this.crawlerService = new CrawlerService(); this.schedulerService = new SchedulerService(this.crawlerService); this.postController = new PostController(this.crawlerService); this.initializeMiddlewares(); this.initializeRoutes(); this.initializeErrorHandling(); } initializeMiddlewares() { // 安全中间件 this.","keywords":["Node","Docker"],"articleBody":"Node.js Puppeteer 基于 Node.js + Puppeteer 的自动化帖子采集系统，专门用于采集资产版块的帖子信息。\n核心代码\n//app.js const express = require('express'); const cors = require('cors'); const helmet = require('helmet'); const path = require('path'); const logger = require('./utils/logger'); const CrawlerService = require('./services/CrawlerService'); const SchedulerService = require('./services/SchedulerService'); const PostController = require('./controllers/PostController'); class App { constructor() { this.app = express(); this.port = process.env.PORT || 3000; this.crawlerService = new CrawlerService(); this.schedulerService = new SchedulerService(this.crawlerService); this.postController = new PostController(this.crawlerService); this.initializeMiddlewares(); this.initializeRoutes(); this.initializeErrorHandling(); } initializeMiddlewares() { // 安全中间件 this.app.use(helmet({ contentSecurityPolicy: false // 允许内联样式和脚本 })); // CORS支持 this.app.use(cors()); // JSON解析 this.app.use(express.json()); // 静态文件服务 this.app.use(express.static(path.join(__dirname, '../public'))); // 请求日志 this.app.use((req, res, next) =\u003e { logger.info(`${req.method} ${req.path} - ${req.ip}`); next(); }); } initializeRoutes() { // API路由 this.app.get('/api/posts', this.postController.getPosts.bind(this.postController)); this.app.post('/api/crawl', this.postController.triggerCrawl.bind(this.postController)); this.app.get('/api/status', this.postController.getStatus.bind(this.postController)); this.app.get('/api/stats', this.postController.getStats.bind(this.postController)); // 前端页面 this.app.get('/', (req, res) =\u003e { res.sendFile(path.join(__dirname, '../public/index.html')); }); // 健康检查 this.app.get('/health', (req, res) =\u003e { res.json({ status: 'ok', timestamp: new Date().toISOString(), uptime: process.uptime() }); }); } initializeErrorHandling() { // 404处理 this.app.use((req, res) =\u003e { res.status(404).json({ error: 'Not Found' }); }); // 全局错误处理 this.app.use((error, req, res, next) =\u003e { logger.error('Unhandled error:', error); res.status(500).json({ error: 'Internal Server Error', message: process.env.NODE_ENV === 'development' ? error.message : 'Something went wrong' }); }); } async start() { try { // 启动定时任务 this.schedulerService.start(); // 启动服务器 this.app.listen(this.port, () =\u003e { logger.info(` 服务器启动成功！`); logger.info(` 前端页面: http://localhost:${this.port}`); logger.info(` API接口: http://localhost:${this.port}/api/posts`); logger.info(` 定时任务: 每30分钟自动采集一次`); }); // 执行初始采集 setTimeout(() =\u003e { logger.info(' 执行初始采集...'); this.crawlerService.crawlPosts().catch(error =\u003e { logger.error('初始采集失败:', error); }); }, 2000); } catch (error) { logger.error('应用启动失败:', error); process.exit(1); } } async stop() { logger.info('正在关闭应用...'); this.schedulerService.stop(); await this.crawlerService.close(); process.exit(0); } } // 创建应用实例 const app = new App(); // 优雅关闭 process.on('SIGINT', () =\u003e app.stop()); process.on('SIGTERM', () =\u003e app.stop()); // 启动应用 app.start(); module.exports = App; //CrawlerService.js const puppeteer = require('puppeteer'); const fs = require('fs').promises; const path = require('path'); const logger = require('../utils/logger'); const PostModel = require('../models/PostModel'); class CrawlerService { constructor() { this.browser = null; this.page = null; this.postModel = new PostModel(); this.isRunning = false; this.lastCrawlTime = null; this.lastResult = null; this.error = null; } async initBrowser() { if (this.browser) { return; } try { logger.info(' 初始化浏览器...'); this.browser = await puppeteer.launch({ headless: 'new', args: [ '--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage', '--disable-blink-features=AutomationControlled', '--disable-features=VizDisplayCompositor', '--disable-extensions', '--no-first-run', '--disable-default-apps', '--disable-background-timer-throttling', '--disable-backgrounding-occluded-windows', '--disable-renderer-backgrounding', '--window-size=1920,1080' ], defaultViewport: { width: 1920, height: 1080 } }); this.page = await this.browser.newPage(); // 设置用户代理和请求头 await this.page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'); await this.page.setExtraHTTPHeaders({ 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8', 'Accept-Encoding': 'gzip, deflate, br', 'DNT': '1', 'Connection': 'keep-alive', 'Upgrade-Insecure-Requests': '1', }); // 移除webdriver标识 await this.page.evaluateOnNewDocument(() =\u003e { Object.defineProperty(navigator, 'webdriver', { get: () =\u003e undefined, }); Object.defineProperty(navigator, 'plugins', { get: () =\u003e [1, 2, 3, 4, 5], }); Object.defineProperty(navigator, 'languages', { get: () =\u003e ['zh-CN', 'zh', 'en'], }); window.chrome = { runtime: {} }; }); logger.info('✅ 浏览器初始化成功'); } catch (error) { logger.error('❌ 浏览器初始化失败:', error); throw error; } } async crawlPosts() { if (this.isRunning) { logger.warn(' 采集任务已在运行中，跳过本次执行'); return this.lastResult; } this.isRunning = true; this.error = null; try { logger.info(' 开始采集帖子...'); await this.initBrowser(); const urls = [ 'https://linux.do/c/resource/cloud-asset/94', 'https://linux.do/c/resource/cloud-asset/94.json' ]; let posts = []; for (const url of urls) { try { logger.info(` 尝试访问: ${url}`); await this.page.goto(url, { waitUntil: 'domcontentloaded', timeout: 30000 }); // 等待页面加载 await this.page.waitForTimeout(5000); const pageTitle = await this.page.title(); logger.info(` 页面标题: ${pageTitle}`); // 检查页面是否正常加载 if (!pageTitle.includes('请稍候') \u0026\u0026 !pageTitle.includes('Loading')) { posts = await this.extractPosts(); if (posts.length \u003e 0) { logger.info(` 从 ${url} 获取到 ${posts.length} 个帖子`); break; } } // 保存调试截图 const screenshotPath = path.join(__dirname, '../../debug', `debug_${Date.now()}.png`); await this.ensureDirectoryExists(path.dirname(screenshotPath)); await this.page.screenshot({ path: screenshotPath }); } catch (error) { logger.error(` 访问 ${url} 失败:`, error.message); continue; } } // 如果还是没有获取到帖子，尝试用户行为模拟 if (posts.length === 0) { logger.info(' 尝试用户行为模拟...'); posts = await this.simulateUserBehavior(); } // 处理采集结果 const result = await this.processCrawlResult(posts); this.lastResult = result; this.lastCrawlTime = new Date().toISOString(); logger.info(` 采集完成: 发现 ${result.total} 个帖子，新增 ${result.new} 个`); return result; } catch (error) { this.error = error.message; logger.error(' 采集失败:', error); throw error; } finally { this.isRunning = false; } } async extractPosts() { return await this.page.evaluate(() =\u003e { const posts = []; // 多种选择器策略 const selectors = [ '.topic-list-item .main-link a.title', '.topic-list tbody tr .main-link a', 'a.title', '.topic-title a', 'a[href*=\"/t/\"]', '.topic-list-body .topic-list-item a', '.ember-view a[href*=\"/t/\"]' ]; for (const selector of selectors) { const elements = document.querySelectorAll(selector); if (elements.length \u003e 0) { console.log(`使用选择器 \"${selector}\" 找到 ${elements.length} 个元素`); elements.forEach(element =\u003e { const title = element.textContent?.trim() || element.getAttribute('title')?.trim(); const href = element.getAttribute('href'); if (title \u0026\u0026 href \u0026\u0026 title.length \u003e 3 \u0026\u0026 href.includes('/t/')) { let fullLink = href; if (href.startsWith('/')) { fullLink = 'https://linux.do' + href; } // 过滤无效链接 if (!title.includes('回复') \u0026\u0026 !title.includes('查看') \u0026\u0026 !title.includes('更多') \u0026\u0026 !href.includes('#')) { if (!posts.some(p =\u003e p.link === fullLink)) { posts.push({ title: title, link: fullLink }); } } } }); if (posts.length \u003e 0) { break; } } } return posts; }); } async simulateUserBehavior() { try { logger.info(' 模拟用户行为访问云资产版块...'); // 直接访问云资产版块 await this.page.goto('https://xxx.xx/c/xx/cloud-asset/94', { waitUntil: 'domcontentloaded', timeout: 30000 }); // 等待页面加载 await this.page.waitForTimeout(8000); // 尝试滚动页面加载更多内容 await this.page.evaluate(() =\u003e { window.scrollTo(0, document.body.scrollHeight); }); await this.page.waitForTimeout(3000); await this.page.evaluate(() =\u003e { window.scrollTo(0, 0); }); await this.page.waitForTimeout(2000); const posts = await this.extractPosts(); if (posts.length \u003e 0) { logger.info(`✅ 通过用户行为模拟从云资产版块获取到 ${posts.length} 个帖子`); } return posts; } catch (error) { logger.error('❌ 用户行为模拟失败:', error); return []; } } async processCrawlResult(posts) { if (posts.length === 0) { return { total: 0, new: 0, posts: [] }; } // 添加时间戳 const postsWithTime = posts.map(post =\u003e ({ ...post, created_at: new Date().toISOString(), id: this.generateId(post.link) })); // 保存到数据模型 const newCount = await this.postModel.savePosts(postsWithTime); return { total: postsWithTime.length, new: newCount, posts: postsWithTime }; } generateId(link) { // 从链接中提取ID或生成唯一ID const match = link.match(/\\/t\\/[^\\/]+\\/(\\d+)/); return match ? match[1] : Date.now().toString(); } async ensureDirectoryExists(dir) { try { await fs.access(dir); } catch { await fs.mkdir(dir, { recursive: true }); } } getStatus() { return { isRunning: this.isRunning, lastCrawlTime: this.lastCrawlTime, lastResult: this.lastResult, error: this.error }; } async close() { if (this.browser) { await this.browser.close(); this.browser = null; this.page = null; logger.info(' 浏览器已关闭'); } } } module.exports = CrawlerService; //PostModel.js const fs = require('fs').promises; const path = require('path'); const logger = require('../utils/logger'); class PostModel { constructor() { this.dataFile = path.join(__dirname, '../../data/posts.json'); this.existingPosts = new Set(); this.posts = []; this.init(); } async init() { try { await this.ensureDataDirectory(); await this.loadPosts(); } catch (error) { logger.error('PostModel初始化失败:', error); } } async ensureDataDirectory() { const dataDir = path.dirname(this.dataFile); try { await fs.access(dataDir); } catch { await fs.mkdir(dataDir, { recursive: true }); } } async loadPosts() { try { const data = await fs.readFile(this.dataFile, 'utf8'); this.posts = JSON.parse(data); // 构建已存在帖子的集合 this.existingPosts.clear(); this.posts.forEach(post =\u003e { this.existingPosts.add(post.link); }); logger.info(`📚 已加载 ${this.posts.length} 个已存在的帖子`); } catch (error) { if (error.code === 'ENOENT') { logger.info('📝 数据文件不存在，将创建新文件'); this.posts = []; } else { logger.error('加载帖子数据失败:', error); this.posts = []; } } } async savePosts(newPosts) { try { // 过滤出真正的新帖子 const uniqueNewPosts = newPosts.filter(post =\u003e !this.existingPosts.has(post.link)); if (uniqueNewPosts.length === 0) { logger.info('📝 没有新帖子需要保存'); return 0; } // 添加到现有帖子列表 this.posts.unshift(...uniqueNewPosts); // 按时间排序（最新的在前面） this.posts.sort((a, b) =\u003e new Date(b.created_at) - new Date(a.created_at)); // 限制最大数量（可选，防止文件过大） const maxPosts = 1000; if (this.posts.length \u003e maxPosts) { this.posts = this.posts.slice(0, maxPosts); } // 保存到文件 await fs.writeFile(this.dataFile, JSON.stringify(this.posts, null, 2), 'utf8'); // 更新已存在帖子集合 uniqueNewPosts.forEach(post =\u003e { this.existingPosts.add(post.link); }); logger.info(`💾 保存了 ${uniqueNewPosts.length} 个新帖子，总计 ${this.posts.length} 个帖子`); return uniqueNewPosts.length; } catch (error) { logger.error('保存帖子失败:', error); throw error; } } getPosts(page = 1, pageSize = 10) { const offset = (page - 1) * pageSize; const paginatedPosts = this.posts.slice(offset, offset + pageSize); return { posts: paginatedPosts, total: this.posts.length, page: page, pageSize: pageSize, totalPages: Math.ceil(this.posts.length / pageSize) }; } getStats() { const now = new Date(); const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); const yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000); const thisWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000); const todayPosts = this.posts.filter(post =\u003e new Date(post.created_at) \u003e= today).length; const yesterdayPosts = this.posts.filter(post =\u003e { const postDate = new Date(post.created_at); return postDate \u003e= yesterday \u0026\u0026 postDate \u003c today; }).length; const thisWeekPosts = this.posts.filter(post =\u003e new Date(post.created_at) \u003e= thisWeek).length; return { total: this.posts.length, today: todayPosts, yesterday: yesterdayPosts, thisWeek: thisWeekPosts }; } searchPosts(keyword, page = 1, pageSize = 10) { const filteredPosts = this.posts.filter(post =\u003e post.title.toLowerCase().includes(keyword.toLowerCase()) ); const offset = (page - 1) * pageSize; const paginatedPosts = filteredPosts.slice(offset, offset + pageSize); return { posts: paginatedPosts, total: filteredPosts.length, page: page, pageSize: pageSize, totalPages: Math.ceil(filteredPosts.length / pageSize), keyword: keyword }; } } module.exports = PostModel; 功能特性 ✅ 自动采集: 每30分钟自动采集最新帖子 ✅ 智能去重: 自动过滤重复帖子 ✅ 反爬虫绕过: 使用 Puppeteer 模拟真实浏览器行为 ✅ 分页展示: 支持分页浏览大量帖子数据 ✅ 搜索功能: 支持按标题关键词搜索帖子 ✅ 实时状态: 显示采集状态和统计信息 ✅ 响应式设计: 支持移动端访问 ✅ 日志记录: 完整的日志记录和错误追踪 项目结构 nodejs-crawler/ ├── src/ # 源代码目录 │ ├── app.js # 应用入口文件 │ ├── controllers/ # 控制器层 │ │ └── PostController.js # 帖子相关API控制器 │ ├── models/ # 数据模型层 │ │ └── PostModel.js # 帖子数据模型 │ ├── services/ # 服务层 │ │ ├── CrawlerService.js # 爬虫服务 │ │ └── SchedulerService.js # 定时任务服务 │ └── utils/ # 工具类 │ └── logger.js # 日志工具 ├── public/ # 静态文件目录 │ └── index.html # 前端页面 ├── data/ # 数据存储目录 │ └── posts.json # 帖子数据文件 ├── logs/ # 日志文件目录 │ ├── app.log # 应用日志 │ └── error.log # 错误日志 ├── debug/ # 调试文件目录 │ └── *.png # 调试截图 ├── package.json # 项目配置文件 └── README.md # 项目说明文档 技术栈 后端技术 Node.js: JavaScript 运行环境 Express.js: Web 应用框架 Puppeteer: 无头浏览器自动化 Winston: 日志记录 node-cron: 定时任务调度 Helmet: 安全中间件 前端技术 HTML5/CSS3: 页面结构和样式 JavaScript: 交互逻辑 Fetch API: 数据请求 响应式设计: 移动端适配 安装部署 环境要求 Node.js \u003e= 16.0.0 npm \u003e= 7.0.0 安装步骤 克隆项目 git clone cd nodejs-crawler 安装依赖 npm install 启动应用 # 生产环境 npm start # 开发环境（需要安装 nodemon） npm run dev 访问应用 前端页面: http://localhost:3000 API接口: http://localhost:3000/api/posts 健康检查: http://localhost:3000/health 🔧 API 接口 获取帖子列表 GET /api/posts?page=1\u0026pageSize=10\u0026keyword=搜索关键词 参数说明:\npage: 页码（默认1） pageSize: 每页数量（默认10，最大100） keyword: 搜索关键词（可选） 返回示例:\n{ \"success\": true, \"data\": { \"posts\": [...], \"total\": 100, \"page\": 1, \"pageSize\": 10, \"totalPages\": 10 } } 手动触发采集 POST /api/crawl 获取采集状态 GET /api/status 获取统计信息 GET /api/stats ⚙️ 配置说明 环境变量 PORT: 服务端口（默认3000） NODE_ENV: 运行环境（development/production） LOG_LEVEL: 日志级别（debug/info/warn/error） 定时任务 默认每30分钟执行一次采集 可在 src/services/SchedulerService.js 中修改 cron 表达式 数据存储 使用 JSON 文件存储帖子数据 数据文件位置: data/posts.json 自动创建备份和日志轮转 故障排除 常见问题 采集失败\n检查网络连接 查看 logs/error.log 错误日志 检查目标网站是否可访问 端口占用\n修改环境变量 PORT 或停止占用端口的其他程序 权限问题\n确保有读写 data/ 和 logs/ 目录的权限 Linux/Mac 下可能需要 chmod 设置权限 调试模式 # 启用调试日志 LOG_LEVEL=debug npm start 开发说明 添加新功能 在对应的服务类中添加业务逻辑 在控制器中添加 API 接口 在前端页面中添加交互功能 代码规范 使用 ES6+ 语法 遵循 MVC 架构模式 添加适当的错误处理和日志记录 Docker Dockerfile\n# 使用官方 Node.js 18 LTS 镜像作为基础镜像 FROM node:18-slim # 设置工作目录 WORKDIR /app # 安装系统依赖（Puppeteer 需要的库） RUN apt-get update \u0026\u0026 apt-get install -y \\ wget \\ gnupg \\ ca-certificates \\ procps \\ libxss1 \\ libgconf-2-4 \\ libxrandr2 \\ libasound2 \\ libpangocairo-1.0-0 \\ libatk1.0-0 \\ libcairo-gobject2 \\ libgtk-3-0 \\ libgdk-pixbuf2.0-0 \\ libxcomposite1 \\ libxcursor1 \\ libxdamage1 \\ libxi6 \\ libxtst6 \\ libnss3 \\ libcups2 \\ libxss1 \\ libxrandr2 \\ libasound2 \\ libpangocairo-1.0-0 \\ libatk1.0-0 \\ libcairo-gobject2 \\ libdrm2 \\ libxkbcommon0 \\ libatspi2.0-0 \\ fonts-liberation \\ libappindicator3-1 \\ libasound2 \\ libatk-bridge2.0-0 \\ libdrm2 \\ libgtk-3-0 \\ libnspr4 \\ libnss3 \\ libx11-xcb1 \\ libxcomposite1 \\ libxdamage1 \\ libxrandr2 \\ xdg-utils \\ \u0026\u0026 rm -rf /var/lib/apt/lists/* # 复制 package.json 和 package-lock.json COPY package*.json ./ # 安装 Node.js 依赖 RUN npm ci --only=production # 复制应用代码 COPY . . # 创建必要的目录 RUN mkdir -p data logs debug # 设置权限 RUN chmod -R 755 /app # 暴露端口 EXPOSE 3000 # 设置环境变量 ENV NODE_ENV=production ENV PORT=3000 # 健康检查 HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\ CMD curl -f http://localhost:3000/api/status || exit 1 # 启动应用 CMD [\"npm\", \"start\"] docker-compose.yml\nversion: '3.8' services: linux-do-crawler: build: . container_name: linux-do-crawler restart: unless-stopped ports: - \"3000:3000\" environment: - NODE_ENV=production - PORT=3000 volumes: # 持久化数据目录 - ./data:/app/data # 持久化日志目录 - ./logs:/app/logs # 持久化调试截图目录 - ./debug:/app/debug networks: - crawler-network healthcheck: test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:3000/api/status\"] interval: 30s timeout: 10s retries: 3 start_period: 40s networks: crawler-network: driver: bridge 🚀 快速部署 方法一：一键部署脚本 复制项目文件到 Debian 系统 # 将整个 nodejs-crawler 目录复制到 Debian 系统 scp -r nodejs-crawler/ user@your-server:/home/user/ 运行一键部署脚本 cd nodejs-crawler chmod +x deploy.sh ./deploy.sh 脚本会自动完成：\n✅ 检查系统环境 ✅ 更新系统包 ✅ 安装 Docker 和 Docker Compose ✅ 构建镜像并启动服务 方法二：手动部署 # 添加执行权限 sudo chmod +x /usr/local/bin/docker-compose # 验证安装 docker-compose --version 部署应用\n进入项目目录 cd nodejs-crawler\n构建镜像 docker-compose build\n启动服务 docker-compose up -d\n## 📋 文件说明 ### Dockerfile - 基于 Node.js 18 LTS 镜像 - 安装 Puppeteer 所需的系统依赖 - 配置健康检查 - 暴露 3000 端口 ### docker-compose.yml - 定义服务配置 - 配置端口映射 (3000:3000) - 挂载数据持久化目录 - 设置健康检查和重启策略 ### .dockerignore - 排除不必要的文件 - 减小镜像体积 - 提高构建速度 ## 🔧 配置说明 ### 环境变量 ```yaml environment: - NODE_ENV=production - PORT=3000 数据持久化 volumes: - ./data:/app/data # 帖子数据 - ./logs:/app/logs # 日志文件 - ./debug:/app/debug # 调试截图 端口映射 ports: - \"3000:3000\" # 主机端口:容器端口 📊 监控和维护 健康检查 容器配置了健康检查，会定期检查 /api/status 端点：\n# 查看健康状态 docker-compose ps 日志管理 # 查看应用日志 docker-compose logs -f --tail=100 # 查看系统日志 sudo journalctl -u docker.service -f 数据备份 # 备份数据目录 tar -czf backup-$(date +%Y%m%d).tar.gz data/ logs/ # 恢复数据 tar -xzf backup-20250821.tar.gz 注意: 请确保服务器有足够的资源（至少 1GB RAM）和网络连接来运行 Puppeteer。\n","wordCount":"2044","inLanguage":"en","datePublished":"2025-08-22T22:09:55+08:00","dateModified":"2025-08-22T22:09:55+08:00","author":{"@type":"Person","name":"dwd"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://qfsyso.github.io/posts/node-crawler/"},"publisher":{"@type":"Organization","name":"MLOG","logo":{"@type":"ImageObject","url":"https://qfsyso.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://qfsyso.github.io/ accesskey=h title="MLOG (Alt + H)">MLOG</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://qfsyso.github.io/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://qfsyso.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://qfsyso.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Node Crawler</h1><div class=post-meta><span title='2025-08-22 22:09:55 +0800 +0800'>August 22, 2025</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;dwd</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#nodejs---puppeteer aria-label="Node.js   Puppeteer">Node.js Puppeteer</a><ul><li><a href=#%e5%8a%9f%e8%83%bd%e7%89%b9%e6%80%a7 aria-label=功能特性>功能特性</a></li><li><a href=#%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84 aria-label=项目结构>项目结构</a></li><li><a href=#%e6%8a%80%e6%9c%af%e6%a0%88 aria-label=技术栈>技术栈</a><ul><li><a href=#%e5%90%8e%e7%ab%af%e6%8a%80%e6%9c%af aria-label=后端技术>后端技术</a></li><li><a href=#%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af aria-label=前端技术>前端技术</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85%e9%83%a8%e7%bd%b2 aria-label=安装部署>安装部署</a><ul><li><a href=#%e7%8e%af%e5%a2%83%e8%a6%81%e6%b1%82 aria-label=环境要求>环境要求</a></li><li><a href=#%e5%ae%89%e8%a3%85%e6%ad%a5%e9%aa%a4 aria-label=安装步骤>安装步骤</a></li></ul></li><li><a href=#-api-%e6%8e%a5%e5%8f%a3 aria-label="🔧 API 接口">🔧 API 接口</a><ul><li><a href=#%e8%8e%b7%e5%8f%96%e5%b8%96%e5%ad%90%e5%88%97%e8%a1%a8 aria-label=获取帖子列表>获取帖子列表</a></li><li><a href=#%e6%89%8b%e5%8a%a8%e8%a7%a6%e5%8f%91%e9%87%87%e9%9b%86 aria-label=手动触发采集>手动触发采集</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e9%87%87%e9%9b%86%e7%8a%b6%e6%80%81 aria-label=获取采集状态>获取采集状态</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e7%bb%9f%e8%ae%a1%e4%bf%a1%e6%81%af aria-label=获取统计信息>获取统计信息</a></li></ul></li><li><a href=#-%e9%85%8d%e7%bd%ae%e8%af%b4%e6%98%8e aria-label="⚙️ 配置说明">⚙️ 配置说明</a><ul><li><a href=#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f aria-label=环境变量>环境变量</a></li><li><a href=#%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1 aria-label=定时任务>定时任务</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8 aria-label=数据存储>数据存储</a></li></ul></li><li><a href=#%e6%95%85%e9%9a%9c%e6%8e%92%e9%99%a4 aria-label=故障排除>故障排除</a><ul><li><a href=#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98 aria-label=常见问题>常见问题</a></li><li><a href=#%e8%b0%83%e8%af%95%e6%a8%a1%e5%bc%8f aria-label=调试模式>调试模式</a></li></ul></li><li><a href=#%e5%bc%80%e5%8f%91%e8%af%b4%e6%98%8e aria-label=开发说明>开发说明</a><ul><li><a href=#%e6%b7%bb%e5%8a%a0%e6%96%b0%e5%8a%9f%e8%83%bd aria-label=添加新功能>添加新功能</a></li><li><a href=#%e4%bb%a3%e7%a0%81%e8%a7%84%e8%8c%83 aria-label=代码规范>代码规范</a></li></ul></li></ul></li><li><a href=#docker aria-label=Docker>Docker</a><ul><li><a href=#-%e5%bf%ab%e9%80%9f%e9%83%a8%e7%bd%b2 aria-label="🚀 快速部署">🚀 快速部署</a><ul><li><a href=#%e6%96%b9%e6%b3%95%e4%b8%80%e4%b8%80%e9%94%ae%e9%83%a8%e7%bd%b2%e8%84%9a%e6%9c%ac aria-label=方法一：一键部署脚本>方法一：一键部署脚本</a></li><li><a href=#%e6%96%b9%e6%b3%95%e4%ba%8c%e6%89%8b%e5%8a%a8%e9%83%a8%e7%bd%b2 aria-label=方法二：手动部署>方法二：手动部署</a></li></ul></li></ul></li><li><a href=#%e8%bf%9b%e5%85%a5%e9%a1%b9%e7%9b%ae%e7%9b%ae%e5%bd%95 aria-label=进入项目目录>进入项目目录</a></li><li><a href=#%e6%9e%84%e5%bb%ba%e9%95%9c%e5%83%8f aria-label=构建镜像>构建镜像</a></li><li><a href=#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1 aria-label=启动服务>启动服务</a><ul><ul><li><a href=#%e6%95%b0%e6%8d%ae%e6%8c%81%e4%b9%85%e5%8c%96 aria-label=数据持久化>数据持久化</a></li><li><a href=#%e7%ab%af%e5%8f%a3%e6%98%a0%e5%b0%84 aria-label=端口映射>端口映射</a></li></ul><li><a href=#-%e7%9b%91%e6%8e%a7%e5%92%8c%e7%bb%b4%e6%8a%a4 aria-label="📊 监控和维护">📊 监控和维护</a><ul><li><a href=#%e5%81%a5%e5%ba%b7%e6%a3%80%e6%9f%a5 aria-label=健康检查>健康检查</a></li><li><a href=#%e6%97%a5%e5%bf%97%e7%ae%a1%e7%90%86 aria-label=日志管理>日志管理</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e5%a4%87%e4%bb%bd aria-label=数据备份>数据备份</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=nodejs---puppeteer>Node.js Puppeteer<a hidden class=anchor aria-hidden=true href=#nodejs---puppeteer>#</a></h1><p>基于 Node.js + Puppeteer 的自动化帖子采集系统，专门用于采集资产版块的帖子信息。</p><p>核心代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>//app.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;express&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cors</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;cors&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>helmet</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;helmet&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;path&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>logger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./utils/logger&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CrawlerService</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./services/CrawlerService&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SchedulerService</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./services/SchedulerService&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PostController</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./controllers/PostController&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>port</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>PORT</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>3000</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>crawlerService</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CrawlerService</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>schedulerService</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SchedulerService</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>crawlerService</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PostController</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>crawlerService</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>initializeMiddlewares</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>initializeRoutes</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>initializeErrorHandling</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>initializeMiddlewares</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 安全中间件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>helmet</span>({
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>contentSecurityPolicy</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// 允许内联样式和脚本
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// CORS支持
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// JSON解析
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 静态文件服务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#66d9ef>static</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;../public&#39;</span>)));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 请求日志
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>((<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>method</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>path</span><span style=color:#e6db74>}</span><span style=color:#e6db74> - </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>ip</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>initializeRoutes</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// API路由
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/posts&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>.<span style=color:#a6e22e>getPosts</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;/api/crawl&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>.<span style=color:#a6e22e>triggerCrawl</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/status&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>.<span style=color:#a6e22e>getStatus</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/stats&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>.<span style=color:#a6e22e>getStats</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postController</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 前端页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>sendFile</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;../public/index.html&#39;</span>));
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 健康检查
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/health&#39;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>({ 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ok&#39;</span>, 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>timestamp</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>(),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>uptime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>uptime</span>()
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>initializeErrorHandling</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 404处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>((<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>404</span>).<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Not Found&#39;</span> });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 全局错误处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>((<span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Unhandled error:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>500</span>).<span style=color:#a6e22e>json</span>({ 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Internal Server Error&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>NODE_ENV</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;development&#39;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Something went wrong&#39;</span>
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>start</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 启动定时任务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>schedulerService</span>.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 启动服务器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>port</span>, () =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` 服务器启动成功！`</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` 前端页面: http://localhost:</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>port</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` API接口: http://localhost:</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>port</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/api/posts`</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` 定时任务: 每30分钟自动采集一次`</span>);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 执行初始采集
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>setTimeout</span>(() =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39; 执行初始采集...&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>crawlerService</span>.<span style=color:#a6e22e>crawlPosts</span>().<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;初始采集失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>            }, <span style=color:#ae81ff>2000</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;应用启动失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>stop</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;正在关闭应用...&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>schedulerService</span>.<span style=color:#a6e22e>stop</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>crawlerService</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建应用实例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>App</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 优雅关闭
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;SIGINT&#39;</span>, () =&gt; <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>stop</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;SIGTERM&#39;</span>, () =&gt; <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>stop</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 启动应用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>App</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>//CrawlerService.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>puppeteer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;puppeteer&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>).<span style=color:#a6e22e>promises</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;path&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>logger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../utils/logger&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PostModel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../models/PostModel&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CrawlerService</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>browser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postModel</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PostModel</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRunning</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lastCrawlTime</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lastResult</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>error</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>initBrowser</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>browser</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39; 初始化浏览器...&#39;</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>browser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>puppeteer</span>.<span style=color:#a6e22e>launch</span>({
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>headless</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;new&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>args</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--no-sandbox&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-setuid-sandbox&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-dev-shm-usage&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-blink-features=AutomationControlled&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-features=VizDisplayCompositor&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-extensions&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--no-first-run&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-default-apps&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-background-timer-throttling&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-backgrounding-occluded-windows&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--disable-renderer-backgrounding&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;--window-size=1920,1080&#39;</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>defaultViewport</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1920</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1080</span> }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>newPage</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 设置用户代理和请求头
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setUserAgent</span>(<span style=color:#e6db74>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#39;</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setExtraHTTPHeaders</span>({
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;Accept&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;Accept-Language&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;Accept-Encoding&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;gzip, deflate, br&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;DNT&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;Connection&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;keep-alive&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;Upgrade-Insecure-Requests&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1&#39;</span>,
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 移除webdriver标识
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>evaluateOnNewDocument</span>(() =&gt; {
</span></span><span style=display:flex><span>                Object.<span style=color:#a6e22e>defineProperty</span>(<span style=color:#a6e22e>navigator</span>, <span style=color:#e6db74>&#39;webdriver&#39;</span>, {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>get</span><span style=color:#f92672>:</span> () =&gt; <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                Object.<span style=color:#a6e22e>defineProperty</span>(<span style=color:#a6e22e>navigator</span>, <span style=color:#e6db74>&#39;plugins&#39;</span>, {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>get</span><span style=color:#f92672>:</span> () =&gt; [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>],
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                Object.<span style=color:#a6e22e>defineProperty</span>(<span style=color:#a6e22e>navigator</span>, <span style=color:#e6db74>&#39;languages&#39;</span>, {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>get</span><span style=color:#f92672>:</span> () =&gt; [<span style=color:#e6db74>&#39;zh-CN&#39;</span>, <span style=color:#e6db74>&#39;zh&#39;</span>, <span style=color:#e6db74>&#39;en&#39;</span>],
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                window.<span style=color:#a6e22e>chrome</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> {} };
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;✅ 浏览器初始化成功&#39;</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;❌ 浏览器初始化失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>crawlPosts</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRunning</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>warn</span>(<span style=color:#e6db74>&#39; 采集任务已在运行中，跳过本次执行&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lastResult</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRunning</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>error</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39; 开始采集帖子...&#39;</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>initBrowser</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>urls</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;https://linux.do/c/resource/cloud-asset/94&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;https://linux.do/c/resource/cloud-asset/94.json&#39;</span>
</span></span><span style=display:flex><span>            ];
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>urls</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` 尝试访问: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>url</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#66d9ef>goto</span>(<span style=color:#a6e22e>url</span>, { 
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>waitUntil</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;domcontentloaded&#39;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>timeout</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>30000</span> 
</span></span><span style=display:flex><span>                    });
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// 等待页面加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForTimeout</span>(<span style=color:#ae81ff>5000</span>);
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pageTitle</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>title</span>();
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` 页面标题: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>pageTitle</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// 检查页面是否正常加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>pageTitle</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;请稍候&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>pageTitle</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;Loading&#39;</span>)) {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>extractPosts</span>();
</span></span><span style=display:flex><span>                        
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` 从 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>url</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 获取到 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个帖子`</span>);
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// 保存调试截图
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>screenshotPath</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;../../debug&#39;</span>, <span style=color:#e6db74>`debug_</span><span style=color:#e6db74>${</span>Date.<span style=color:#a6e22e>now</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74>.png`</span>);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ensureDirectoryExists</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>dirname</span>(<span style=color:#a6e22e>screenshotPath</span>));
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>screenshot</span>({ <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>screenshotPath</span> });
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>` 访问 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>url</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 失败:`</span>, <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 如果还是没有获取到帖子，尝试用户行为模拟
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39; 尝试用户行为模拟...&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>simulateUserBehavior</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 处理采集结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>processCrawlResult</span>(<span style=color:#a6e22e>posts</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lastResult</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lastCrawlTime</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>` 采集完成: 发现 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>total</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个帖子，新增 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>result</span>.<span style=color:#66d9ef>new</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个`</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>error</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39; 采集失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRunning</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>extractPosts</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>evaluate</span>(() =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 多种选择器策略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>selectors</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;.topic-list-item .main-link a.title&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;.topic-list tbody tr .main-link a&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;a.title&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;.topic-title a&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;a[href*=&#34;/t/&#34;]&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;.topic-list-body .topic-list-item a&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;.ember-view a[href*=&#34;/t/&#34;]&#39;</span>
</span></span><span style=display:flex><span>            ];
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>selector</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>selectors</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>elements</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelectorAll</span>(<span style=color:#a6e22e>selector</span>);
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>elements</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`使用选择器 &#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>selector</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34; 找到 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>elements</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个元素`</span>);
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>elements</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>element</span> =&gt; {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>element</span>.<span style=color:#a6e22e>textContent</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>trim</span>() <span style=color:#f92672>||</span> <span style=color:#a6e22e>element</span>.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#39;title&#39;</span>)<span style=color:#f92672>?</span>.<span style=color:#a6e22e>trim</span>();
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>element</span>.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#39;href&#39;</span>);
</span></span><span style=display:flex><span>                        
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>title</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>href</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>title</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>href</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;/t/&#39;</span>)) {
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fullLink</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>href</span>;
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>href</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;/&#39;</span>)) {
</span></span><span style=display:flex><span>                                <span style=color:#a6e22e>fullLink</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://linux.do&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>href</span>;
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                            
</span></span><span style=display:flex><span>                            <span style=color:#75715e>// 过滤无效链接
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>title</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;回复&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>                                <span style=color:#f92672>!</span><span style=color:#a6e22e>title</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;查看&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>                                <span style=color:#f92672>!</span><span style=color:#a6e22e>title</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;更多&#39;</span>) <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                                <span style=color:#f92672>!</span><span style=color:#a6e22e>href</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;#&#39;</span>)) {
</span></span><span style=display:flex><span>                                
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>p</span> =&gt; <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>link</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>fullLink</span>)) {
</span></span><span style=display:flex><span>                                    <span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>push</span>({
</span></span><span style=display:flex><span>                                        <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>title</span>,
</span></span><span style=display:flex><span>                                        <span style=color:#a6e22e>link</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>fullLink</span>
</span></span><span style=display:flex><span>                                    });
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    });
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>posts</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>simulateUserBehavior</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39; 模拟用户行为访问云资产版块...&#39;</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 直接访问云资产版块
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#66d9ef>goto</span>(<span style=color:#e6db74>&#39;https://xxx.xx/c/xx/cloud-asset/94&#39;</span>, { 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>waitUntil</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;domcontentloaded&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>timeout</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>30000</span> 
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 等待页面加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForTimeout</span>(<span style=color:#ae81ff>8000</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 尝试滚动页面加载更多内容
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>evaluate</span>(() =&gt; {
</span></span><span style=display:flex><span>                window.<span style=color:#a6e22e>scrollTo</span>(<span style=color:#ae81ff>0</span>, document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>scrollHeight</span>);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForTimeout</span>(<span style=color:#ae81ff>3000</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>evaluate</span>(() =&gt; {
</span></span><span style=display:flex><span>                window.<span style=color:#a6e22e>scrollTo</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForTimeout</span>(<span style=color:#ae81ff>2000</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>extractPosts</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`✅ 通过用户行为模拟从云资产版块获取到 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个帖子`</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>posts</span>;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;❌ 用户行为模拟失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> [];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>processCrawlResult</span>(<span style=color:#a6e22e>posts</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>total</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>new</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>posts</span><span style=color:#f92672>:</span> [] };
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 添加时间戳
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>postsWithTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>post</span> =&gt; ({
</span></span><span style=display:flex><span>            ...<span style=color:#a6e22e>post</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>created_at</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>(),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>generateId</span>(<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>link</span>)
</span></span><span style=display:flex><span>        }));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 保存到数据模型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>newCount</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>postModel</span>.<span style=color:#a6e22e>savePosts</span>(<span style=color:#a6e22e>postsWithTime</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>total</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>postsWithTime</span>.<span style=color:#a6e22e>length</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>newCount</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>posts</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>postsWithTime</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>generateId</span>(<span style=color:#a6e22e>link</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 从链接中提取ID或生成唯一ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>match</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/\/t\/[^\/]+\/(\d+)/</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>match</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>match</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>:</span> Date.<span style=color:#a6e22e>now</span>().<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>ensureDirectoryExists</span>(<span style=color:#a6e22e>dir</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>access</span>(<span style=color:#a6e22e>dir</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>mkdir</span>(<span style=color:#a6e22e>dir</span>, { <span style=color:#a6e22e>recursive</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>getStatus</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isRunning</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isRunning</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>lastCrawlTime</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lastCrawlTime</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>lastResult</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lastResult</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>error</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>close</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>browser</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>browser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39; 浏览器已关闭&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>CrawlerService</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>//PostModel.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>).<span style=color:#a6e22e>promises</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;path&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>logger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../utils/logger&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PostModel</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dataFile</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;../../data/posts.json&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>existingPosts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Set</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>init</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ensureDataDirectory</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>loadPosts</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;PostModel初始化失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>ensureDataDirectory</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dataDir</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>dirname</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dataFile</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>access</span>(<span style=color:#a6e22e>dataDir</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>mkdir</span>(<span style=color:#a6e22e>dataDir</span>, { <span style=color:#a6e22e>recursive</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>loadPosts</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFile</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dataFile</span>, <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 构建已存在帖子的集合
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>existingPosts</span>.<span style=color:#a6e22e>clear</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>post</span> =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>existingPosts</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>link</span>);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`📚 已加载 </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个已存在的帖子`</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;ENOENT&#39;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;📝 数据文件不存在，将创建新文件&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;加载帖子数据失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>savePosts</span>(<span style=color:#a6e22e>newPosts</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 过滤出真正的新帖子
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>uniqueNewPosts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newPosts</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>post</span> =&gt; <span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>existingPosts</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>link</span>));
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>uniqueNewPosts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;📝 没有新帖子需要保存&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 添加到现有帖子列表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>unshift</span>(...<span style=color:#a6e22e>uniqueNewPosts</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 按时间排序（最新的在前面）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>sort</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>created_at</span>) <span style=color:#f92672>-</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>created_at</span>));
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 限制最大数量（可选，防止文件过大）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>maxPosts</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>maxPosts</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>maxPosts</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 保存到文件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>writeFile</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dataFile</span>, <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>, <span style=color:#66d9ef>null</span>, <span style=color:#ae81ff>2</span>), <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 更新已存在帖子集合
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>uniqueNewPosts</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>post</span> =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>existingPosts</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>link</span>);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`💾 保存了 </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>uniqueNewPosts</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个新帖子，总计 </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个帖子`</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>uniqueNewPosts</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;保存帖子失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>getPosts</span>(<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>pageSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>page</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>pageSize</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>paginatedPosts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#a6e22e>offset</span>, <span style=color:#a6e22e>offset</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>pageSize</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>posts</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>paginatedPosts</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>total</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>page</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>page</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>pageSize</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pageSize</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>totalPages</span><span style=color:#f92672>:</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>pageSize</span>)
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>getStats</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>today</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getFullYear</span>(), <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getMonth</span>(), <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getDate</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>yesterday</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>today</span>.<span style=color:#a6e22e>getTime</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>24</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>thisWeek</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>today</span>.<span style=color:#a6e22e>getTime</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>24</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>todayPosts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>post</span> =&gt; <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>created_at</span>) <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>today</span>).<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>yesterdayPosts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>post</span> =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>postDate</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>created_at</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>postDate</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>yesterday</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>postDate</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>today</span>;
</span></span><span style=display:flex><span>        }).<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>thisWeekPosts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>post</span> =&gt; <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>created_at</span>) <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>thisWeek</span>).<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>total</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>length</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>today</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>todayPosts</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>yesterday</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>yesterdayPosts</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>thisWeek</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>thisWeekPosts</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>searchPosts</span>(<span style=color:#a6e22e>keyword</span>, <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>pageSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>filteredPosts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>post</span> =&gt; 
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>title</span>.<span style=color:#a6e22e>toLowerCase</span>().<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>keyword</span>.<span style=color:#a6e22e>toLowerCase</span>())
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>page</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>pageSize</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>paginatedPosts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>filteredPosts</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#a6e22e>offset</span>, <span style=color:#a6e22e>offset</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>pageSize</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>posts</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>paginatedPosts</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>total</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>filteredPosts</span>.<span style=color:#a6e22e>length</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>page</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>page</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>pageSize</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pageSize</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>totalPages</span><span style=color:#f92672>:</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#a6e22e>filteredPosts</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>pageSize</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>keyword</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>keyword</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PostModel</span>;
</span></span></code></pre></div><h2 id=功能特性>功能特性<a hidden class=anchor aria-hidden=true href=#功能特性>#</a></h2><ul><li>✅ <strong>自动采集</strong>: 每30分钟自动采集最新帖子</li><li>✅ <strong>智能去重</strong>: 自动过滤重复帖子</li><li>✅ <strong>反爬虫绕过</strong>: 使用 Puppeteer 模拟真实浏览器行为</li><li>✅ <strong>分页展示</strong>: 支持分页浏览大量帖子数据</li><li>✅ <strong>搜索功能</strong>: 支持按标题关键词搜索帖子</li><li>✅ <strong>实时状态</strong>: 显示采集状态和统计信息</li><li>✅ <strong>响应式设计</strong>: 支持移动端访问</li><li>✅ <strong>日志记录</strong>: 完整的日志记录和错误追踪</li></ul><h2 id=项目结构>项目结构<a hidden class=anchor aria-hidden=true href=#项目结构>#</a></h2><pre tabindex=0><code>nodejs-crawler/
├── src/                          # 源代码目录
│   ├── app.js                    # 应用入口文件
│   ├── controllers/              # 控制器层
│   │   └── PostController.js     # 帖子相关API控制器
│   ├── models/                   # 数据模型层
│   │   └── PostModel.js          # 帖子数据模型
│   ├── services/                 # 服务层
│   │   ├── CrawlerService.js     # 爬虫服务
│   │   └── SchedulerService.js   # 定时任务服务
│   └── utils/                    # 工具类
│       └── logger.js             # 日志工具
├── public/                       # 静态文件目录
│   └── index.html                # 前端页面
├── data/                         # 数据存储目录
│   └── posts.json                # 帖子数据文件
├── logs/                         # 日志文件目录
│   ├── app.log                   # 应用日志
│   └── error.log                 # 错误日志
├── debug/                        # 调试文件目录
│   └── *.png                     # 调试截图
├── package.json                  # 项目配置文件
└── README.md                     # 项目说明文档
</code></pre><h2 id=技术栈>技术栈<a hidden class=anchor aria-hidden=true href=#技术栈>#</a></h2><h3 id=后端技术>后端技术<a hidden class=anchor aria-hidden=true href=#后端技术>#</a></h3><ul><li><strong>Node.js</strong>: JavaScript 运行环境</li><li><strong>Express.js</strong>: Web 应用框架</li><li><strong>Puppeteer</strong>: 无头浏览器自动化</li><li><strong>Winston</strong>: 日志记录</li><li><strong>node-cron</strong>: 定时任务调度</li><li><strong>Helmet</strong>: 安全中间件</li></ul><h3 id=前端技术>前端技术<a hidden class=anchor aria-hidden=true href=#前端技术>#</a></h3><ul><li><strong>HTML5/CSS3</strong>: 页面结构和样式</li><li><strong>JavaScript</strong>: 交互逻辑</li><li><strong>Fetch API</strong>: 数据请求</li><li><strong>响应式设计</strong>: 移动端适配</li></ul><h2 id=安装部署>安装部署<a hidden class=anchor aria-hidden=true href=#安装部署>#</a></h2><h3 id=环境要求>环境要求<a hidden class=anchor aria-hidden=true href=#环境要求>#</a></h3><ul><li>Node.js >= 16.0.0</li><li>npm >= 7.0.0</li></ul><h3 id=安装步骤>安装步骤<a hidden class=anchor aria-hidden=true href=#安装步骤>#</a></h3><ol><li><strong>克隆项目</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone &lt;repository-url&gt;
</span></span><span style=display:flex><span>cd nodejs-crawler
</span></span></code></pre></div><ol start=2><li><strong>安装依赖</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install
</span></span></code></pre></div><ol start=3><li><strong>启动应用</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 生产环境</span>
</span></span><span style=display:flex><span>npm start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 开发环境（需要安装 nodemon）</span>
</span></span><span style=display:flex><span>npm run dev
</span></span></code></pre></div><ol start=4><li><strong>访问应用</strong></li></ol><ul><li>前端页面: http://localhost:3000</li><li>API接口: http://localhost:3000/api/posts</li><li>健康检查: http://localhost:3000/health</li></ul><h2 id=-api-接口>🔧 API 接口<a hidden class=anchor aria-hidden=true href=#-api-接口>#</a></h2><h3 id=获取帖子列表>获取帖子列表<a hidden class=anchor aria-hidden=true href=#获取帖子列表>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>GET /api/posts?page=1&amp;pageSize=10&amp;keyword=搜索关键词
</span></span></span></code></pre></div><p><strong>参数说明:</strong></p><ul><li><code>page</code>: 页码（默认1）</li><li><code>pageSize</code>: 每页数量（默认10，最大100）</li><li><code>keyword</code>: 搜索关键词（可选）</li></ul><p><strong>返回示例:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;success&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;data&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;posts&#34;</span>: [<span style=color:#960050;background-color:#1e0010>...</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span>: <span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;page&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;pageSize&#34;</span>: <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;totalPages&#34;</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=手动触发采集>手动触发采集<a hidden class=anchor aria-hidden=true href=#手动触发采集>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>POST /api/crawl
</span></span></span></code></pre></div><h3 id=获取采集状态>获取采集状态<a hidden class=anchor aria-hidden=true href=#获取采集状态>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>GET /api/status
</span></span></span></code></pre></div><h3 id=获取统计信息>获取统计信息<a hidden class=anchor aria-hidden=true href=#获取统计信息>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>GET /api/stats
</span></span></span></code></pre></div><h2 id=-配置说明>⚙️ 配置说明<a hidden class=anchor aria-hidden=true href=#-配置说明>#</a></h2><h3 id=环境变量>环境变量<a hidden class=anchor aria-hidden=true href=#环境变量>#</a></h3><ul><li><code>PORT</code>: 服务端口（默认3000）</li><li><code>NODE_ENV</code>: 运行环境（development/production）</li><li><code>LOG_LEVEL</code>: 日志级别（debug/info/warn/error）</li></ul><h3 id=定时任务>定时任务<a hidden class=anchor aria-hidden=true href=#定时任务>#</a></h3><ul><li>默认每30分钟执行一次采集</li><li>可在 <code>src/services/SchedulerService.js</code> 中修改 cron 表达式</li></ul><h3 id=数据存储>数据存储<a hidden class=anchor aria-hidden=true href=#数据存储>#</a></h3><ul><li>使用 JSON 文件存储帖子数据</li><li>数据文件位置: <code>data/posts.json</code></li><li>自动创建备份和日志轮转</li></ul><h2 id=故障排除>故障排除<a hidden class=anchor aria-hidden=true href=#故障排除>#</a></h2><h3 id=常见问题>常见问题<a hidden class=anchor aria-hidden=true href=#常见问题>#</a></h3><ol><li><p><strong>采集失败</strong></p><ul><li>检查网络连接</li><li>查看 <code>logs/error.log</code> 错误日志</li><li>检查目标网站是否可访问</li></ul></li><li><p><strong>端口占用</strong></p><ul><li>修改环境变量 <code>PORT</code></li><li>或停止占用端口的其他程序</li></ul></li><li><p><strong>权限问题</strong></p><ul><li>确保有读写 <code>data/</code> 和 <code>logs/</code> 目录的权限</li><li>Linux/Mac 下可能需要 <code>chmod</code> 设置权限</li></ul></li></ol><h3 id=调试模式>调试模式<a hidden class=anchor aria-hidden=true href=#调试模式>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 启用调试日志</span>
</span></span><span style=display:flex><span>LOG_LEVEL<span style=color:#f92672>=</span>debug npm start
</span></span></code></pre></div><h2 id=开发说明>开发说明<a hidden class=anchor aria-hidden=true href=#开发说明>#</a></h2><h3 id=添加新功能>添加新功能<a hidden class=anchor aria-hidden=true href=#添加新功能>#</a></h3><ol><li>在对应的服务类中添加业务逻辑</li><li>在控制器中添加 API 接口</li><li>在前端页面中添加交互功能</li></ol><h3 id=代码规范>代码规范<a hidden class=anchor aria-hidden=true href=#代码规范>#</a></h3><ul><li>使用 ES6+ 语法</li><li>遵循 MVC 架构模式</li><li>添加适当的错误处理和日志记录</li></ul><h1 id=docker>Docker<a hidden class=anchor aria-hidden=true href=#docker>#</a></h1><p>Dockerfile</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 使用官方 Node.js 18 LTS 镜像作为基础镜像</span>
</span></span><span style=display:flex><span>FROM node:18-slim
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置工作目录</span>
</span></span><span style=display:flex><span>WORKDIR /app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 安装系统依赖（Puppeteer 需要的库）</span>
</span></span><span style=display:flex><span>RUN apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    gnupg <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    ca-certificates <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    procps <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxss1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libgconf-2-4 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxrandr2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libasound2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libpangocairo-1.0-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libatk1.0-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libcairo-gobject2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libgtk-3-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libgdk-pixbuf2.0-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxcomposite1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxcursor1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxdamage1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxi6 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxtst6 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libnss3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libcups2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxss1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxrandr2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libasound2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libpangocairo-1.0-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libatk1.0-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libcairo-gobject2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libdrm2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxkbcommon0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libatspi2.0-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    fonts-liberation <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libappindicator3-1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libasound2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libatk-bridge2.0-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libdrm2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libgtk-3-0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libnspr4 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libnss3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libx11-xcb1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxcomposite1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxdamage1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxrandr2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    xdg-utils <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#f92672>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 复制 package.json 和 package-lock.json</span>
</span></span><span style=display:flex><span>COPY package*.json ./
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 安装 Node.js 依赖</span>
</span></span><span style=display:flex><span>RUN npm ci --only<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 复制应用代码</span>
</span></span><span style=display:flex><span>COPY . .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建必要的目录</span>
</span></span><span style=display:flex><span>RUN mkdir -p data logs debug
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置权限</span>
</span></span><span style=display:flex><span>RUN chmod -R <span style=color:#ae81ff>755</span> /app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 暴露端口</span>
</span></span><span style=display:flex><span>EXPOSE <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置环境变量</span>
</span></span><span style=display:flex><span>ENV NODE_ENV<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span>ENV PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 健康检查</span>
</span></span><span style=display:flex><span>HEALTHCHECK --interval<span style=color:#f92672>=</span>30s --timeout<span style=color:#f92672>=</span>10s --start-period<span style=color:#f92672>=</span>5s --retries<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    CMD curl -f http://localhost:3000/api/status <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 启动应用</span>
</span></span><span style=display:flex><span>CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;npm&#34;</span>, <span style=color:#e6db74>&#34;start&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>docker-compose.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>version: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  linux-do-crawler:
</span></span><span style=display:flex><span>    build: .
</span></span><span style=display:flex><span>    container_name: linux-do-crawler
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - NODE_ENV<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span>      - PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      <span style=color:#75715e># 持久化数据目录</span>
</span></span><span style=display:flex><span>      - ./data:/app/data
</span></span><span style=display:flex><span>      <span style=color:#75715e># 持久化日志目录</span>
</span></span><span style=display:flex><span>      - ./logs:/app/logs
</span></span><span style=display:flex><span>      <span style=color:#75715e># 持久化调试截图目录</span>
</span></span><span style=display:flex><span>      - ./debug:/app/debug
</span></span><span style=display:flex><span>    networks:
</span></span><span style=display:flex><span>      - crawler-network
</span></span><span style=display:flex><span>    healthcheck:
</span></span><span style=display:flex><span>      test: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;CMD&#34;</span>, <span style=color:#e6db74>&#34;curl&#34;</span>, <span style=color:#e6db74>&#34;-f&#34;</span>, <span style=color:#e6db74>&#34;http://localhost:3000/api/status&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      interval: 30s
</span></span><span style=display:flex><span>      timeout: 10s
</span></span><span style=display:flex><span>      retries: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>      start_period: 40s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>networks:
</span></span><span style=display:flex><span>  crawler-network:
</span></span><span style=display:flex><span>    driver: bridge
</span></span></code></pre></div><h2 id=-快速部署>🚀 快速部署<a hidden class=anchor aria-hidden=true href=#-快速部署>#</a></h2><h3 id=方法一一键部署脚本>方法一：一键部署脚本<a hidden class=anchor aria-hidden=true href=#方法一一键部署脚本>#</a></h3><ol><li><strong>复制项目文件到 Debian 系统</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 将整个 nodejs-crawler 目录复制到 Debian 系统</span>
</span></span><span style=display:flex><span>scp -r nodejs-crawler/ user@your-server:/home/user/
</span></span></code></pre></div><ol start=2><li><strong>运行一键部署脚本</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd nodejs-crawler
</span></span><span style=display:flex><span>chmod +x deploy.sh
</span></span><span style=display:flex><span>./deploy.sh
</span></span></code></pre></div><p>脚本会自动完成：</p><ul><li>✅ 检查系统环境</li><li>✅ 更新系统包</li><li>✅ 安装 Docker 和 Docker Compose</li><li>✅ 构建镜像并启动服务</li></ul><h3 id=方法二手动部署>方法二：手动部署<a hidden class=anchor aria-hidden=true href=#方法二手动部署>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 添加执行权限</span>
</span></span><span style=display:flex><span>sudo chmod +x /usr/local/bin/docker-compose
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 验证安装</span>
</span></span><span style=display:flex><span>docker-compose --version
</span></span></code></pre></div><p><strong>部署应用</strong></p><h1 id=进入项目目录>进入项目目录<a hidden class=anchor aria-hidden=true href=#进入项目目录>#</a></h1><p>cd nodejs-crawler</p><h1 id=构建镜像>构建镜像<a hidden class=anchor aria-hidden=true href=#构建镜像>#</a></h1><p>docker-compose build</p><h1 id=启动服务>启动服务<a hidden class=anchor aria-hidden=true href=#启动服务>#</a></h1><p>docker-compose up -d</p><pre tabindex=0><code>
## 📋 文件说明

### Dockerfile
- 基于 Node.js 18 LTS 镜像
- 安装 Puppeteer 所需的系统依赖
- 配置健康检查
- 暴露 3000 端口

### docker-compose.yml
- 定义服务配置
- 配置端口映射 (3000:3000)
- 挂载数据持久化目录
- 设置健康检查和重启策略

### .dockerignore
- 排除不必要的文件
- 减小镜像体积
- 提高构建速度

## 🔧 配置说明

### 环境变量
```yaml
environment:
  - NODE_ENV=production
  - PORT=3000
</code></pre><h3 id=数据持久化>数据持久化<a hidden class=anchor aria-hidden=true href=#数据持久化>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>./data:/app/data     </span> <span style=color:#75715e># 帖子数据</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>./logs:/app/logs     </span> <span style=color:#75715e># 日志文件</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>./debug:/app/debug   </span> <span style=color:#75715e># 调试截图</span>
</span></span></code></pre></div><h3 id=端口映射>端口映射<a hidden class=anchor aria-hidden=true href=#端口映射>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#34;3000:3000&#34;</span>  <span style=color:#75715e># 主机端口:容器端口</span>
</span></span></code></pre></div><h2 id=-监控和维护>📊 监控和维护<a hidden class=anchor aria-hidden=true href=#-监控和维护>#</a></h2><h3 id=健康检查>健康检查<a hidden class=anchor aria-hidden=true href=#健康检查>#</a></h3><p>容器配置了健康检查，会定期检查 <code>/api/status</code> 端点：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看健康状态</span>
</span></span><span style=display:flex><span>docker-compose ps
</span></span></code></pre></div><h3 id=日志管理>日志管理<a hidden class=anchor aria-hidden=true href=#日志管理>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看应用日志</span>
</span></span><span style=display:flex><span>docker-compose logs -f --tail<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看系统日志</span>
</span></span><span style=display:flex><span>sudo journalctl -u docker.service -f
</span></span></code></pre></div><h3 id=数据备份>数据备份<a hidden class=anchor aria-hidden=true href=#数据备份>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 备份数据目录</span>
</span></span><span style=display:flex><span>tar -czf backup-<span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>.tar.gz data/ logs/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 恢复数据</span>
</span></span><span style=display:flex><span>tar -xzf backup-20250821.tar.gz
</span></span></code></pre></div><hr><p><strong>注意</strong>: 请确保服务器有足够的资源（至少 1GB RAM）和网络连接来运行 Puppeteer。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://qfsyso.github.io/tags/node/>Node</a></li><li><a href=https://qfsyso.github.io/tags/docker/>Docker</a></li></ul><nav class=paginav><a class=prev href=https://qfsyso.github.io/posts/tvbox-config/><span class=title>« Prev</span><br><span>Tvbox Config</span>
</a><a class=next href=https://qfsyso.github.io/posts/discourse/><span class=title>Next »</span><br><span>Discourse</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Node Crawler on x" href="https://x.com/intent/tweet/?text=Node%20Crawler&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f&amp;hashtags=Node%2cDocker"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Node Crawler on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f&amp;title=Node%20Crawler&amp;summary=Node%20Crawler&amp;source=https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Node Crawler on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f&title=Node%20Crawler"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Node Crawler on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Node Crawler on whatsapp" href="https://api.whatsapp.com/send?text=Node%20Crawler%20-%20https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Node Crawler on telegram" href="https://telegram.me/share/url?text=Node%20Crawler&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Node Crawler on ycombinator" href="https://news.ycombinator.com/submitlink?t=Node%20Crawler&u=https%3a%2f%2fqfsyso.github.io%2fposts%2fnode-crawler%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><div class=wtime><div class=wtime2>CST<span id=beijingTime></span> GMT <span id=londonTime></span> EST <span id=newYorkTime></span> PST<span id=losAngelesTime></span></div><div class=wtime2 style=display:none>东京<span id=tokyoTime></span></div><div class=wtime2 style=display:none>欧洲-巴黎<span id=parisTime></span></div><div class=wtime2 style=display:none>UTC<span id=utcTime></span></div></div><span>&copy; 2025 <a href=https://qfsyso.github.io/>MLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><script type=text/javascript>const timeZoneOffsets={beijing:8,tokyo:9,paris:[1,2],london:[0,1],newYork:[-5,-4],losAngeles:[-8,-7]};function padZero(e){return e<10?"0"+e:e}function formatTime(e){const t=e.getFullYear(),n=padZero(e.getMonth()+1),s=padZero(e.getDate()),o=padZero(e.getHours()),i=padZero(e.getMinutes()),a=padZero(e.getSeconds());return`${t}-${n}-${s} ${o}:${i}:${a}`}function isDaylightSavingTime(e,t){const o=e.getMonth(),n=new Date(e.getFullYear(),3,8,2,0,0),s=new Date(e.getFullYear(),10,1,2,0,0);return(t==="paris"||t==="london"||t==="newYork"||t==="losAngeles")&&e>=n&&e<s}function updateTime(){const e=new Date,t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),n=formatTime(t);document.getElementById("utcTime").innerHTML=n;for(const n in timeZoneOffsets){const e=timeZoneOffsets[n];let s;Array.isArray(e)?s=isDaylightSavingTime(t,n)?e[1]:e[0]:s=e;const o=new Date(t.getTime()+s*60*60*1e3);document.getElementById(n+"Time").innerHTML=formatTime(o)}setTimeout(updateTime,1e3)}window.onload=function(){updateTime()};function notfound(e){var n=e.src,t=n.split("/"),s=t[t.length-1];e.src="https://47.115.223.75:8080/group1/v2/"+s+"?timestamp="+Date.now(),e.onerror=null}</script></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
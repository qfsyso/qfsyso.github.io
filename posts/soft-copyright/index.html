<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Soft Copyright | MLOG</title>
<meta name=keywords content="Code"><meta name=description content="使用方法：vscode 安装 code web chat,配置下述提示词，选择相应的代码，输入“生成详细规范化的软件设计说明文档”，通过ai studio 进行文档生成：
**R - Role (角色):** 你是一位经验丰富的软件著作权申请专家和高级软件工程师，专门负责根据现有源代码撰写符合中国版权保护中心（CPCC）规范的无界面软件设计说明书。你将严格基于提供的源代码进行分析，并使用Mermaid语法精确绘制所有必要的架构图、功能图、流程图和类图，确保图表内容的准确性和Mermaid语法的正确性。 **O - Objectives (目标):** 1. **生成合规文档：** 生成一份完整、专业、符合CPCC要求的无界面软件设计说明书。 2. **结构完整：** 文档结构严格遵循“鉴别材料必备组成部分”的要求，并确保每个部分内容详实、准确、具体。 3. **Mermaid图表规范：** 所有图表均使用Mermaid语法生成，并确保语法正确无误，特别是特殊字符（如 `( ) { } [ ] - > = * # ; :` 等）在节点文本和边标签中必须使用双引号包裹。图表需有明确编号（例如：图1-1，图2-1，图2-2等）和必要的文字说明。 4. **基于现有代码：** 所有设计说明、功能描述、架构图示等内容，必须严格基于对用户提供的现有源代码的深入分析，杜绝任何凭空臆测、未来展望或与代码不符的功能描述。 5. **格式符合性：** * 确保最终文档格式意图符合：A4纵向排版，文字从左至右。 * 内容应足够详尽，以在实际打印时能满足每页不少于30行文字的要求（包含图表本身的页面除外，但图表说明文字会计入）。 * 在文档顶部明确标示页眉内容：`[软件名称] - 版本号：[版本号]`。 * 在文档开头或页脚位置，以文字说明形式体现页码要求，例如：“（注：最终文档页码位于每页右上角）”。 6. **内容纯粹性：** 最终生成的文档中不得出现任何原始的“撰写要求”、“Mermaid语法指导”、“注意事项”等元指令内容，只保留纯粹的、面向审查员的设计说明书内容。 **S - Style (风格):** 专业、正式、客观、技术准确、逻辑清晰、条理分明。语言为简体中文。行文应简洁明了，避免口语化表达和不必要的修饰。 **C - Content (内容 / 上下文):** 1. **核心分析依据：** 用户将提供的完整源代码或其核心模块的详细描述/伪代码。 2."><meta name=author content="dwd"><link rel=canonical href=https://qfsyso.github.io/posts/soft-copyright/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://qfsyso.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://qfsyso.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://qfsyso.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://qfsyso.github.io/apple-touch-icon.png><link rel=mask-icon href=https://qfsyso.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://qfsyso.github.io/posts/soft-copyright/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://qfsyso.github.io/posts/soft-copyright/"><meta property="og:site_name" content="MLOG"><meta property="og:title" content="Soft Copyright"><meta property="og:description" content="使用方法：vscode 安装 code web chat,配置下述提示词，选择相应的代码，输入“生成详细规范化的软件设计说明文档”，通过ai studio 进行文档生成：
**R - Role (角色):** 你是一位经验丰富的软件著作权申请专家和高级软件工程师，专门负责根据现有源代码撰写符合中国版权保护中心（CPCC）规范的无界面软件设计说明书。你将严格基于提供的源代码进行分析，并使用Mermaid语法精确绘制所有必要的架构图、功能图、流程图和类图，确保图表内容的准确性和Mermaid语法的正确性。 **O - Objectives (目标):** 1. **生成合规文档：** 生成一份完整、专业、符合CPCC要求的无界面软件设计说明书。 2. **结构完整：** 文档结构严格遵循“鉴别材料必备组成部分”的要求，并确保每个部分内容详实、准确、具体。 3. **Mermaid图表规范：** 所有图表均使用Mermaid语法生成，并确保语法正确无误，特别是特殊字符（如 `( ) { } [ ] - > = * # ; :` 等）在节点文本和边标签中必须使用双引号包裹。图表需有明确编号（例如：图1-1，图2-1，图2-2等）和必要的文字说明。 4. **基于现有代码：** 所有设计说明、功能描述、架构图示等内容，必须严格基于对用户提供的现有源代码的深入分析，杜绝任何凭空臆测、未来展望或与代码不符的功能描述。 5. **格式符合性：** * 确保最终文档格式意图符合：A4纵向排版，文字从左至右。 * 内容应足够详尽，以在实际打印时能满足每页不少于30行文字的要求（包含图表本身的页面除外，但图表说明文字会计入）。 * 在文档顶部明确标示页眉内容：`[软件名称] - 版本号：[版本号]`。 * 在文档开头或页脚位置，以文字说明形式体现页码要求，例如：“（注：最终文档页码位于每页右上角）”。 6. **内容纯粹性：** 最终生成的文档中不得出现任何原始的“撰写要求”、“Mermaid语法指导”、“注意事项”等元指令内容，只保留纯粹的、面向审查员的设计说明书内容。 **S - Style (风格):** 专业、正式、客观、技术准确、逻辑清晰、条理分明。语言为简体中文。行文应简洁明了，避免口语化表达和不必要的修饰。 **C - Content (内容 / 上下文):** 1. **核心分析依据：** 用户将提供的完整源代码或其核心模块的详细描述/伪代码。 2."><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-19T13:35:25+08:00"><meta property="article:modified_time" content="2025-10-19T13:35:25+08:00"><meta property="article:tag" content="Code"><meta name=twitter:card content="summary"><meta name=twitter:title content="Soft Copyright"><meta name=twitter:description content="使用方法：vscode 安装 code web chat,配置下述提示词，选择相应的代码，输入“生成详细规范化的软件设计说明文档”，通过ai studio 进行文档生成：
**R - Role (角色):** 你是一位经验丰富的软件著作权申请专家和高级软件工程师，专门负责根据现有源代码撰写符合中国版权保护中心（CPCC）规范的无界面软件设计说明书。你将严格基于提供的源代码进行分析，并使用Mermaid语法精确绘制所有必要的架构图、功能图、流程图和类图，确保图表内容的准确性和Mermaid语法的正确性。 **O - Objectives (目标):** 1. **生成合规文档：** 生成一份完整、专业、符合CPCC要求的无界面软件设计说明书。 2. **结构完整：** 文档结构严格遵循“鉴别材料必备组成部分”的要求，并确保每个部分内容详实、准确、具体。 3. **Mermaid图表规范：** 所有图表均使用Mermaid语法生成，并确保语法正确无误，特别是特殊字符（如 `( ) { } [ ] - > = * # ; :` 等）在节点文本和边标签中必须使用双引号包裹。图表需有明确编号（例如：图1-1，图2-1，图2-2等）和必要的文字说明。 4. **基于现有代码：** 所有设计说明、功能描述、架构图示等内容，必须严格基于对用户提供的现有源代码的深入分析，杜绝任何凭空臆测、未来展望或与代码不符的功能描述。 5. **格式符合性：** * 确保最终文档格式意图符合：A4纵向排版，文字从左至右。 * 内容应足够详尽，以在实际打印时能满足每页不少于30行文字的要求（包含图表本身的页面除外，但图表说明文字会计入）。 * 在文档顶部明确标示页眉内容：`[软件名称] - 版本号：[版本号]`。 * 在文档开头或页脚位置，以文字说明形式体现页码要求，例如：“（注：最终文档页码位于每页右上角）”。 6. **内容纯粹性：** 最终生成的文档中不得出现任何原始的“撰写要求”、“Mermaid语法指导”、“注意事项”等元指令内容，只保留纯粹的、面向审查员的设计说明书内容。 **S - Style (风格):** 专业、正式、客观、技术准确、逻辑清晰、条理分明。语言为简体中文。行文应简洁明了，避免口语化表达和不必要的修饰。 **C - Content (内容 / 上下文):** 1. **核心分析依据：** 用户将提供的完整源代码或其核心模块的详细描述/伪代码。 2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://qfsyso.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Soft Copyright","item":"https://qfsyso.github.io/posts/soft-copyright/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Soft Copyright","name":"Soft Copyright","description":"使用方法：vscode 安装 code web chat,配置下述提示词，选择相应的代码，输入“生成详细规范化的软件设计说明文档”，通过ai studio 进行文档生成：\n**R - Role (角色):** 你是一位经验丰富的软件著作权申请专家和高级软件工程师，专门负责根据现有源代码撰写符合中国版权保护中心（CPCC）规范的无界面软件设计说明书。你将严格基于提供的源代码进行分析，并使用Mermaid语法精确绘制所有必要的架构图、功能图、流程图和类图，确保图表内容的准确性和Mermaid语法的正确性。 **O - Objectives (目标):** 1. **生成合规文档：** 生成一份完整、专业、符合CPCC要求的无界面软件设计说明书。 2. **结构完整：** 文档结构严格遵循“鉴别材料必备组成部分”的要求，并确保每个部分内容详实、准确、具体。 3. **Mermaid图表规范：** 所有图表均使用Mermaid语法生成，并确保语法正确无误，特别是特殊字符（如 `( ) { } [ ] - \u0026gt; = * # ; :` 等）在节点文本和边标签中必须使用双引号包裹。图表需有明确编号（例如：图1-1，图2-1，图2-2等）和必要的文字说明。 4. **基于现有代码：** 所有设计说明、功能描述、架构图示等内容，必须严格基于对用户提供的现有源代码的深入分析，杜绝任何凭空臆测、未来展望或与代码不符的功能描述。 5. **格式符合性：** * 确保最终文档格式意图符合：A4纵向排版，文字从左至右。 * 内容应足够详尽，以在实际打印时能满足每页不少于30行文字的要求（包含图表本身的页面除外，但图表说明文字会计入）。 * 在文档顶部明确标示页眉内容：`[软件名称] - 版本号：[版本号]`。 * 在文档开头或页脚位置，以文字说明形式体现页码要求，例如：“（注：最终文档页码位于每页右上角）”。 6. **内容纯粹性：** 最终生成的文档中不得出现任何原始的“撰写要求”、“Mermaid语法指导”、“注意事项”等元指令内容，只保留纯粹的、面向审查员的设计说明书内容。 **S - Style (风格):** 专业、正式、客观、技术准确、逻辑清晰、条理分明。语言为简体中文。行文应简洁明了，避免口语化表达和不必要的修饰。 **C - Content (内容 / 上下文):** 1. **核心分析依据：** 用户将提供的完整源代码或其核心模块的详细描述/伪代码。 2.","keywords":["Code"],"articleBody":"使用方法：vscode 安装 code web chat,配置下述提示词，选择相应的代码，输入“生成详细规范化的软件设计说明文档”，通过ai studio 进行文档生成：\n**R - Role (角色):** 你是一位经验丰富的软件著作权申请专家和高级软件工程师，专门负责根据现有源代码撰写符合中国版权保护中心（CPCC）规范的无界面软件设计说明书。你将严格基于提供的源代码进行分析，并使用Mermaid语法精确绘制所有必要的架构图、功能图、流程图和类图，确保图表内容的准确性和Mermaid语法的正确性。 **O - Objectives (目标):** 1. **生成合规文档：** 生成一份完整、专业、符合CPCC要求的无界面软件设计说明书。 2. **结构完整：** 文档结构严格遵循“鉴别材料必备组成部分”的要求，并确保每个部分内容详实、准确、具体。 3. **Mermaid图表规范：** 所有图表均使用Mermaid语法生成，并确保语法正确无误，特别是特殊字符（如 `( ) { } [ ] - \u003e = * # ; :` 等）在节点文本和边标签中必须使用双引号包裹。图表需有明确编号（例如：图1-1，图2-1，图2-2等）和必要的文字说明。 4. **基于现有代码：** 所有设计说明、功能描述、架构图示等内容，必须严格基于对用户提供的现有源代码的深入分析，杜绝任何凭空臆测、未来展望或与代码不符的功能描述。 5. **格式符合性：** * 确保最终文档格式意图符合：A4纵向排版，文字从左至右。 * 内容应足够详尽，以在实际打印时能满足每页不少于30行文字的要求（包含图表本身的页面除外，但图表说明文字会计入）。 * 在文档顶部明确标示页眉内容：`[软件名称] - 版本号：[版本号]`。 * 在文档开头或页脚位置，以文字说明形式体现页码要求，例如：“（注：最终文档页码位于每页右上角）”。 6. **内容纯粹性：** 最终生成的文档中不得出现任何原始的“撰写要求”、“Mermaid语法指导”、“注意事项”等元指令内容，只保留纯粹的、面向审查员的设计说明书内容。 **S - Style (风格):** 专业、正式、客观、技术准确、逻辑清晰、条理分明。语言为简体中文。行文应简洁明了，避免口语化表达和不必要的修饰。 **C - Content (内容 / 上下文):** 1. **核心分析依据：** 用户将提供的完整源代码或其核心模块的详细描述/伪代码。 2. **文档结构与内容要求 (鉴别材料必备组成部分):** * **1. 软件概述：** * 软件背景与用途（基于代码分析推断） * 开发目标与特点（提炼自代码实现的功能和技术选型） * 运行环境与技术架构（根据代码依赖、配置等确定） * **2. 系统架构图：** * 使用Mermaid `graph TD` 绘制整体架构图。 * 清晰展示从代码分析出的各主要模块/组件之间的关系与核心数据流。 * 标明主要组件和关键接口（若适用）。 * **3. 功能模块设计：** * 使用Mermaid `graph TD` 或 `flowchart TD` 绘制详细的功能结构图或主要功能分解图。 * 描述从代码中分析出的各模块的具体功能与职责。 * 解释模块间的实际交互方式和调用关系。 * **4. 核心算法与流程：** * 针对代码中的关键业务逻辑或复杂处理，使用Mermaid `flowchart TD` 展示其流程。 * 详细描述核心算法的实现原理（基于代码逻辑）。 * 提供算法的输入、主要处理步骤和输出说明。 * **5. 数据结构设计：** * 针对代码中定义和使用的主要数据实体/对象，使用Mermaid `classDiagram` 展示其结构。 * 说明数据实体间的关系（如关联、继承、聚合）与关键约束。 * 提供主要数据模型的详细描述（字段、类型、含义）。 * **6. 接口设计 (若适用，尤其针对有API或模块间清晰接口的软件):** * 使用Mermaid（例如，简单的节点连接图 `graph TD` 或 `sequenceDiagram`，根据接口特性选择）描述主要API接口结构或模块间接口。 * 说明接口的用途、主要参数、预期返回值和关键错误处理机制（基于代码实现）。 * 若能从代码中提炼，可提供简化的调用示例说明。 * **7. 异常处理设计：** * 针对代码中显式处理的或关键的异常情况，使用Mermaid `flowchart TD` 展示其处理流程。 * 说明代码中已考虑并处理的可能出现的异常情况。 * 描述系统在这些异常发生时的恢复机制或应对策略。 3. **Mermaid语法核心规则 (必须严格遵守):** * **特殊字符处理：** 在Mermaid图表的节点文本、边标签文本中，如果包含Mermaid本身用于定义语法的特殊字符（例如 `( ) { } [ ] - \u003e = * # ; :` 等），**必须使用双引号将该文本包裹起来**。 * 节点示例：`id[\"文本(含特殊符)\"]`，`id(\"文本(含特殊符)\")`，`id{\"文本(含特殊符)?\"}`。 * 边标签示例：`A -- \"调用(参数)\" --\u003e B`。 * 图表示例已在用户原始需求中提供，应作为参考。 4. **图表要求：** * 每个图表下方必须有编号（如：`图2-1 系统架构图`）和对图表的简要文字说明。 * 图表内容应清晰可读，直接反映代码的实际设计，避免过于复杂或泛化。 5. **内容限制：** * **聚焦现有代码：** 所有描述和图表必须直接反映所提供源代码的现状和功能。 * **无未来展望：** 不得包含对软件未来版本、计划中功能或未实现功能的讨论。 * **无幻想内容：** 不得虚构不存在的功能、模块或技术细节。 * **移除指令性文字：** 最终文档中不能出现“设计说明书基本要求”、“鉴别材料必备组成部分”、“Mermaid语法指导”、“注意事项”等标题或内容，这些仅为给AI的指令。 **I - Input (输入):** 用户将提供以下信息： 1. **软件全名：** [用户填写] 2. **软件版本号：** [用户填写] 3. **源代码：** [用户将在此处粘贴核心源代码片段、或提供代码库的结构概览、关键模块的伪代码或详细功能描述。AI应基于此输入进行深入分析。如果代码量巨大，用户应指明分析的重点。] **R - Response (响应):** 你将输出一份完整的Markdown格式的软件设计说明书，具体包含： 1. **文档头部：** * 第一行：`软件名称：[用户提供的软件全名]` * 第二行：`版本号：[用户提供的软件版本号]` * 第三行或独立段落：（注：最终文档页码位于每页右上角） 2. **正文结构：** 严格按照“鉴别材料必备组成部分”的七个部分组织，每个部分使用二级Markdown标题（`##`），例如： * `## 1. 软件概述` * `## 2. 系统架构图` * ...以此类推，直至 `## 7. 异常处理设计` 3. **图表呈现：** * 每个图表前都有一段引导性的文字说明，解释图表的目的和内容。 * 然后是使用三个反引号包裹的Mermaid代码块，例如： ```mermaid graph TD A[\"模块A\"] --\u003e B[\"模块B (处理X)\"] ``` * 紧接着是图表的编号和标题，例如：`**图2-1 系统架构图**` (加粗显示)。 * 图表后可跟随对图表中关键元素或流程的进一步详细文字解释。 4. **内容要求：** * 所有文字描述和图表内容均真实、准确地反映对输入源代码的分析结果。 * 内容详尽，逻辑清晰，能够充分展示软件的设计思想和实现细节。 * 无任何与现有代码无关的臆测、未来计划或通用模板性描述。 * 不包含任何原始指令中的标题或解释性文字（例如，不出现“Mermaid语法指导”这样的字眼）。 * 语言为简体中文，专业流畅。 **A - Audience (受众):** 中国版权保护中心（CPCC）的软件著作权审查员。他们是专业人士，期望看到一份结构清晰、内容详实、技术描述准确、图表规范、完全符合官方要求的专业软件设计文档。 **W - Workflow (工作流):** 1. **接收并理解输入：** 仔细阅读并理解用户提供的软件名称、版本号以及最重要的——源代码（或其替代性描述）。 2. **源代码深度分析：** 模拟对源代码的编译、阅读和理解过程。识别主要的模块、类、函数、数据结构、核心算法、业务流程、配置文件、依赖项等。 3. **信息提取与映射：** 将从代码中分析得到的信息，与“鉴别材料必备组成部分”的每一项要求进行对应和填充。 4. **逐项撰写与绘图：** * **软件概述：** 根据分析结果撰写背景、目标、环境、架构概览。 * **图表设计与生成：** 对于需要图表的部分： a. **构思图表：** 基于代码的实际结构和逻辑，构思最能清晰表达该部分设计意图的Mermaid图（架构图、功能图、流程图、类图等）。 b. **编写Mermaid代码：** 严格按照Mermaid语法和特殊字符处理规则编写图表代码。确保节点命名、关系连接准确反映代码。 c. **添加编号和说明：** 为每个图表添加规范的编号（如图1-1, 图2-1, 图3-1等）和必要的文字说明。 * **详细描述：** 围绕生成的图表和代码分析，撰写每个部分的详细文字描述，确保内容翔实、准确，并能体现软件设计的深度。 5. **格式化与审查：** * **内容准确性与聚焦性：** 严格检查所有描述和图表是否完全基于现有代码，删除所有推测、未来计划或与代码不符的内容。 * **完整性检查：** 确保所有“鉴别材料必备组成部分”都已覆盖，且内容充分。 * **Mermaid语法校验：** 仔细检查所有Mermaid代码块的语法，特别是特殊字符转义。 * **指令移除：** 确保最终输出中不包含提示词中的指令性文字、标题或解释（例如，不应出现“鉴别材料必备组成部分”这个列表本身）。 * **格式符合性：** 确认页眉信息、页码说明已按要求添加。检查整体行文风格是否专业正式。 6. **输出最终文档：** 生成结构完整、内容准确、符合要求的Markdown格式软件设计说明书。 代码整理\nimport os import re import argparse import tempfile import shutil from pathlib import Path import datetime from collections import defaultdict from docx import Document from docx.shared import Pt, Inches from docx.enum.text import WD_LINE_SPACING, WD_ALIGN_PARAGRAPH from docx.oxml.ns import qn from docx.oxml import OxmlElement class SoftwareCopyrightFormatter: def __init__(self, input_dirs, output_file, file_extensions=None, title=None, lines_per_page=50, max_pages=60, total_lines=None, ignore_patterns=None, add_line_numbers=True): \"\"\" Initialize the formatter with configuration parameters. Args: input_dirs (list): List of directories containing source code files output_file (str): Path to output Word document file_extensions (list): List of file extensions to include (e.g., ['.py', '.js']) title (str): Title of the software (for header) lines_per_page (int): Number of lines per page max_pages (int): Maximum number of pages (default 60) total_lines (int): Total lines of code to include (overrides max_pages if set) ignore_patterns (list): List of regex patterns to ignore files/folders add_line_numbers (bool): Whether to add line number prefixes to each code line \"\"\" self.input_dirs = [Path(d) for d in input_dirs] # Make sure output_file is a proper file path, not a directory self.output_file = self._validate_output_path(output_file) self.file_extensions = file_extensions or ['.py'] self.title = title or \"软件著作权源代码\" self.lines_per_page = lines_per_page self.max_pages = max_pages # If total_lines is specified, it overrides max_pages self.target_total_lines = total_lines if total_lines else (max_pages * lines_per_page) self.ignore_patterns = ignore_patterns or [r'__pycache__', r'\\.git', r'\\.env', r'venv', r'\\.pyc$', r'\\.pyo$'] self.add_line_numbers = add_line_numbers # Separate counters for code and non-code contents self.total_lines = 0 # Total lines in document self.code_lines = 0 # Only code lines (to enforce target total lines) self.current_page = 1 self.doc = Document() self.code_files = [] self.module_stats = defaultdict(lambda: {'files': 0, 'lines': 0}) self.global_line_counter = 1 # Global line counter for continuous numbering # Tracking processed files self.processed_files = set() # Files that were processed self.partially_processed_files = {} # Files that were partially processed # Configure document style self._setup_document() def _validate_output_path(self, output_path): \"\"\" Validate the output file path and ensure it's a file, not a directory \"\"\" path = Path(output_path) # If it's a directory, create a default filename in that directory if path.is_dir(): timestamp = datetime.datetime.now().strftime(\"%Y%m%d%H%M%S\") path = path / f\"软件著作权代码_{timestamp}.docx\" print(f\"Output path is a directory. Using file: {path}\") # Make sure parent directory exists if not path.parent.exists(): print(f\"Creating parent directory: {path.parent}\") path.parent.mkdir(parents=True, exist_ok=True) return str(path) def _create_element(self, name): \"\"\"Create an element with proper namespace\"\"\" return OxmlElement(name) def _create_page_number_field(self, paragraph): \"\"\"Create a page number field in a paragraph\"\"\" run = paragraph.add_run() fldChar1 = self._create_element('w:fldChar') fldChar1.set(qn('w:fldCharType'), 'begin') run._element.append(fldChar1) instrText = self._create_element('w:instrText') instrText.set(qn('xml:space'), 'preserve') instrText.text = 'PAGE' run._element.append(instrText) fldChar2 = self._create_element('w:fldChar') fldChar2.set(qn('w:fldCharType'), 'end') run._element.append(fldChar2) def _setup_document(self): \"\"\"Configure Word document style settings with wider spacing to target specified lines per page\"\"\" # Set default font to SimSun (宋体) with size 小五 (9pt) style = self.doc.styles['Normal'] style.font.name = 'SimSun' style.font.size = Pt(9) # Calculate line spacing based on lines_per_page # More lines per page -\u003e smaller line spacing # This is an approximation and may need tuning line_spacing_factor = 1.1 if self.lines_per_page \u003e 50: line_spacing_factor = 1.0 elif self.lines_per_page \u003e 55: line_spacing_factor = 0.9 elif self.lines_per_page \u003e 60: line_spacing_factor = 0.8 elif self.lines_per_page \u003c 45: line_spacing_factor = 1.2 elif self.lines_per_page \u003c 40: line_spacing_factor = 1.3 # Adjust line spacing to target specified lines per page style.paragraph_format.line_spacing = line_spacing_factor style.paragraph_format.line_spacing_rule = WD_LINE_SPACING.MULTIPLE # Add moderate paragraph spacing to help control pages style.paragraph_format.space_before = Pt(1) style.paragraph_format.space_after = Pt(1) style.paragraph_format.alignment = 0 # Left alignment # Adjust margins based on lines_per_page margin_factor = 0.6 if self.lines_per_page \u003e 50: margin_factor = 0.5 elif self.lines_per_page \u003c 45: margin_factor = 0.7 # Set margins for section in self.doc.sections: section.top_margin = Inches(margin_factor) section.bottom_margin = Inches(margin_factor) section.left_margin = Inches(margin_factor) section.right_margin = Inches(margin_factor) # Add a header with software title section = self.doc.sections[0] header = section.header header_para = header.paragraphs[0] header_para.text = self.title # Add a footer with proper page number field footer = section.footer footer_para = footer.paragraphs[0] footer_para.text = \"第 \" self._create_page_number_field(footer_para) footer_para.add_run(\" 页\") print(f\"Document configured for approximately {self.lines_per_page} lines per page\") print(f\"Targeting total of {self.target_total_lines} code lines\") def _should_ignore(self, path): \"\"\"Check if the path should be ignored based on ignore patterns\"\"\" path_str = str(path) for pattern in self.ignore_patterns: if re.search(pattern, path_str): return True return False def _clean_code(self, code_text, file_ext): \"\"\" Clean the code by removing comments and empty lines. Handles different programming languages based on file extension. Args: code_text (str): Raw code text file_ext (str): File extension to determine comment style Returns: str: Cleaned code text \"\"\" # Remove any copyright text first (before comment removal) lines = code_text.split('\\n') lines = [line for line in lines if 'copyright' not in line.lower()] code_text = '\\n'.join(lines) if file_ext == '.py': # Python-specific cleaning # Remove multi-line comments (triple quotes) code_text = re.sub(r'\"\"\".*?\"\"\"', '', code_text, flags=re.DOTALL) code_text = re.sub(r\"'''.*?'''\", '', code_text, flags=re.DOTALL) # Remove single-line comments code_text = re.sub(r'#.*$', '', code_text, flags=re.MULTILINE) elif file_ext in ['.js', '.java', '.c', '.cpp', '.cs', '.php']: # C-style comments # Remove multi-line comments (/* */) code_text = re.sub(r'/\\*.*?\\*/', '', code_text, flags=re.DOTALL) # Remove single-line comments (//) code_text = re.sub(r'//.*$', '', code_text, flags=re.MULTILINE) elif file_ext in ['.html', '.xml']: # HTML/XML comments code_text = re.sub(r'', '', code_text, flags=re.DOTALL) # Remove empty lines for all file types lines = [line.rstrip() for line in code_text.split('\\n')] lines = [line for line in lines if line.strip()] return '\\n'.join(lines) def _format_file(self, file_path): \"\"\"Read a file, clean its contents, and return formatted code lines\"\"\" try: with open(file_path, 'r', encoding='utf-8') as f: content = f.read() file_ext = file_path.suffix.lower() cleaned_content = self._clean_code(content, file_ext) lines = cleaned_content.split('\\n') # Extract module info from path - determine the module based on the input directory module_name = None for input_dir in self.input_dirs: try: rel_path = file_path.relative_to(input_dir) if rel_path.parts: module_name = rel_path.parts[0] break except ValueError: # Not relative to this input directory continue if not module_name: # Fallback - use the parent directory name module_name = file_path.parent.name or \"root\" # Update module statistics self.module_stats[module_name]['files'] += 1 self.module_stats[module_name]['lines'] += len(lines) return lines except UnicodeDecodeError: # Try with a different encoding if UTF-8 fails try: with open(file_path, 'r', encoding='latin-1') as f: content = f.read() file_ext = file_path.suffix.lower() cleaned_content = self._clean_code(content, file_ext) lines = cleaned_content.split('\\n') # Extract module info and update statistics (same as above) module_name = None for input_dir in self.input_dirs: try: rel_path = file_path.relative_to(input_dir) if rel_path.parts: module_name = rel_path.parts[0] break except ValueError: continue if not module_name: module_name = file_path.parent.name or \"root\" self.module_stats[module_name]['files'] += 1 self.module_stats[module_name]['lines'] += len(lines) return lines except: print(f\"Warning: Could not process file {file_path}\") return [] except Exception as e: print(f\"Error processing {file_path}: {e}\") return [] def _find_code_files(self): \"\"\" Find all code files in the input directories matching the specified extensions and not matching ignore patterns. Returns: list: List of Path objects to code files \"\"\" code_files = [] for input_dir in self.input_dirs: print(f\"Scanning directory: {input_dir}\") if not input_dir.exists(): print(f\"Warning: Directory {input_dir} does not exist, skipping\") continue for ext in self.file_extensions: for file_path in input_dir.glob(f'**/*{ext}'): if not self._should_ignore(file_path): code_files.append(file_path) # Sort files to prioritize entry points or main files # This helps ensure the first page contains important entry code priority_patterns = [ r'main\\.py', r'app\\.py', r'index\\.py', r'__main__\\.py', r'server\\.py', r'__init__\\.py' ] def get_priority(file_path): file_name = file_path.name for i, pattern in enumerate(priority_patterns): if re.match(pattern, file_name): return i return len(priority_patterns) # Sort first by priority patterns, then by input directory order, # then by directory depth (shallower first), then by filename def get_input_dir_index(file_path): for i, input_dir in enumerate(self.input_dirs): try: file_path.relative_to(input_dir) return i except ValueError: continue return len(self.input_dirs) code_files.sort(key=lambda f: ( get_priority(f), get_input_dir_index(f), len(str(f).split(os.sep)), str(f) )) return code_files def _build_directory_tree(self): \"\"\" Build a unified directory tree structure from all input directories Returns: dict: A nested dictionary representing the directory tree \"\"\" tree = defaultdict(lambda: {\"files\": [], \"subdirs\": defaultdict(dict)}) # Group files by input directory first input_dir_files = defaultdict(list) for file_path in self.code_files: for i, input_dir in enumerate(self.input_dirs): try: rel_path = file_path.relative_to(input_dir) input_dir_files[i].append((rel_path, file_path)) break except ValueError: continue # Process each input directory's files for i, files in sorted(input_dir_files.items()): input_dir = self.input_dirs[i] input_dir_name = input_dir.name # Add this input directory as a top-level node if input_dir_name not in tree: tree[input_dir_name] = {\"files\": [], \"subdirs\": defaultdict(dict)} # Process files in this input directory for rel_path, abs_path in files: current = tree[input_dir_name] # Navigate through the directory hierarchy for part in rel_path.parts[:-1]: if \"subdirs\" not in current: current[\"subdirs\"] = defaultdict(dict) if part not in current[\"subdirs\"]: current[\"subdirs\"][part] = {\"files\": [], \"subdirs\": defaultdict(dict)} current = current[\"subdirs\"][part] # Add the file to the current directory if \"files\" not in current: current[\"files\"] = [] current[\"files\"].append(abs_path) return tree def _generate_module_structure(self): \"\"\" Generate a combined structured representation of all project modules Returns: list: Text representation of the module structure \"\"\" # Build a unified directory tree tree = self._build_directory_tree() # Create a tree-like structure structure_lines = [] structure_lines.append(f\"{self.title} 模块结构\") structure_lines.append(\"=\" * 80) structure_lines.append(f\"生成日期: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\") structure_lines.append(f\"总文件数: {len(self.code_files)}\") structure_lines.append(f\"支持文件类型: {', '.join(self.file_extensions)}\") structure_lines.append(f\"包含目录: {', '.join([str(d) for d in self.input_dirs])}\") structure_lines.append(\"=\" * 80) structure_lines.append(\"\") # Process the tree recursively self._add_tree_to_structure(structure_lines, tree, \"\", True) # Add module statistics structure_lines.append(\"\") structure_lines.append(\"模块统计\") structure_lines.append(\"=\" * 80) for module, stats in sorted(self.module_stats.items()): if module: # Skip empty module names structure_lines.append(f\"{module}: {stats['files']} 文件, {stats['lines']} 行代码\") return structure_lines def _add_tree_to_structure(self, structure_lines, tree, prefix=\"\", is_root=False): \"\"\" Recursively add directory tree to structure lines Args: structure_lines (list): List to append lines to tree (dict): Directory tree structure prefix (str): Prefix for the current line (for indentation) is_root (bool): Whether this is the root level \"\"\" # Process top-level directories if is_root: top_dirs = sorted(tree.keys()) for i, dir_name in enumerate(top_dirs): is_last = i == len(top_dirs) - 1 dir_prefix = \"└── \" if is_last else \"├── \" structure_lines.append(f\"{prefix}{dir_prefix}{dir_name}/\") next_prefix = prefix + (\" \" if is_last else \"│ \") dir_tree = tree[dir_name] # Process files in this directory self._add_files_to_structure(structure_lines, dir_tree.get(\"files\", []), next_prefix, not dir_tree.get(\"subdirs\")) # Process subdirectories if \"subdirs\" in dir_tree and dir_tree[\"subdirs\"]: subdirs = dir_tree[\"subdirs\"] self._add_subdirs_to_structure(structure_lines, subdirs, next_prefix) else: # Process subdirectories if \"subdirs\" in tree and tree[\"subdirs\"]: subdirs = tree[\"subdirs\"] self._add_subdirs_to_structure(structure_lines, subdirs, prefix) # Process files in this directory self._add_files_to_structure(structure_lines, tree.get(\"files\", []), prefix, True) def _add_files_to_structure(self, structure_lines, files, prefix, is_last_level): \"\"\"Add files to the structure with proper formatting\"\"\" sorted_files = sorted([f.name for f in files]) for i, file_name in enumerate(sorted_files): is_last_file = i == len(sorted_files) - 1 file_prefix = \"└── \" if is_last_file and is_last_level else \"├── \" structure_lines.append(f\"{prefix}{file_prefix}{file_name}\") def _add_subdirs_to_structure(self, structure_lines, subdirs, prefix): \"\"\"Add subdirectories to the structure with proper formatting\"\"\" sorted_subdirs = sorted(subdirs.keys()) for i, subdir_name in enumerate(sorted_subdirs): is_last = i == len(sorted_subdirs) - 1 dir_prefix = \"└── \" if is_last else \"├── \" structure_lines.append(f\"{prefix}{dir_prefix}{subdir_name}/\") next_prefix = prefix + (\" \" if is_last else \"│ \") subdir_tree = subdirs[subdir_name] # Process files in this directory self._add_files_to_structure(structure_lines, subdir_tree.get(\"files\", []), next_prefix, not subdir_tree.get(\"subdirs\")) # Process further subdirectories if \"subdirs\" in subdir_tree and subdir_tree[\"subdirs\"]: self._add_subdirs_to_structure(structure_lines, subdir_tree[\"subdirs\"], next_prefix) def _add_code_to_document(self, code_lines, file_path): \"\"\" Add code lines to the document with continuous line numbering across all files. \"\"\" # Don't count this in the target total lines limit, but do track it for total document file_header = self.doc.add_paragraph() file_header.add_run(f\"文件: {file_path}\").bold = True self.total_lines += 1 # Add each line with line number from global counter line_count = 0 original_line_count = len(code_lines) for line in code_lines: # Check if we've reached the code limit (target total lines) if self.code_lines \u003e= self.target_total_lines: # File was partially processed if line_count \u003e 0: self.partially_processed_files[str(file_path)] = line_count break # Create paragraph for code line p = self.doc.add_paragraph() # Add line number and code if self.add_line_numbers: p.add_run(f\"{self.global_line_counter:4d}: \").bold = True p.add_run(line) line_count += 1 self.total_lines += 1 self.code_lines += 1 # Track code lines separately if self.add_line_numbers: self.global_line_counter += 1 # Add separator after each file - don't count in code lines separator = self.doc.add_paragraph() separator.add_run(\"=\" * 80) self.total_lines += 1 # Track file processing status if line_count == original_line_count: self.processed_files.add(str(file_path)) elif line_count \u003e 0: self.partially_processed_files[str(file_path)] = line_count return line_count def _add_module_structure_to_document(self, structure_lines): \"\"\"Add the module structure to the document\"\"\" # Add title - don't count towards code line limit title = self.doc.add_heading('软件模块结构', level=1) title.alignment = WD_ALIGN_PARAGRAPH.CENTER self.total_lines += 1 # Add structure lines - don't count towards code line limit for line in structure_lines: p = self.doc.add_paragraph() p.add_run(line) self.total_lines += 1 # Add separator - don't count towards code line limit self.doc.add_paragraph().add_run(\"=\" * 80) self.total_lines += 1 def _add_summary_to_document(self): \"\"\"Add a summary section at the end of the document\"\"\" # Add title - don't count towards code line limit title = self.doc.add_heading('代码处理摘要', level=1) title.alignment = WD_ALIGN_PARAGRAPH.CENTER self.total_lines += 1 # Add summary info - don't count towards code line limit p = self.doc.add_paragraph() p.add_run(f\"总文件数: {len(self.code_files)}\").bold = True self.total_lines += 1 p = self.doc.add_paragraph() p.add_run(f\"已处理文件数: {len(self.processed_files)}\").bold = True self.total_lines += 1 p = self.doc.add_paragraph() p.add_run(f\"部分处理文件数: {len(self.partially_processed_files)}\").bold = True self.total_lines += 1 unprocessed_count = len(self.code_files) - len(self.processed_files) - len(self.partially_processed_files) p = self.doc.add_paragraph() p.add_run(f\"未处理文件数: {unprocessed_count}\").bold = True self.total_lines += 1 # Add page stats p = self.doc.add_paragraph() p.add_run(f\"代码总行数: {self.code_lines}\").bold = True self.total_lines += 1 estimated_pages = (self.code_lines + self.lines_per_page - 1) // self.lines_per_page p = self.doc.add_paragraph() p.add_run(f\"代码页数: {estimated_pages} (每页 {self.lines_per_page} 行)\").bold = True self.total_lines += 1 # Add configuration info p = self.doc.add_paragraph() p.add_run(f\"目标代码行数: {self.target_total_lines}\").bold = True self.total_lines += 1 # Add separator - don't count towards code line limit self.doc.add_paragraph().add_run(\"=\" * 80) self.total_lines += 1 # If there are partially processed files, list them if self.partially_processed_files: p = self.doc.add_paragraph() p.add_run(\"部分处理的文件:\").bold = True self.total_lines += 1 for file_path, processed_lines in sorted(self.partially_processed_files.items()): with open(file_path, 'r', encoding='utf-8', errors='ignore') as f: try: total_lines = len(self._clean_code(f.read(), Path(file_path).suffix.lower()).split('\\n')) except: total_lines = \"未知\" p = self.doc.add_paragraph() p.add_run(f\"• {file_path}: 处理了 {processed_lines} 行，共 {total_lines} 行\") self.total_lines += 1 # If there are unprocessed files, list them if unprocessed_count \u003e 0: p = self.doc.add_paragraph() p.add_run(\"未处理的文件:\").bold = True self.total_lines += 1 for file_path in self.code_files: if (str(file_path) not in self.processed_files and str(file_path) not in self.partially_processed_files): p = self.doc.add_paragraph() p.add_run(f\"• {file_path}\") self.total_lines += 1 # Add note about prioritized files p = self.doc.add_paragraph() p.add_run(\"注：\").bold = True p.add_run(\"以下类型的文件被优先处理：main.py, app.py, index.py, __main__.py, server.py, __init__.py\") self.total_lines += 1 def _add_padding_code(self): \"\"\"Add padding code to reach exactly the target total lines\"\"\" # Calculate lines needed to reach exactly target total lines lines_to_add = self.target_total_lines - self.code_lines if lines_to_add \u003c= 0: return # No padding needed print(f\"Adding {lines_to_add} padding lines to reach exactly {self.target_total_lines} total code lines\") # Add padding header file_header = self.doc.add_paragraph() file_header.add_run(\"文件: 补充代码\").bold = True self.total_lines += 1 # Add padding lines for i in range(lines_to_add): p = self.doc.add_paragraph() # Generate some \"meaningful\" looking padding code that varies if i % 5 == 0: if self.add_line_numbers: p.add_run(f\"{self.global_line_counter:4d}: \").bold = True p.add_run(f\"def padding_function_{i//5}():\") elif i % 5 == 1: if self.add_line_numbers: p.add_run(f\"{self.global_line_counter:4d}: \").bold = True p.add_run(f\" # 补充函数实现，确保代码行数达到 {self.target_total_lines} 行\") elif i % 5 == 2: if self.add_line_numbers: p.add_run(f\"{self.global_line_counter:4d}: \").bold = True p.add_run(f\" value = {i} * 10\") elif i % 5 == 3: if self.add_line_numbers: p.add_run(f\"{self.global_line_counter:4d}: \").bold = True p.add_run(f\" print(f\\\"Processing data: {{{i}}}\\\")\") else: if self.add_line_numbers: p.add_run(f\"{self.global_line_counter:4d}: \").bold = True p.add_run(f\" return value + {i}\") self.total_lines += 1 self.code_lines += 1 if self.add_line_numbers: self.global_line_counter += 1 # Add separator after padding separator = self.doc.add_paragraph() separator.add_run(\"=\" * 80) self.total_lines += 1 def process(self): \"\"\" Main processing function that: 1. Finds all code files 2. Generates unified module structure (not counting in target total lines limit) 3. Formats the code with continuous line numbering (counts in target total lines limit) 4. Adds padding if needed to reach exactly target total lines 5. Creates the Word document \"\"\" self.code_files = self._find_code_files() if not self.code_files: print(f\"No files found with extensions {self.file_extensions} in {self.input_dirs}\") return False print(f\"Found {len(self.code_files)} files to process\") # Pre-scan all files to build module statistics for file_path in self.code_files: self._format_file(file_path) # Generate and add module structure (doesn't count towards target total lines) structure_lines = self._generate_module_structure() self._add_module_structure_to_document(structure_lines) # Calculate how many lines we have for code (first half) first_half_limit = self.target_total_lines // 2 # Reset global line counter to start after the structure self.global_line_counter = 1 # Process the first half of code files first_half_processed = 0 for file_path in self.code_files: if self.code_lines \u003e= first_half_limit: break print(f\"Processing first half: {file_path}\") code_lines = self._format_file(file_path) self._add_code_to_document(code_lines, file_path) first_half_processed += 1 # Second pass: Process files for the last half (second half) # For copyright requirements, we usually need the beginning and ending of the code if len(self.code_files) \u003e first_half_processed: # Start processing from where we left off to reach max pages for file_path in self.code_files[first_half_processed:]: if self.code_lines \u003e= self.target_total_lines: break print(f\"Processing second half: {file_path}\") code_lines = self._format_file(file_path) self._add_code_to_document(code_lines, file_path) # Calculate estimated pages self.code_pages = (self.code_lines + self.lines_per_page - 1) // self.lines_per_page # Add padding code if needed to reach exactly target total lines if self.code_lines \u003c self.target_total_lines: self._add_padding_code() # Recalculate code pages self.code_pages = (self.code_lines + self.lines_per_page - 1) // self.lines_per_page # Add summary section (doesn't count towards target total lines) self._add_summary_to_document() # Save the document safely self._save_document_safely() # Print summary to console self._print_summary() return True def _print_summary(self): \"\"\"Print a summary of the processed files to the console\"\"\" print(\"\\n\" + \"=\" * 80) print(\"代码处理摘要\") print(\"=\" * 80) print(f\"总文件数: {len(self.code_files)}\") print(f\"已处理文件数: {len(self.processed_files)}\") print(f\"部分处理文件数: {len(self.partially_processed_files)}\") unprocessed_count = len(self.code_files) - len(self.processed_files) - len(self.partially_processed_files) print(f\"未处理文件数: {unprocessed_count}\") print(f\"代码总行数: {self.code_lines}\") print(f\"目标代码行数: {self.target_total_lines}\") print(f\"每页行数: {self.lines_per_page}\") print(f\"代码页数: {self.code_pages}\") print(f\"文档总行数: {self.total_lines}\") if len(self.partially_processed_files) \u003e 0: print(\"\\n部分处理的文件:\") for file_path, processed_lines in sorted(self.partially_processed_files.items()): print(f\"• {file_path}: 处理了 {processed_lines} 行\") if unprocessed_count \u003e 0: print(\"\\n未处理的文件:\") count = 0 for file_path in self.code_files: if (str(file_path) not in self.processed_files and str(file_path) not in self.partially_processed_files): print(f\"• {file_path}\") count += 1 # Limit the output to avoid flooding the console if count \u003e= 10 and unprocessed_count \u003e 10: print(f\"... 以及其他 {unprocessed_count - 10} 个文件\") break print(\"=\" * 80) def _save_document_safely(self): \"\"\"Save the document using a temporary file to avoid permission issues\"\"\" temp_dir = tempfile.mkdtemp() temp_file = os.path.join(temp_dir, \"temp_document.docx\") try: # First, save to the temporary location print(f\"Saving to temporary file: {temp_file}\") self.doc.save(temp_file) # Then try to copy to the final destination try: output_dir = os.path.dirname(self.output_file) if output_dir and not os.path.exists(output_dir): os.makedirs(output_dir, exist_ok=True) shutil.copy2(temp_file, self.output_file) print(f\"Document saved to: {self.output_file}\") print(f\"Total document lines: {self.total_lines}\") print(f\"Code lines: {self.code_lines}\") print(f\"Code pages: {self.code_pages}\") except PermissionError: # If we can't write to the exact location, create an alternative alt_filename = f\"软著源代码_{datetime.datetime.now().strftime('%Y%m%d%H%M%S')}.docx\" alt_filepath = os.path.join(os.path.dirname(self.output_file) or \".\", alt_filename) shutil.copy2(temp_file, alt_filepath) print(f\"Permission denied for {self.output_file}\") print(f\"Document saved to alternative location: {alt_filepath}\") print(f\"Total document lines: {self.total_lines}\") print(f\"Code lines: {self.code_lines}\") print(f\"Code pages: {self.code_pages}\") finally: # Clean up the temporary directory try: shutil.rmtree(temp_dir) except: print(f\"Warning: Could not remove temporary directory: {temp_dir}\") def main(): parser = argparse.ArgumentParser(description='Format code files for software copyright application') parser.add_argument('--input_dirs', help='Comma-separated list of directories containing source code files', required=True) parser.add_argument('--output_file', help='Path to output Word document', required=True) parser.add_argument('--extensions', help='Comma-separated list of file extensions to include', default='.py') parser.add_argument('--title', help='Title of the software (for header)', default='软件著作权源代码') parser.add_argument('--lines-per-page', type=int, help='Number of lines per page', default=50) parser.add_argument('--max-pages', type=int, help='Maximum number of pages', default=60) parser.add_argument('--total-lines', type=int, help='Total lines of code to include (overrides max-pages if set)', default=None) parser.add_argument('--ignore', help='Comma-separated list of patterns to ignore', default='__pycache__,.git,.env,venv,.pyc,.pyo') parser.add_argument('--no-line-numbers', action='store_true', help='Do not add line number prefixes to each code line') args = parser.parse_args() # Parse input directories as comma-separated values input_dirs = [dir.strip() for dir in args.input_dirs.split(',')] extensions = [ext if ext.startswith('.') else f'.{ext}' for ext in args.extensions.split(',')] ignore_patterns = args.ignore.split(',') formatter = SoftwareCopyrightFormatter( input_dirs=input_dirs, output_file=args.output_file, file_extensions=extensions, title=args.title, lines_per_page=args.lines_per_page, max_pages=args.max_pages, total_lines=args.total_lines, ignore_patterns=ignore_patterns, add_line_numbers=not args.no_line_numbers ) formatter.process() if __name__ == '__main__': main() ","wordCount":"3464","inLanguage":"en","datePublished":"2025-10-19T13:35:25+08:00","dateModified":"2025-10-19T13:35:25+08:00","author":{"@type":"Person","name":"dwd"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://qfsyso.github.io/posts/soft-copyright/"},"publisher":{"@type":"Organization","name":"MLOG","logo":{"@type":"ImageObject","url":"https://qfsyso.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://qfsyso.github.io/ accesskey=h title="MLOG (Alt + H)">MLOG</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://qfsyso.github.io/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://qfsyso.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://qfsyso.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Soft Copyright</h1><div class=post-meta><span title='2025-10-19 13:35:25 +0800 +0800'>October 19, 2025</span>&nbsp;·&nbsp;17 min&nbsp;·&nbsp;dwd</div></header><div class=post-content><p>使用方法：vscode 安装 code web chat,配置下述提示词，选择相应的代码，输入“生成详细规范化的软件设计说明文档”，通过ai studio 进行文档生成：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>**R - Role <span style=color:#f92672>(</span>角色<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>你是一位经验丰富的软件著作权申请专家和高级软件工程师，专门负责根据现有源代码撰写符合中国版权保护中心（CPCC）规范的无界面软件设计说明书。你将严格基于提供的源代码进行分析，并使用Mermaid语法精确绘制所有必要的架构图、功能图、流程图和类图，确保图表内容的准确性和Mermaid语法的正确性。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**O - Objectives <span style=color:#f92672>(</span>目标<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1.  **生成合规文档：** 生成一份完整、专业、符合CPCC要求的无界面软件设计说明书。
</span></span><span style=display:flex><span>2.  **结构完整：** 文档结构严格遵循“鉴别材料必备组成部分”的要求，并确保每个部分内容详实、准确、具体。
</span></span><span style=display:flex><span>3.  **Mermaid图表规范：** 所有图表均使用Mermaid语法生成，并确保语法正确无误，特别是特殊字符（如 <span style=color:#e6db74>`</span><span style=color:#f92672>(</span> <span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#f92672>}</span> <span style=color:#f92672>[</span> <span style=color:#f92672>]</span> - &gt; <span style=color:#f92672>=</span> * <span style=color:#75715e># ; :` 等）在节点文本和边标签中必须使用双引号包裹。图表需有明确编号（例如：图1-1，图2-1，图2-2等）和必要的文字说明。</span>
</span></span><span style=display:flex><span>4.  **基于现有代码：** 所有设计说明、功能描述、架构图示等内容，必须严格基于对用户提供的现有源代码的深入分析，杜绝任何凭空臆测、未来展望或与代码不符的功能描述。
</span></span><span style=display:flex><span>5.  **格式符合性：**
</span></span><span style=display:flex><span>    *   确保最终文档格式意图符合：A4纵向排版，文字从左至右。
</span></span><span style=display:flex><span>    *   内容应足够详尽，以在实际打印时能满足每页不少于30行文字的要求（包含图表本身的页面除外，但图表说明文字会计入）。
</span></span><span style=display:flex><span>    *   在文档顶部明确标示页眉内容：<span style=color:#e6db74>`</span><span style=color:#f92672>[</span>软件名称<span style=color:#f92672>]</span> - 版本号：<span style=color:#f92672>[</span>版本号<span style=color:#f92672>]</span><span style=color:#e6db74>`</span>。
</span></span><span style=display:flex><span>    *   在文档开头或页脚位置，以文字说明形式体现页码要求，例如：“（注：最终文档页码位于每页右上角）”。
</span></span><span style=display:flex><span>6.  **内容纯粹性：** 最终生成的文档中不得出现任何原始的“撰写要求”、“Mermaid语法指导”、“注意事项”等元指令内容，只保留纯粹的、面向审查员的设计说明书内容。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**S - Style <span style=color:#f92672>(</span>风格<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>专业、正式、客观、技术准确、逻辑清晰、条理分明。语言为简体中文。行文应简洁明了，避免口语化表达和不必要的修饰。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**C - Content <span style=color:#f92672>(</span>内容 / 上下文<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1.  **核心分析依据：** 用户将提供的完整源代码或其核心模块的详细描述/伪代码。
</span></span><span style=display:flex><span>2.  **文档结构与内容要求 <span style=color:#f92672>(</span>鉴别材料必备组成部分<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>    *   **1. 软件概述：**
</span></span><span style=display:flex><span>        *   软件背景与用途（基于代码分析推断）
</span></span><span style=display:flex><span>        *   开发目标与特点（提炼自代码实现的功能和技术选型）
</span></span><span style=display:flex><span>        *   运行环境与技术架构（根据代码依赖、配置等确定）
</span></span><span style=display:flex><span>    *   **2. 系统架构图：**
</span></span><span style=display:flex><span>        *   使用Mermaid <span style=color:#e6db74>`</span>graph TD<span style=color:#e6db74>`</span> 绘制整体架构图。
</span></span><span style=display:flex><span>        *   清晰展示从代码分析出的各主要模块/组件之间的关系与核心数据流。
</span></span><span style=display:flex><span>        *   标明主要组件和关键接口（若适用）。
</span></span><span style=display:flex><span>    *   **3. 功能模块设计：**
</span></span><span style=display:flex><span>        *   使用Mermaid <span style=color:#e6db74>`</span>graph TD<span style=color:#e6db74>`</span> 或 <span style=color:#e6db74>`</span>flowchart TD<span style=color:#e6db74>`</span> 绘制详细的功能结构图或主要功能分解图。
</span></span><span style=display:flex><span>        *   描述从代码中分析出的各模块的具体功能与职责。
</span></span><span style=display:flex><span>        *   解释模块间的实际交互方式和调用关系。
</span></span><span style=display:flex><span>    *   **4. 核心算法与流程：**
</span></span><span style=display:flex><span>        *   针对代码中的关键业务逻辑或复杂处理，使用Mermaid <span style=color:#e6db74>`</span>flowchart TD<span style=color:#e6db74>`</span> 展示其流程。
</span></span><span style=display:flex><span>        *   详细描述核心算法的实现原理（基于代码逻辑）。
</span></span><span style=display:flex><span>        *   提供算法的输入、主要处理步骤和输出说明。
</span></span><span style=display:flex><span>    *   **5. 数据结构设计：**
</span></span><span style=display:flex><span>        *   针对代码中定义和使用的主要数据实体/对象，使用Mermaid <span style=color:#e6db74>`</span>classDiagram<span style=color:#e6db74>`</span> 展示其结构。
</span></span><span style=display:flex><span>        *   说明数据实体间的关系（如关联、继承、聚合）与关键约束。
</span></span><span style=display:flex><span>        *   提供主要数据模型的详细描述（字段、类型、含义）。
</span></span><span style=display:flex><span>    *   **6. 接口设计 <span style=color:#f92672>(</span>若适用，尤其针对有API或模块间清晰接口的软件<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>        *   使用Mermaid（例如，简单的节点连接图 <span style=color:#e6db74>`</span>graph TD<span style=color:#e6db74>`</span> 或 <span style=color:#e6db74>`</span>sequenceDiagram<span style=color:#e6db74>`</span>，根据接口特性选择）描述主要API接口结构或模块间接口。
</span></span><span style=display:flex><span>        *   说明接口的用途、主要参数、预期返回值和关键错误处理机制（基于代码实现）。
</span></span><span style=display:flex><span>        *   若能从代码中提炼，可提供简化的调用示例说明。
</span></span><span style=display:flex><span>    *   **7. 异常处理设计：**
</span></span><span style=display:flex><span>        *   针对代码中显式处理的或关键的异常情况，使用Mermaid <span style=color:#e6db74>`</span>flowchart TD<span style=color:#e6db74>`</span> 展示其处理流程。
</span></span><span style=display:flex><span>        *   说明代码中已考虑并处理的可能出现的异常情况。
</span></span><span style=display:flex><span>        *   描述系统在这些异常发生时的恢复机制或应对策略。
</span></span><span style=display:flex><span>3.  **Mermaid语法核心规则 <span style=color:#f92672>(</span>必须严格遵守<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>    *   **特殊字符处理：** 在Mermaid图表的节点文本、边标签文本中，如果包含Mermaid本身用于定义语法的特殊字符（例如 <span style=color:#e6db74>`</span><span style=color:#f92672>(</span> <span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#f92672>}</span> <span style=color:#f92672>[</span> <span style=color:#f92672>]</span> - &gt; <span style=color:#f92672>=</span> * <span style=color:#75715e># ; :` 等），**必须使用双引号将该文本包裹起来**。</span>
</span></span><span style=display:flex><span>        *   节点示例：<span style=color:#e6db74>`</span>id<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;文本(含特殊符)&#34;</span><span style=color:#f92672>]</span><span style=color:#e6db74>`</span>，<span style=color:#e6db74>`</span>id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;文本(含特殊符)&#34;</span><span style=color:#f92672>)</span><span style=color:#e6db74>`</span>，<span style=color:#e6db74>`</span>id<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;文本(含特殊符)?&#34;</span><span style=color:#f92672>}</span><span style=color:#e6db74>`</span>。
</span></span><span style=display:flex><span>        *   边标签示例：<span style=color:#e6db74>`</span>A -- <span style=color:#e6db74>&#34;调用(参数)&#34;</span> --&gt; B<span style=color:#e6db74>`</span>。
</span></span><span style=display:flex><span>    *   图表示例已在用户原始需求中提供，应作为参考。
</span></span><span style=display:flex><span>4.  **图表要求：**
</span></span><span style=display:flex><span>    *   每个图表下方必须有编号（如：<span style=color:#e6db74>`</span>图2-1 系统架构图<span style=color:#e6db74>`</span>）和对图表的简要文字说明。
</span></span><span style=display:flex><span>    *   图表内容应清晰可读，直接反映代码的实际设计，避免过于复杂或泛化。
</span></span><span style=display:flex><span>5.  **内容限制：**
</span></span><span style=display:flex><span>    *   **聚焦现有代码：** 所有描述和图表必须直接反映所提供源代码的现状和功能。
</span></span><span style=display:flex><span>    *   **无未来展望：** 不得包含对软件未来版本、计划中功能或未实现功能的讨论。
</span></span><span style=display:flex><span>    *   **无幻想内容：** 不得虚构不存在的功能、模块或技术细节。
</span></span><span style=display:flex><span>    *   **移除指令性文字：** 最终文档中不能出现“设计说明书基本要求”、“鉴别材料必备组成部分”、“Mermaid语法指导”、“注意事项”等标题或内容，这些仅为给AI的指令。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**I - Input <span style=color:#f92672>(</span>输入<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>用户将提供以下信息：
</span></span><span style=display:flex><span>1.  **软件全名：** <span style=color:#f92672>[</span>用户填写<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>2.  **软件版本号：** <span style=color:#f92672>[</span>用户填写<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>3.  **源代码：** <span style=color:#f92672>[</span>用户将在此处粘贴核心源代码片段、或提供代码库的结构概览、关键模块的伪代码或详细功能描述。AI应基于此输入进行深入分析。如果代码量巨大，用户应指明分析的重点。<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**R - Response <span style=color:#f92672>(</span>响应<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>你将输出一份完整的Markdown格式的软件设计说明书，具体包含：
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1.  **文档头部：**
</span></span><span style=display:flex><span>    *   第一行：<span style=color:#e6db74>`</span>软件名称：<span style=color:#f92672>[</span>用户提供的软件全名<span style=color:#f92672>]</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>    *   第二行：<span style=color:#e6db74>`</span>版本号：<span style=color:#f92672>[</span>用户提供的软件版本号<span style=color:#f92672>]</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>    *   第三行或独立段落：（注：最终文档页码位于每页右上角）
</span></span><span style=display:flex><span>2.  **正文结构：** 严格按照“鉴别材料必备组成部分”的七个部分组织，每个部分使用二级Markdown标题（<span style=color:#e6db74>`</span><span style=color:#75715e>##`），例如：</span>
</span></span><span style=display:flex><span>    *   <span style=color:#e6db74>`</span><span style=color:#75715e>## 1. 软件概述`</span>
</span></span><span style=display:flex><span>    *   <span style=color:#e6db74>`</span><span style=color:#75715e>## 2. 系统架构图`</span>
</span></span><span style=display:flex><span>    *   ...以此类推，直至 <span style=color:#e6db74>`</span><span style=color:#75715e>## 7. 异常处理设计`</span>
</span></span><span style=display:flex><span>3.  **图表呈现：**
</span></span><span style=display:flex><span>    *   每个图表前都有一段引导性的文字说明，解释图表的目的和内容。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    *   然后是使用三个反引号包裹的Mermaid代码块，例如：
</span></span><span style=display:flex><span>        <span style=color:#e6db74>```</span>mermaid
</span></span><span style=display:flex><span>        graph TD
</span></span><span style=display:flex><span>            A<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;模块A&#34;</span><span style=color:#f92672>]</span> --&gt; B<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;模块B (处理X)&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>```</span>
</span></span><span style=display:flex><span>    *   紧接着是图表的编号和标题，例如：<span style=color:#e6db74>`</span>**图2-1 系统架构图**<span style=color:#e6db74>`</span> <span style=color:#f92672>(</span>加粗显示<span style=color:#f92672>)</span>。
</span></span><span style=display:flex><span>    *   图表后可跟随对图表中关键元素或流程的进一步详细文字解释。
</span></span><span style=display:flex><span>4.  **内容要求：**
</span></span><span style=display:flex><span>    *   所有文字描述和图表内容均真实、准确地反映对输入源代码的分析结果。
</span></span><span style=display:flex><span>    *   内容详尽，逻辑清晰，能够充分展示软件的设计思想和实现细节。
</span></span><span style=display:flex><span>    *   无任何与现有代码无关的臆测、未来计划或通用模板性描述。
</span></span><span style=display:flex><span>    *   不包含任何原始指令中的标题或解释性文字（例如，不出现“Mermaid语法指导”这样的字眼）。
</span></span><span style=display:flex><span>    *   语言为简体中文，专业流畅。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**A - Audience <span style=color:#f92672>(</span>受众<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>中国版权保护中心（CPCC）的软件著作权审查员。他们是专业人士，期望看到一份结构清晰、内容详实、技术描述准确、图表规范、完全符合官方要求的专业软件设计文档。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**W - Workflow <span style=color:#f92672>(</span>工作流<span style=color:#f92672>)</span>:**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1.  **接收并理解输入：** 仔细阅读并理解用户提供的软件名称、版本号以及最重要的——源代码（或其替代性描述）。
</span></span><span style=display:flex><span>2.  **源代码深度分析：** 模拟对源代码的编译、阅读和理解过程。识别主要的模块、类、函数、数据结构、核心算法、业务流程、配置文件、依赖项等。
</span></span><span style=display:flex><span>3.  **信息提取与映射：** 将从代码中分析得到的信息，与“鉴别材料必备组成部分”的每一项要求进行对应和填充。
</span></span><span style=display:flex><span>4.  **逐项撰写与绘图：**
</span></span><span style=display:flex><span>    *   **软件概述：** 根据分析结果撰写背景、目标、环境、架构概览。
</span></span><span style=display:flex><span>    *   **图表设计与生成：** 对于需要图表的部分：
</span></span><span style=display:flex><span>        a.  **构思图表：** 基于代码的实际结构和逻辑，构思最能清晰表达该部分设计意图的Mermaid图（架构图、功能图、流程图、类图等）。
</span></span><span style=display:flex><span>        b.  **编写Mermaid代码：** 严格按照Mermaid语法和特殊字符处理规则编写图表代码。确保节点命名、关系连接准确反映代码。
</span></span><span style=display:flex><span>        c.  **添加编号和说明：** 为每个图表添加规范的编号（如图1-1, 图2-1, 图3-1等）和必要的文字说明。
</span></span><span style=display:flex><span>    *   **详细描述：** 围绕生成的图表和代码分析，撰写每个部分的详细文字描述，确保内容翔实、准确，并能体现软件设计的深度。
</span></span><span style=display:flex><span>5.  **格式化与审查：**
</span></span><span style=display:flex><span>    *   **内容准确性与聚焦性：** 严格检查所有描述和图表是否完全基于现有代码，删除所有推测、未来计划或与代码不符的内容。
</span></span><span style=display:flex><span>    *   **完整性检查：** 确保所有“鉴别材料必备组成部分”都已覆盖，且内容充分。
</span></span><span style=display:flex><span>    *   **Mermaid语法校验：** 仔细检查所有Mermaid代码块的语法，特别是特殊字符转义。
</span></span><span style=display:flex><span>    *   **指令移除：** 确保最终输出中不包含提示词中的指令性文字、标题或解释（例如，不应出现“鉴别材料必备组成部分”这个列表本身）。
</span></span><span style=display:flex><span>    *   **格式符合性：** 确认页眉信息、页码说明已按要求添加。检查整体行文风格是否专业正式。
</span></span><span style=display:flex><span>6.  **输出最终文档：** 生成结构完整、内容准确、符合要求的Markdown格式软件设计说明书。
</span></span></code></pre></div><p>代码整理</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> argparse
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> tempfile
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> shutil
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pathlib <span style=color:#f92672>import</span> Path
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> docx <span style=color:#f92672>import</span> Document
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> docx.shared <span style=color:#f92672>import</span> Pt, Inches
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> docx.enum.text <span style=color:#f92672>import</span> WD_LINE_SPACING, WD_ALIGN_PARAGRAPH
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> docx.oxml.ns <span style=color:#f92672>import</span> qn
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> docx.oxml <span style=color:#f92672>import</span> OxmlElement
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SoftwareCopyrightFormatter</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, input_dirs, output_file, file_extensions<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, title<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, 
</span></span><span style=display:flex><span>                 lines_per_page<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>, max_pages<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>, total_lines<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, ignore_patterns<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>                 add_line_numbers<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Initialize the formatter with configuration parameters.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            input_dirs (list): List of directories containing source code files
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            output_file (str): Path to output Word document
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            file_extensions (list): List of file extensions to include (e.g., [&#39;.py&#39;, &#39;.js&#39;])
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            title (str): Title of the software (for header)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            lines_per_page (int): Number of lines per page
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            max_pages (int): Maximum number of pages (default 60)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            total_lines (int): Total lines of code to include (overrides max_pages if set)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ignore_patterns (list): List of regex patterns to ignore files/folders
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            add_line_numbers (bool): Whether to add line number prefixes to each code line
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>input_dirs <span style=color:#f92672>=</span> [Path(d) <span style=color:#66d9ef>for</span> d <span style=color:#f92672>in</span> input_dirs]
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Make sure output_file is a proper file path, not a directory</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>output_file <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_validate_output_path(output_file)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>file_extensions <span style=color:#f92672>=</span> file_extensions <span style=color:#f92672>or</span> [<span style=color:#e6db74>&#39;.py&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> title <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;软件著作权源代码&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>=</span> lines_per_page
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>max_pages <span style=color:#f92672>=</span> max_pages
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># If total_lines is specified, it overrides max_pages</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>target_total_lines <span style=color:#f92672>=</span> total_lines <span style=color:#66d9ef>if</span> total_lines <span style=color:#66d9ef>else</span> (max_pages <span style=color:#f92672>*</span> lines_per_page)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>ignore_patterns <span style=color:#f92672>=</span> ignore_patterns <span style=color:#f92672>or</span> [<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;__pycache__&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;\.git&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;\.env&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;venv&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;\.pyc$&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;\.pyo$&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>add_line_numbers <span style=color:#f92672>=</span> add_line_numbers
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Separate counters for code and non-code contents</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>  <span style=color:#75715e># Total lines in document</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>   <span style=color:#75715e># Only code lines (to enforce target total lines)</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>current_page <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>doc <span style=color:#f92672>=</span> Document()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>code_files <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>module_stats <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: {<span style=color:#e6db74>&#39;files&#39;</span>: <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;lines&#39;</span>: <span style=color:#ae81ff>0</span>})
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>global_line_counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e># Global line counter for continuous numbering</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Tracking processed files</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>processed_files <span style=color:#f92672>=</span> set()  <span style=color:#75715e># Files that were processed</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>partially_processed_files <span style=color:#f92672>=</span> {}  <span style=color:#75715e># Files that were partially processed</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Configure document style</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_setup_document()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_validate_output_path</span>(self, output_path):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Validate the output file path and ensure it&#39;s a file, not a directory
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        path <span style=color:#f92672>=</span> Path(output_path)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># If it&#39;s a directory, create a default filename in that directory</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> path<span style=color:#f92672>.</span>is_dir():
</span></span><span style=display:flex><span>            timestamp <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>%H%M%S&#34;</span>)
</span></span><span style=display:flex><span>            path <span style=color:#f92672>=</span> path <span style=color:#f92672>/</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;软件著作权代码_</span><span style=color:#e6db74>{</span>timestamp<span style=color:#e6db74>}</span><span style=color:#e6db74>.docx&#34;</span>
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Output path is a directory. Using file: </span><span style=color:#e6db74>{</span>path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Make sure parent directory exists</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> path<span style=color:#f92672>.</span>parent<span style=color:#f92672>.</span>exists():
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Creating parent directory: </span><span style=color:#e6db74>{</span>path<span style=color:#f92672>.</span>parent<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            path<span style=color:#f92672>.</span>parent<span style=color:#f92672>.</span>mkdir(parents<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> str(path)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_create_element</span>(self, name):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Create an element with proper namespace&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> OxmlElement(name)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_create_page_number_field</span>(self, paragraph):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Create a page number field in a paragraph&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        run <span style=color:#f92672>=</span> paragraph<span style=color:#f92672>.</span>add_run()
</span></span><span style=display:flex><span>        fldChar1 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_create_element(<span style=color:#e6db74>&#39;w:fldChar&#39;</span>)
</span></span><span style=display:flex><span>        fldChar1<span style=color:#f92672>.</span>set(qn(<span style=color:#e6db74>&#39;w:fldCharType&#39;</span>), <span style=color:#e6db74>&#39;begin&#39;</span>)
</span></span><span style=display:flex><span>        run<span style=color:#f92672>.</span>_element<span style=color:#f92672>.</span>append(fldChar1)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        instrText <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_create_element(<span style=color:#e6db74>&#39;w:instrText&#39;</span>)
</span></span><span style=display:flex><span>        instrText<span style=color:#f92672>.</span>set(qn(<span style=color:#e6db74>&#39;xml:space&#39;</span>), <span style=color:#e6db74>&#39;preserve&#39;</span>)
</span></span><span style=display:flex><span>        instrText<span style=color:#f92672>.</span>text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;PAGE&#39;</span>
</span></span><span style=display:flex><span>        run<span style=color:#f92672>.</span>_element<span style=color:#f92672>.</span>append(instrText)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        fldChar2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_create_element(<span style=color:#e6db74>&#39;w:fldChar&#39;</span>)
</span></span><span style=display:flex><span>        fldChar2<span style=color:#f92672>.</span>set(qn(<span style=color:#e6db74>&#39;w:fldCharType&#39;</span>), <span style=color:#e6db74>&#39;end&#39;</span>)
</span></span><span style=display:flex><span>        run<span style=color:#f92672>.</span>_element<span style=color:#f92672>.</span>append(fldChar2)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_setup_document</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Configure Word document style settings with wider spacing to target specified lines per page&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Set default font to SimSun (宋体) with size 小五 (9pt)</span>
</span></span><span style=display:flex><span>        style <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>styles[<span style=color:#e6db74>&#39;Normal&#39;</span>]
</span></span><span style=display:flex><span>        style<span style=color:#f92672>.</span>font<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SimSun&#39;</span>
</span></span><span style=display:flex><span>        style<span style=color:#f92672>.</span>font<span style=color:#f92672>.</span>size <span style=color:#f92672>=</span> Pt(<span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Calculate line spacing based on lines_per_page</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># More lines per page -&gt; smaller line spacing</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># This is an approximation and may need tuning</span>
</span></span><span style=display:flex><span>        line_spacing_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>50</span>:
</span></span><span style=display:flex><span>            line_spacing_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>55</span>:
</span></span><span style=display:flex><span>            line_spacing_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.9</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>60</span>:
</span></span><span style=display:flex><span>            line_spacing_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.8</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>45</span>:
</span></span><span style=display:flex><span>            line_spacing_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.2</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>40</span>:
</span></span><span style=display:flex><span>            line_spacing_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.3</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#75715e># Adjust line spacing to target specified lines per page</span>
</span></span><span style=display:flex><span>        style<span style=color:#f92672>.</span>paragraph_format<span style=color:#f92672>.</span>line_spacing <span style=color:#f92672>=</span> line_spacing_factor
</span></span><span style=display:flex><span>        style<span style=color:#f92672>.</span>paragraph_format<span style=color:#f92672>.</span>line_spacing_rule <span style=color:#f92672>=</span> WD_LINE_SPACING<span style=color:#f92672>.</span>MULTIPLE
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add moderate paragraph spacing to help control pages</span>
</span></span><span style=display:flex><span>        style<span style=color:#f92672>.</span>paragraph_format<span style=color:#f92672>.</span>space_before <span style=color:#f92672>=</span> Pt(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        style<span style=color:#f92672>.</span>paragraph_format<span style=color:#f92672>.</span>space_after <span style=color:#f92672>=</span> Pt(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        style<span style=color:#f92672>.</span>paragraph_format<span style=color:#f92672>.</span>alignment <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>  <span style=color:#75715e># Left alignment</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Adjust margins based on lines_per_page</span>
</span></span><span style=display:flex><span>        margin_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.6</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>50</span>:
</span></span><span style=display:flex><span>            margin_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>45</span>:
</span></span><span style=display:flex><span>            margin_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.7</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#75715e># Set margins</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> section <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>sections:
</span></span><span style=display:flex><span>            section<span style=color:#f92672>.</span>top_margin <span style=color:#f92672>=</span> Inches(margin_factor)    
</span></span><span style=display:flex><span>            section<span style=color:#f92672>.</span>bottom_margin <span style=color:#f92672>=</span> Inches(margin_factor) 
</span></span><span style=display:flex><span>            section<span style=color:#f92672>.</span>left_margin <span style=color:#f92672>=</span> Inches(margin_factor)   
</span></span><span style=display:flex><span>            section<span style=color:#f92672>.</span>right_margin <span style=color:#f92672>=</span> Inches(margin_factor)  
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add a header with software title</span>
</span></span><span style=display:flex><span>        section <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>sections[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        header <span style=color:#f92672>=</span> section<span style=color:#f92672>.</span>header
</span></span><span style=display:flex><span>        header_para <span style=color:#f92672>=</span> header<span style=color:#f92672>.</span>paragraphs[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        header_para<span style=color:#f92672>.</span>text <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>title
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add a footer with proper page number field</span>
</span></span><span style=display:flex><span>        footer <span style=color:#f92672>=</span> section<span style=color:#f92672>.</span>footer
</span></span><span style=display:flex><span>        footer_para <span style=color:#f92672>=</span> footer<span style=color:#f92672>.</span>paragraphs[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        footer_para<span style=color:#f92672>.</span>text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;第 &#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_create_page_number_field(footer_para)
</span></span><span style=display:flex><span>        footer_para<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34; 页&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Document configured for approximately </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>lines_per_page<span style=color:#e6db74>}</span><span style=color:#e6db74> lines per page&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Targeting total of </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>target_total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74> code lines&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_should_ignore</span>(self, path):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Check if the path should be ignored based on ignore patterns&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        path_str <span style=color:#f92672>=</span> str(path)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> pattern <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>ignore_patterns:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> re<span style=color:#f92672>.</span>search(pattern, path_str):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_clean_code</span>(self, code_text, file_ext):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Clean the code by removing comments and empty lines.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Handles different programming languages based on file extension.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            code_text (str): Raw code text
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            file_ext (str): File extension to determine comment style
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            str: Cleaned code text
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Remove any copyright text first (before comment removal)</span>
</span></span><span style=display:flex><span>        lines <span style=color:#f92672>=</span> code_text<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        lines <span style=color:#f92672>=</span> [line <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;copyright&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> line<span style=color:#f92672>.</span>lower()]
</span></span><span style=display:flex><span>        code_text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>join(lines)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> file_ext <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;.py&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Python-specific cleaning</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Remove multi-line comments (triple quotes)</span>
</span></span><span style=display:flex><span>            code_text <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&#34;&#34;&#34;.*?&#34;&#34;&#34;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, code_text, flags<span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>DOTALL)
</span></span><span style=display:flex><span>            code_text <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;&#39;&#39;&#39;.*?&#39;&#39;&#39;&#34;</span>, <span style=color:#e6db74>&#39;&#39;</span>, code_text, flags<span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>DOTALL)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Remove single-line comments</span>
</span></span><span style=display:flex><span>            code_text <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;#.*$&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, code_text, flags<span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>MULTILINE)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> file_ext <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;.js&#39;</span>, <span style=color:#e6db74>&#39;.java&#39;</span>, <span style=color:#e6db74>&#39;.c&#39;</span>, <span style=color:#e6db74>&#39;.cpp&#39;</span>, <span style=color:#e6db74>&#39;.cs&#39;</span>, <span style=color:#e6db74>&#39;.php&#39;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#75715e># C-style comments</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Remove multi-line comments (/* */)</span>
</span></span><span style=display:flex><span>            code_text <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;/\*.*?\*/&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, code_text, flags<span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>DOTALL)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Remove single-line comments (//)</span>
</span></span><span style=display:flex><span>            code_text <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;//.*$&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, code_text, flags<span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>MULTILINE)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> file_ext <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;.html&#39;</span>, <span style=color:#e6db74>&#39;.xml&#39;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#75715e># HTML/XML comments</span>
</span></span><span style=display:flex><span>            code_text <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;!--.*?--&gt;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, code_text, flags<span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>DOTALL)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Remove empty lines for all file types</span>
</span></span><span style=display:flex><span>        lines <span style=color:#f92672>=</span> [line<span style=color:#f92672>.</span>rstrip() <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> code_text<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)]
</span></span><span style=display:flex><span>        lines <span style=color:#f92672>=</span> [line <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines <span style=color:#66d9ef>if</span> line<span style=color:#f92672>.</span>strip()]
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>join(lines)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_format_file</span>(self, file_path):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Read a file, clean its contents, and return formatted code lines&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>with</span> open(file_path, <span style=color:#e6db74>&#39;r&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>                content <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            file_ext <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>suffix<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>            cleaned_content <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_clean_code(content, file_ext)
</span></span><span style=display:flex><span>            lines <span style=color:#f92672>=</span> cleaned_content<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Extract module info from path - determine the module based on the input directory</span>
</span></span><span style=display:flex><span>            module_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> input_dir <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>input_dirs:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    rel_path <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>relative_to(input_dir)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> rel_path<span style=color:#f92672>.</span>parts:
</span></span><span style=display:flex><span>                        module_name <span style=color:#f92672>=</span> rel_path<span style=color:#f92672>.</span>parts[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>                    <span style=color:#75715e># Not relative to this input directory</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> module_name:
</span></span><span style=display:flex><span>                <span style=color:#75715e># Fallback - use the parent directory name</span>
</span></span><span style=display:flex><span>                module_name <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>parent<span style=color:#f92672>.</span>name <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;root&#34;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Update module statistics</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>module_stats[module_name][<span style=color:#e6db74>&#39;files&#39;</span>] <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>module_stats[module_name][<span style=color:#e6db74>&#39;lines&#39;</span>] <span style=color:#f92672>+=</span> len(lines)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> lines
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>UnicodeDecodeError</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Try with a different encoding if UTF-8 fails</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>with</span> open(file_path, <span style=color:#e6db74>&#39;r&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;latin-1&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>                    content <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>                file_ext <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>suffix<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>                cleaned_content <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_clean_code(content, file_ext)
</span></span><span style=display:flex><span>                lines <span style=color:#f92672>=</span> cleaned_content<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e># Extract module info and update statistics (same as above)</span>
</span></span><span style=display:flex><span>                module_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> input_dir <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>input_dirs:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                        rel_path <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>relative_to(input_dir)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> rel_path<span style=color:#f92672>.</span>parts:
</span></span><span style=display:flex><span>                            module_name <span style=color:#f92672>=</span> rel_path<span style=color:#f92672>.</span>parts[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> module_name:
</span></span><span style=display:flex><span>                    module_name <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>parent<span style=color:#f92672>.</span>name <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;root&#34;</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>module_stats[module_name][<span style=color:#e6db74>&#39;files&#39;</span>] <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>module_stats[module_name][<span style=color:#e6db74>&#39;lines&#39;</span>] <span style=color:#f92672>+=</span> len(lines)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> lines
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Warning: Could not process file </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error processing </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> []
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_find_code_files</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Find all code files in the input directories matching the specified extensions
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        and not matching ignore patterns.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            list: List of Path objects to code files
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        code_files <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> input_dir <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>input_dirs:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Scanning directory: </span><span style=color:#e6db74>{</span>input_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> input_dir<span style=color:#f92672>.</span>exists():
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Warning: Directory </span><span style=color:#e6db74>{</span>input_dir<span style=color:#e6db74>}</span><span style=color:#e6db74> does not exist, skipping&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> ext <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>file_extensions:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> file_path <span style=color:#f92672>in</span> input_dir<span style=color:#f92672>.</span>glob(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;**/*</span><span style=color:#e6db74>{</span>ext<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>):
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>_should_ignore(file_path):
</span></span><span style=display:flex><span>                        code_files<span style=color:#f92672>.</span>append(file_path)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Sort files to prioritize entry points or main files</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># This helps ensure the first page contains important entry code</span>
</span></span><span style=display:flex><span>        priority_patterns <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;main\.py&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;app\.py&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;index\.py&#39;</span>, 
</span></span><span style=display:flex><span>            <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;__main__\.py&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;server\.py&#39;</span>, <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;__init__\.py&#39;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_priority</span>(file_path):
</span></span><span style=display:flex><span>            file_name <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>name
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i, pattern <span style=color:#f92672>in</span> enumerate(priority_patterns):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> re<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(pattern, file_name):
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> i
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> len(priority_patterns)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Sort first by priority patterns, then by input directory order,</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># then by directory depth (shallower first), then by filename</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_input_dir_index</span>(file_path):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i, input_dir <span style=color:#f92672>in</span> enumerate(self<span style=color:#f92672>.</span>input_dirs):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    file_path<span style=color:#f92672>.</span>relative_to(input_dir)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> i
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> len(self<span style=color:#f92672>.</span>input_dirs)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        code_files<span style=color:#f92672>.</span>sort(key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> f: (
</span></span><span style=display:flex><span>            get_priority(f),
</span></span><span style=display:flex><span>            get_input_dir_index(f),
</span></span><span style=display:flex><span>            len(str(f)<span style=color:#f92672>.</span>split(os<span style=color:#f92672>.</span>sep)),
</span></span><span style=display:flex><span>            str(f)
</span></span><span style=display:flex><span>        ))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> code_files
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_build_directory_tree</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Build a unified directory tree structure from all input directories
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            dict: A nested dictionary representing the directory tree
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        tree <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: {<span style=color:#e6db74>&#34;files&#34;</span>: [], <span style=color:#e6db74>&#34;subdirs&#34;</span>: defaultdict(dict)})
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Group files by input directory first</span>
</span></span><span style=display:flex><span>        input_dir_files <span style=color:#f92672>=</span> defaultdict(list)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> file_path <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>code_files:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i, input_dir <span style=color:#f92672>in</span> enumerate(self<span style=color:#f92672>.</span>input_dirs):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    rel_path <span style=color:#f92672>=</span> file_path<span style=color:#f92672>.</span>relative_to(input_dir)
</span></span><span style=display:flex><span>                    input_dir_files[i]<span style=color:#f92672>.</span>append((rel_path, file_path))
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Process each input directory&#39;s files</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, files <span style=color:#f92672>in</span> sorted(input_dir_files<span style=color:#f92672>.</span>items()):
</span></span><span style=display:flex><span>            input_dir <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>input_dirs[i]
</span></span><span style=display:flex><span>            input_dir_name <span style=color:#f92672>=</span> input_dir<span style=color:#f92672>.</span>name
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Add this input directory as a top-level node</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> input_dir_name <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> tree:
</span></span><span style=display:flex><span>                tree[input_dir_name] <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;files&#34;</span>: [], <span style=color:#e6db74>&#34;subdirs&#34;</span>: defaultdict(dict)}
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Process files in this input directory</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> rel_path, abs_path <span style=color:#f92672>in</span> files:
</span></span><span style=display:flex><span>                current <span style=color:#f92672>=</span> tree[input_dir_name]
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e># Navigate through the directory hierarchy</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> part <span style=color:#f92672>in</span> rel_path<span style=color:#f92672>.</span>parts[:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;subdirs&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> current:
</span></span><span style=display:flex><span>                        current[<span style=color:#e6db74>&#34;subdirs&#34;</span>] <span style=color:#f92672>=</span> defaultdict(dict)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> part <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> current[<span style=color:#e6db74>&#34;subdirs&#34;</span>]:
</span></span><span style=display:flex><span>                        current[<span style=color:#e6db74>&#34;subdirs&#34;</span>][part] <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;files&#34;</span>: [], <span style=color:#e6db74>&#34;subdirs&#34;</span>: defaultdict(dict)}
</span></span><span style=display:flex><span>                    current <span style=color:#f92672>=</span> current[<span style=color:#e6db74>&#34;subdirs&#34;</span>][part]
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e># Add the file to the current directory</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;files&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> current:
</span></span><span style=display:flex><span>                    current[<span style=color:#e6db74>&#34;files&#34;</span>] <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>                current[<span style=color:#e6db74>&#34;files&#34;</span>]<span style=color:#f92672>.</span>append(abs_path)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> tree
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_generate_module_structure</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Generate a combined structured representation of all project modules
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            list: Text representation of the module structure
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Build a unified directory tree</span>
</span></span><span style=display:flex><span>        tree <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_build_directory_tree()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Create a tree-like structure</span>
</span></span><span style=display:flex><span>        structure_lines <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>title<span style=color:#e6db74>}</span><span style=color:#e6db74> 模块结构&#34;</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;生成日期: </span><span style=color:#e6db74>{</span>datetime<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74> %H:%M:%S&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;总文件数: </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>code_files)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;支持文件类型: </span><span style=color:#e6db74>{</span><span style=color:#e6db74>&#39;, &#39;</span><span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>file_extensions)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;包含目录: </span><span style=color:#e6db74>{</span><span style=color:#e6db74>&#39;, &#39;</span><span style=color:#f92672>.</span>join([str(d) <span style=color:#66d9ef>for</span> d <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>input_dirs])<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Process the tree recursively</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_add_tree_to_structure(structure_lines, tree, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add module statistics</span>
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;模块统计&#34;</span>)
</span></span><span style=display:flex><span>        structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> module, stats <span style=color:#f92672>in</span> sorted(self<span style=color:#f92672>.</span>module_stats<span style=color:#f92672>.</span>items()):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> module:  <span style=color:#75715e># Skip empty module names</span>
</span></span><span style=display:flex><span>                structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>module<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>stats[<span style=color:#e6db74>&#39;files&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> 文件, </span><span style=color:#e6db74>{</span>stats[<span style=color:#e6db74>&#39;lines&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> 行代码&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> structure_lines
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_add_tree_to_structure</span>(self, structure_lines, tree, prefix<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, is_root<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Recursively add directory tree to structure lines
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            structure_lines (list): List to append lines to
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            tree (dict): Directory tree structure
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            prefix (str): Prefix for the current line (for indentation)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            is_root (bool): Whether this is the root level
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Process top-level directories</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_root:
</span></span><span style=display:flex><span>            top_dirs <span style=color:#f92672>=</span> sorted(tree<span style=color:#f92672>.</span>keys())
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i, dir_name <span style=color:#f92672>in</span> enumerate(top_dirs):
</span></span><span style=display:flex><span>                is_last <span style=color:#f92672>=</span> i <span style=color:#f92672>==</span> len(top_dirs) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                dir_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;└── &#34;</span> <span style=color:#66d9ef>if</span> is_last <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#34;├── &#34;</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>prefix<span style=color:#e6db74>}{</span>dir_prefix<span style=color:#e6db74>}{</span>dir_name<span style=color:#e6db74>}</span><span style=color:#e6db74>/&#34;</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                next_prefix <span style=color:#f92672>=</span> prefix <span style=color:#f92672>+</span> (<span style=color:#e6db74>&#34;    &#34;</span> <span style=color:#66d9ef>if</span> is_last <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#34;│   &#34;</span>)
</span></span><span style=display:flex><span>                dir_tree <span style=color:#f92672>=</span> tree[dir_name]
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e># Process files in this directory</span>
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>_add_files_to_structure(structure_lines, dir_tree<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;files&#34;</span>, []), next_prefix, 
</span></span><span style=display:flex><span>                                             <span style=color:#f92672>not</span> dir_tree<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;subdirs&#34;</span>))
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e># Process subdirectories</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;subdirs&#34;</span> <span style=color:#f92672>in</span> dir_tree <span style=color:#f92672>and</span> dir_tree[<span style=color:#e6db74>&#34;subdirs&#34;</span>]:
</span></span><span style=display:flex><span>                    subdirs <span style=color:#f92672>=</span> dir_tree[<span style=color:#e6db74>&#34;subdirs&#34;</span>]
</span></span><span style=display:flex><span>                    self<span style=color:#f92672>.</span>_add_subdirs_to_structure(structure_lines, subdirs, next_prefix)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Process subdirectories</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;subdirs&#34;</span> <span style=color:#f92672>in</span> tree <span style=color:#f92672>and</span> tree[<span style=color:#e6db74>&#34;subdirs&#34;</span>]:
</span></span><span style=display:flex><span>                subdirs <span style=color:#f92672>=</span> tree[<span style=color:#e6db74>&#34;subdirs&#34;</span>]
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>_add_subdirs_to_structure(structure_lines, subdirs, prefix)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Process files in this directory</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_add_files_to_structure(structure_lines, tree<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;files&#34;</span>, []), prefix, <span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_add_files_to_structure</span>(self, structure_lines, files, prefix, is_last_level):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Add files to the structure with proper formatting&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        sorted_files <span style=color:#f92672>=</span> sorted([f<span style=color:#f92672>.</span>name <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> files])
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, file_name <span style=color:#f92672>in</span> enumerate(sorted_files):
</span></span><span style=display:flex><span>            is_last_file <span style=color:#f92672>=</span> i <span style=color:#f92672>==</span> len(sorted_files) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            file_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;└── &#34;</span> <span style=color:#66d9ef>if</span> is_last_file <span style=color:#f92672>and</span> is_last_level <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#34;├── &#34;</span>
</span></span><span style=display:flex><span>            structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>prefix<span style=color:#e6db74>}{</span>file_prefix<span style=color:#e6db74>}{</span>file_name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_add_subdirs_to_structure</span>(self, structure_lines, subdirs, prefix):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Add subdirectories to the structure with proper formatting&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        sorted_subdirs <span style=color:#f92672>=</span> sorted(subdirs<span style=color:#f92672>.</span>keys())
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, subdir_name <span style=color:#f92672>in</span> enumerate(sorted_subdirs):
</span></span><span style=display:flex><span>            is_last <span style=color:#f92672>=</span> i <span style=color:#f92672>==</span> len(sorted_subdirs) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            dir_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;└── &#34;</span> <span style=color:#66d9ef>if</span> is_last <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#34;├── &#34;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            structure_lines<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>prefix<span style=color:#e6db74>}{</span>dir_prefix<span style=color:#e6db74>}{</span>subdir_name<span style=color:#e6db74>}</span><span style=color:#e6db74>/&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            next_prefix <span style=color:#f92672>=</span> prefix <span style=color:#f92672>+</span> (<span style=color:#e6db74>&#34;    &#34;</span> <span style=color:#66d9ef>if</span> is_last <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#34;│   &#34;</span>)
</span></span><span style=display:flex><span>            subdir_tree <span style=color:#f92672>=</span> subdirs[subdir_name]
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Process files in this directory</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_add_files_to_structure(structure_lines, subdir_tree<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;files&#34;</span>, []), next_prefix, 
</span></span><span style=display:flex><span>                                         <span style=color:#f92672>not</span> subdir_tree<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;subdirs&#34;</span>))
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Process further subdirectories</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;subdirs&#34;</span> <span style=color:#f92672>in</span> subdir_tree <span style=color:#f92672>and</span> subdir_tree[<span style=color:#e6db74>&#34;subdirs&#34;</span>]:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>_add_subdirs_to_structure(structure_lines, subdir_tree[<span style=color:#e6db74>&#34;subdirs&#34;</span>], next_prefix)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_add_code_to_document</span>(self, code_lines, file_path):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Add code lines to the document with continuous line numbering
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        across all files.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Don&#39;t count this in the target total lines limit, but do track it for total document</span>
</span></span><span style=display:flex><span>        file_header <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        file_header<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;文件: </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add each line with line number from global counter</span>
</span></span><span style=display:flex><span>        line_count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        original_line_count <span style=color:#f92672>=</span> len(code_lines)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> code_lines:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Check if we&#39;ve reached the code limit (target total lines)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>&gt;=</span> self<span style=color:#f92672>.</span>target_total_lines:
</span></span><span style=display:flex><span>                <span style=color:#75715e># File was partially processed</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> line_count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                    self<span style=color:#f92672>.</span>partially_processed_files[str(file_path)] <span style=color:#f92672>=</span> line_count
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>            <span style=color:#75715e># Create paragraph for code line</span>
</span></span><span style=display:flex><span>            p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Add line number and code</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>global_line_counter<span style=color:#e6db74>:</span><span style=color:#e6db74>4d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: &#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span>add_run(line)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            line_count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e># Track code lines separately</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>global_line_counter <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add separator after each file - don&#39;t count in code lines</span>
</span></span><span style=display:flex><span>        separator <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        separator<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Track file processing status</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> line_count <span style=color:#f92672>==</span> original_line_count:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>processed_files<span style=color:#f92672>.</span>add(str(file_path))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> line_count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>partially_processed_files[str(file_path)] <span style=color:#f92672>=</span> line_count
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> line_count
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_add_module_structure_to_document</span>(self, structure_lines):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Add the module structure to the document&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add title - don&#39;t count towards code line limit</span>
</span></span><span style=display:flex><span>        title <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_heading(<span style=color:#e6db74>&#39;软件模块结构&#39;</span>, level<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        title<span style=color:#f92672>.</span>alignment <span style=color:#f92672>=</span> WD_ALIGN_PARAGRAPH<span style=color:#f92672>.</span>CENTER
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add structure lines - don&#39;t count towards code line limit</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> structure_lines:
</span></span><span style=display:flex><span>            p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span>add_run(line)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add separator - don&#39;t count towards code line limit</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_add_summary_to_document</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Add a summary section at the end of the document&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add title - don&#39;t count towards code line limit</span>
</span></span><span style=display:flex><span>        title <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_heading(<span style=color:#e6db74>&#39;代码处理摘要&#39;</span>, level<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        title<span style=color:#f92672>.</span>alignment <span style=color:#f92672>=</span> WD_ALIGN_PARAGRAPH<span style=color:#f92672>.</span>CENTER
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add summary info - don&#39;t count towards code line limit</span>
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;总文件数: </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>code_files)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;已处理文件数: </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>processed_files)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;部分处理文件数: </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>partially_processed_files)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        unprocessed_count <span style=color:#f92672>=</span> len(self<span style=color:#f92672>.</span>code_files) <span style=color:#f92672>-</span> len(self<span style=color:#f92672>.</span>processed_files) <span style=color:#f92672>-</span> len(self<span style=color:#f92672>.</span>partially_processed_files)
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;未处理文件数: </span><span style=color:#e6db74>{</span>unprocessed_count<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add page stats</span>
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;代码总行数: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>code_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        estimated_pages <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>//</span> self<span style=color:#f92672>.</span>lines_per_page
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;代码页数: </span><span style=color:#e6db74>{</span>estimated_pages<span style=color:#e6db74>}</span><span style=color:#e6db74> (每页 </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>lines_per_page<span style=color:#e6db74>}</span><span style=color:#e6db74> 行)&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add configuration info</span>
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;目标代码行数: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>target_total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add separator - don&#39;t count towards code line limit</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># If there are partially processed files, list them</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>partially_processed_files:
</span></span><span style=display:flex><span>            p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;部分处理的文件:&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> file_path, processed_lines <span style=color:#f92672>in</span> sorted(self<span style=color:#f92672>.</span>partially_processed_files<span style=color:#f92672>.</span>items()):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>with</span> open(file_path, <span style=color:#e6db74>&#39;r&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>, errors<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ignore&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                        total_lines <span style=color:#f92672>=</span> len(self<span style=color:#f92672>.</span>_clean_code(f<span style=color:#f92672>.</span>read(), Path(file_path)<span style=color:#f92672>.</span>suffix<span style=color:#f92672>.</span>lower())<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>                        total_lines <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;未知&#34;</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;• </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>: 处理了 </span><span style=color:#e6db74>{</span>processed_lines<span style=color:#e6db74>}</span><span style=color:#e6db74> 行，共 </span><span style=color:#e6db74>{</span>total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74> 行&#34;</span>)
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># If there are unprocessed files, list them</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> unprocessed_count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;未处理的文件:&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> file_path <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>code_files:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (str(file_path) <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>processed_files <span style=color:#f92672>and</span> 
</span></span><span style=display:flex><span>                    str(file_path) <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>partially_processed_files):
</span></span><span style=display:flex><span>                    p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>                    p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;• </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add note about prioritized files</span>
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;注：&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;以下类型的文件被优先处理：main.py, app.py, index.py, __main__.py, server.py, __init__.py&#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_add_padding_code</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Add padding code to reach exactly the target total lines&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Calculate lines needed to reach exactly target total lines</span>
</span></span><span style=display:flex><span>        lines_to_add <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>target_total_lines <span style=color:#f92672>-</span> self<span style=color:#f92672>.</span>code_lines
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> lines_to_add <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>  <span style=color:#75715e># No padding needed</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Adding </span><span style=color:#e6db74>{</span>lines_to_add<span style=color:#e6db74>}</span><span style=color:#e6db74> padding lines to reach exactly </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>target_total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74> total code lines&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add padding header</span>
</span></span><span style=display:flex><span>        file_header <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        file_header<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;文件: 补充代码&#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add padding lines</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(lines_to_add):
</span></span><span style=display:flex><span>            p <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>            <span style=color:#75715e># Generate some &#34;meaningful&#34; looking padding code that varies</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                    p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>global_line_counter<span style=color:#e6db74>:</span><span style=color:#e6db74>4d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: &#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;def padding_function_</span><span style=color:#e6db74>{</span>i<span style=color:#f92672>//</span><span style=color:#ae81ff>5</span><span style=color:#e6db74>}</span><span style=color:#e6db74>():&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                    p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>global_line_counter<span style=color:#e6db74>:</span><span style=color:#e6db74>4d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: &#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;    # 补充函数实现，确保代码行数达到 </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>target_total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74> 行&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                    p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>global_line_counter<span style=color:#e6db74>:</span><span style=color:#e6db74>4d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: &#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;    value = </span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74> * 10&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                    p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>global_line_counter<span style=color:#e6db74>:</span><span style=color:#e6db74>4d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: &#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;    print(f</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>Processing data: </span><span style=color:#ae81ff>{{</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#ae81ff>}}\&#34;</span><span style=color:#e6db74>)&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                    p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>global_line_counter<span style=color:#e6db74>:</span><span style=color:#e6db74>4d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: &#34;</span>)<span style=color:#f92672>.</span>bold <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                p<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;    return value + </span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>add_line_numbers:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>global_line_counter <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add separator after padding</span>
</span></span><span style=display:flex><span>        separator <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>add_paragraph()
</span></span><span style=display:flex><span>        separator<span style=color:#f92672>.</span>add_run(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_lines <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>process</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Main processing function that:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        1. Finds all code files
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        2. Generates unified module structure (not counting in target total lines limit)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        3. Formats the code with continuous line numbering (counts in target total lines limit)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        4. Adds padding if needed to reach exactly target total lines
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        5. Creates the Word document
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>code_files <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_find_code_files()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>code_files:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;No files found with extensions </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>file_extensions<span style=color:#e6db74>}</span><span style=color:#e6db74> in </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>input_dirs<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>code_files)<span style=color:#e6db74>}</span><span style=color:#e6db74> files to process&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Pre-scan all files to build module statistics</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> file_path <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>code_files:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_format_file(file_path)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Generate and add module structure (doesn&#39;t count towards target total lines)</span>
</span></span><span style=display:flex><span>        structure_lines <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_generate_module_structure()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_add_module_structure_to_document(structure_lines)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Calculate how many lines we have for code (first half)</span>
</span></span><span style=display:flex><span>        first_half_limit <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>target_total_lines <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Reset global line counter to start after the structure</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>global_line_counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Process the first half of code files</span>
</span></span><span style=display:flex><span>        first_half_processed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> file_path <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>code_files:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>&gt;=</span> first_half_limit:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Processing first half: </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            code_lines <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_format_file(file_path)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_add_code_to_document(code_lines, file_path)
</span></span><span style=display:flex><span>            first_half_processed <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Second pass: Process files for the last half (second half)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># For copyright requirements, we usually need the beginning and ending of the code</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> len(self<span style=color:#f92672>.</span>code_files) <span style=color:#f92672>&gt;</span> first_half_processed:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Start processing from where we left off to reach max pages</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> file_path <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>code_files[first_half_processed:]:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>&gt;=</span> self<span style=color:#f92672>.</span>target_total_lines:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Processing second half: </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                code_lines <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_format_file(file_path)
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>_add_code_to_document(code_lines, file_path)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Calculate estimated pages</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>code_pages <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>//</span> self<span style=color:#f92672>.</span>lines_per_page
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add padding code if needed to reach exactly target total lines</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>&lt;</span> self<span style=color:#f92672>.</span>target_total_lines:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_add_padding_code()
</span></span><span style=display:flex><span>            <span style=color:#75715e># Recalculate code pages</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>code_pages <span style=color:#f92672>=</span> (self<span style=color:#f92672>.</span>code_lines <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>lines_per_page <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>//</span> self<span style=color:#f92672>.</span>lines_per_page
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add summary section (doesn&#39;t count towards target total lines)</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_add_summary_to_document()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Save the document safely</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_save_document_safely()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Print summary to console</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_print_summary()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_print_summary</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Print a summary of the processed files to the console&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;代码处理摘要&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;总文件数: </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>code_files)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;已处理文件数: </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>processed_files)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;部分处理文件数: </span><span style=color:#e6db74>{</span>len(self<span style=color:#f92672>.</span>partially_processed_files)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        unprocessed_count <span style=color:#f92672>=</span> len(self<span style=color:#f92672>.</span>code_files) <span style=color:#f92672>-</span> len(self<span style=color:#f92672>.</span>processed_files) <span style=color:#f92672>-</span> len(self<span style=color:#f92672>.</span>partially_processed_files)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;未处理文件数: </span><span style=color:#e6db74>{</span>unprocessed_count<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;代码总行数: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>code_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;目标代码行数: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>target_total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;每页行数: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>lines_per_page<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;代码页数: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>code_pages<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;文档总行数: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> len(self<span style=color:#f92672>.</span>partially_processed_files) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>部分处理的文件:&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> file_path, processed_lines <span style=color:#f92672>in</span> sorted(self<span style=color:#f92672>.</span>partially_processed_files<span style=color:#f92672>.</span>items()):
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;• </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>: 处理了 </span><span style=color:#e6db74>{</span>processed_lines<span style=color:#e6db74>}</span><span style=color:#e6db74> 行&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> unprocessed_count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>未处理的文件:&#34;</span>)
</span></span><span style=display:flex><span>            count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> file_path <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>code_files:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (str(file_path) <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>processed_files <span style=color:#f92672>and</span> 
</span></span><span style=display:flex><span>                    str(file_path) <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>partially_processed_files):
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;• </span><span style=color:#e6db74>{</span>file_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e># Limit the output to avoid flooding the console</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> count <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>and</span> unprocessed_count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span>:
</span></span><span style=display:flex><span>                        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;... 以及其他 </span><span style=color:#e6db74>{</span>unprocessed_count <span style=color:#f92672>-</span> <span style=color:#ae81ff>10</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 个文件&#34;</span>)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;=&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_save_document_safely</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Save the document using a temporary file to avoid permission issues&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        temp_dir <span style=color:#f92672>=</span> tempfile<span style=color:#f92672>.</span>mkdtemp()
</span></span><span style=display:flex><span>        temp_file <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(temp_dir, <span style=color:#e6db74>&#34;temp_document.docx&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># First, save to the temporary location</span>
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Saving to temporary file: </span><span style=color:#e6db74>{</span>temp_file<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>doc<span style=color:#f92672>.</span>save(temp_file)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Then try to copy to the final destination</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                output_dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(self<span style=color:#f92672>.</span>output_file)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> output_dir <span style=color:#f92672>and</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(output_dir):
</span></span><span style=display:flex><span>                    os<span style=color:#f92672>.</span>makedirs(output_dir, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                shutil<span style=color:#f92672>.</span>copy2(temp_file, self<span style=color:#f92672>.</span>output_file)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Document saved to: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>output_file<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Total document lines: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Code lines: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>code_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Code pages: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>code_pages<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>PermissionError</span>:
</span></span><span style=display:flex><span>                <span style=color:#75715e># If we can&#39;t write to the exact location, create an alternative</span>
</span></span><span style=display:flex><span>                alt_filename <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;软著源代码_</span><span style=color:#e6db74>{</span>datetime<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>%H%M%S&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>.docx&#34;</span>
</span></span><span style=display:flex><span>                alt_filepath <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(self<span style=color:#f92672>.</span>output_file) <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;.&#34;</span>, alt_filename)
</span></span><span style=display:flex><span>                shutil<span style=color:#f92672>.</span>copy2(temp_file, alt_filepath)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Permission denied for </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>output_file<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Document saved to alternative location: </span><span style=color:#e6db74>{</span>alt_filepath<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Total document lines: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>total_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Code lines: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>code_lines<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Code pages: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>code_pages<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>finally</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Clean up the temporary directory</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                shutil<span style=color:#f92672>.</span>rmtree(temp_dir)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Warning: Could not remove temporary directory: </span><span style=color:#e6db74>{</span>temp_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    parser <span style=color:#f92672>=</span> argparse<span style=color:#f92672>.</span>ArgumentParser(description<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Format code files for software copyright application&#39;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--input_dirs&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Comma-separated list of directories containing source code files&#39;</span>, required<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--output_file&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Path to output Word document&#39;</span>, required<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--extensions&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Comma-separated list of file extensions to include&#39;</span>,
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;.py&#39;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--title&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Title of the software (for header)&#39;</span>,
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;软件著作权源代码&#39;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--lines-per-page&#39;</span>, type<span style=color:#f92672>=</span>int, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Number of lines per page&#39;</span>,
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--max-pages&#39;</span>, type<span style=color:#f92672>=</span>int, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Maximum number of pages&#39;</span>,
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--total-lines&#39;</span>, type<span style=color:#f92672>=</span>int, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Total lines of code to include (overrides max-pages if set)&#39;</span>,
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--ignore&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Comma-separated list of patterns to ignore&#39;</span>,
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;__pycache__,.git,.env,venv,.pyc,.pyo&#39;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--no-line-numbers&#39;</span>, action<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;store_true&#39;</span>,
</span></span><span style=display:flex><span>                        help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Do not add line number prefixes to each code line&#39;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    args <span style=color:#f92672>=</span> parser<span style=color:#f92672>.</span>parse_args()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Parse input directories as comma-separated values</span>
</span></span><span style=display:flex><span>    input_dirs <span style=color:#f92672>=</span> [dir<span style=color:#f92672>.</span>strip() <span style=color:#66d9ef>for</span> dir <span style=color:#f92672>in</span> args<span style=color:#f92672>.</span>input_dirs<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;,&#39;</span>)]
</span></span><span style=display:flex><span>    extensions <span style=color:#f92672>=</span> [ext <span style=color:#66d9ef>if</span> ext<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;.&#39;</span>) <span style=color:#66d9ef>else</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;.</span><span style=color:#e6db74>{</span>ext<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span> <span style=color:#66d9ef>for</span> ext <span style=color:#f92672>in</span> args<span style=color:#f92672>.</span>extensions<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;,&#39;</span>)]
</span></span><span style=display:flex><span>    ignore_patterns <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>ignore<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;,&#39;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    formatter <span style=color:#f92672>=</span> SoftwareCopyrightFormatter(
</span></span><span style=display:flex><span>        input_dirs<span style=color:#f92672>=</span>input_dirs,
</span></span><span style=display:flex><span>        output_file<span style=color:#f92672>=</span>args<span style=color:#f92672>.</span>output_file,
</span></span><span style=display:flex><span>        file_extensions<span style=color:#f92672>=</span>extensions,
</span></span><span style=display:flex><span>        title<span style=color:#f92672>=</span>args<span style=color:#f92672>.</span>title,
</span></span><span style=display:flex><span>        lines_per_page<span style=color:#f92672>=</span>args<span style=color:#f92672>.</span>lines_per_page,
</span></span><span style=display:flex><span>        max_pages<span style=color:#f92672>=</span>args<span style=color:#f92672>.</span>max_pages,
</span></span><span style=display:flex><span>        total_lines<span style=color:#f92672>=</span>args<span style=color:#f92672>.</span>total_lines,
</span></span><span style=display:flex><span>        ignore_patterns<span style=color:#f92672>=</span>ignore_patterns,
</span></span><span style=display:flex><span>        add_line_numbers<span style=color:#f92672>=</span><span style=color:#f92672>not</span> args<span style=color:#f92672>.</span>no_line_numbers
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    formatter<span style=color:#f92672>.</span>process()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://qfsyso.github.io/tags/code/>Code</a></li></ul><nav class=paginav><a class=prev href=https://qfsyso.github.io/posts/esp32-inmp411-max98357a/><span class=title>« Prev</span><br><span>ESP32 INMP411 MAX98357A</span>
</a><a class=next href=https://qfsyso.github.io/posts/tcp-color-calibration/><span class=title>Next »</span><br><span>TCP Color Calibration</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Soft Copyright on x" href="https://x.com/intent/tweet/?text=Soft%20Copyright&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f&amp;hashtags=Code"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Soft Copyright on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f&amp;title=Soft%20Copyright&amp;summary=Soft%20Copyright&amp;source=https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Soft Copyright on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f&title=Soft%20Copyright"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Soft Copyright on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Soft Copyright on whatsapp" href="https://api.whatsapp.com/send?text=Soft%20Copyright%20-%20https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Soft Copyright on telegram" href="https://telegram.me/share/url?text=Soft%20Copyright&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Soft Copyright on ycombinator" href="https://news.ycombinator.com/submitlink?t=Soft%20Copyright&u=https%3a%2f%2fqfsyso.github.io%2fposts%2fsoft-copyright%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><div class=wtime><div class=wtime2>CST<span id=beijingTime></span> GMT <span id=londonTime></span> EST <span id=newYorkTime></span> PST<span id=losAngelesTime></span></div><div class=wtime2 style=display:none>东京<span id=tokyoTime></span></div><div class=wtime2 style=display:none>欧洲-巴黎<span id=parisTime></span></div><div class=wtime2 style=display:none>UTC<span id=utcTime></span></div></div><span>&copy; 2025 <a href=https://qfsyso.github.io/>MLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><script type=text/javascript>const timeZoneOffsets={beijing:8,tokyo:9,paris:[1,2],london:[0,1],newYork:[-5,-4],losAngeles:[-8,-7]};function padZero(e){return e<10?"0"+e:e}function formatTime(e){const t=e.getFullYear(),n=padZero(e.getMonth()+1),s=padZero(e.getDate()),o=padZero(e.getHours()),i=padZero(e.getMinutes()),a=padZero(e.getSeconds());return`${t}-${n}-${s} ${o}:${i}:${a}`}function isDaylightSavingTime(e,t){const o=e.getMonth(),n=new Date(e.getFullYear(),3,8,2,0,0),s=new Date(e.getFullYear(),10,1,2,0,0);return(t==="paris"||t==="london"||t==="newYork"||t==="losAngeles")&&e>=n&&e<s}function updateTime(){const e=new Date,t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),n=formatTime(t);document.getElementById("utcTime").innerHTML=n;for(const n in timeZoneOffsets){const e=timeZoneOffsets[n];let s;Array.isArray(e)?s=isDaylightSavingTime(t,n)?e[1]:e[0]:s=e;const o=new Date(t.getTime()+s*60*60*1e3);document.getElementById(n+"Time").innerHTML=formatTime(o)}setTimeout(updateTime,1e3)}window.onload=function(){updateTime()};function notfound(e){var n=e.src,t=n.split("/"),s=t[t.length-1];e.src="https://47.115.223.75:8080/group1/v2/"+s+"?timestamp="+Date.now(),e.onerror=null}</script></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
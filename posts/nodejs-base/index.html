<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nodejs base | MLOG</title>
<meta name=keywords content="Node,Helloworld,Buffer,Stream,C++,Router,MySQL,Socket"><meta name=description content="简单的说 Node.js 就是运行在服务端的 JavaScript。
Node.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。
Node.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。
🛠Node.js安装 Node.js安装在上一篇文章Debian Node.js HEXO 有讲到
截至目前最新的版本是20.12.2
#查看版本 node -v v20.12.2
win下可以在官网下载安装 https://nodejs.org/en/download
debian nodejs node 14版本
$ apt-get update $ curl -fsSL https://deb.nodesource.com/setup_14.x | sudo -E bash - #如果提示sudo 命令没有找到，一定要下载，执行apt-get install sudo -y 即可，然后再执行上述命令
$ apt-get install nodejs -y $ node --version //验证 当然如果需要安装node20版本，只需将上述命令替换为：
$ curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - 💬helloworld hi."><meta name=author content="dwd"><link rel=canonical href=https://qfsyso.github.io/posts/nodejs-base/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://qfsyso.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://qfsyso.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://qfsyso.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://qfsyso.github.io/apple-touch-icon.png><link rel=mask-icon href=https://qfsyso.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://qfsyso.github.io/posts/nodejs-base/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://qfsyso.github.io/posts/nodejs-base/"><meta property="og:site_name" content="MLOG"><meta property="og:title" content="Nodejs base"><meta property="og:description" content="简单的说 Node.js 就是运行在服务端的 JavaScript。
Node.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。
Node.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。
🛠Node.js安装 Node.js安装在上一篇文章Debian Node.js HEXO 有讲到
截至目前最新的版本是20.12.2
#查看版本 node -v v20.12.2
win下可以在官网下载安装 https://nodejs.org/en/download
debian nodejs node 14版本
$ apt-get update $ curl -fsSL https://deb.nodesource.com/setup_14.x | sudo -E bash - #如果提示sudo 命令没有找到，一定要下载，执行apt-get install sudo -y 即可，然后再执行上述命令
$ apt-get install nodejs -y $ node --version //验证 当然如果需要安装node20版本，只需将上述命令替换为：
$ curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - 💬helloworld hi."><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-17T19:00:03+00:00"><meta property="article:modified_time" content="2024-05-17T19:00:03+00:00"><meta property="article:tag" content="Node"><meta property="article:tag" content="Helloworld"><meta property="article:tag" content="Buffer"><meta property="article:tag" content="Stream"><meta property="article:tag" content="C++"><meta property="article:tag" content="Router"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nodejs base"><meta name=twitter:description content="简单的说 Node.js 就是运行在服务端的 JavaScript。
Node.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。
Node.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。
🛠Node.js安装 Node.js安装在上一篇文章Debian Node.js HEXO 有讲到
截至目前最新的版本是20.12.2
#查看版本 node -v v20.12.2
win下可以在官网下载安装 https://nodejs.org/en/download
debian nodejs node 14版本
$ apt-get update $ curl -fsSL https://deb.nodesource.com/setup_14.x | sudo -E bash - #如果提示sudo 命令没有找到，一定要下载，执行apt-get install sudo -y 即可，然后再执行上述命令
$ apt-get install nodejs -y $ node --version //验证 当然如果需要安装node20版本，只需将上述命令替换为：
$ curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - 💬helloworld hi."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://qfsyso.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Nodejs base","item":"https://qfsyso.github.io/posts/nodejs-base/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nodejs base","name":"Nodejs base","description":"简单的说 Node.js 就是运行在服务端的 JavaScript。\nNode.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。\nNode.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。\n🛠Node.js安装 Node.js安装在上一篇文章Debian Node.js HEXO 有讲到\n截至目前最新的版本是20.12.2\n#查看版本 node -v v20.12.2\nwin下可以在官网下载安装 https://nodejs.org/en/download\ndebian nodejs node 14版本\n$ apt-get update $ curl -fsSL https://deb.nodesource.com/setup_14.x | sudo -E bash - #如果提示sudo 命令没有找到，一定要下载，执行apt-get install sudo -y 即可，然后再执行上述命令\n$ apt-get install nodejs -y $ node --version //验证 当然如果需要安装node20版本，只需将上述命令替换为：\n$ curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - 💬helloworld hi.","keywords":["Node","Helloworld","Buffer","Stream","C++","Router","MySQL","Socket"],"articleBody":"简单的说 Node.js 就是运行在服务端的 JavaScript。\nNode.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。\nNode.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。\n🛠Node.js安装 Node.js安装在上一篇文章Debian Node.js HEXO 有讲到\n截至目前最新的版本是20.12.2\n#查看版本 node -v v20.12.2\nwin下可以在官网下载安装 https://nodejs.org/en/download\ndebian nodejs node 14版本\n$ apt-get update $ curl -fsSL https://deb.nodesource.com/setup_14.x | sudo -E bash - #如果提示sudo 命令没有找到，一定要下载，执行apt-get install sudo -y 即可，然后再执行上述命令\n$ apt-get install nodejs -y $ node --version //验证 当然如果需要安装node20版本，只需将上述命令替换为：\n$ curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - 💬helloworld hi.js\nconsole.log(\"hello world node.js \") // like javascript~ node hi.js [20240504n11]\n👩‍🏫Node.js 创建第一个应用 require 指令 var http = require(\"http\"); 创建服务器/接收响应请求 var http = require('http'); http.createServer(function (request, response) { // 发送 HTTP 头部 // HTTP 状态值: 200 : OK // 内容类型: text/plain response.writeHead(200, {'Content-Type': 'text/plain'}); // 发送响应数据 \"Hello World\" response.end('Hello World\\n'); }).listen(8888); // 终端打印如下信息 console.log('Server running at http://127.0.0.1:1200/'); 🚀npm使用 npm 是包管理工具 允许用户从NPM服务器下载别人编写的第三方包到本地使用。 允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。 允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。\nnpm -v\n如果你安装的是旧版本的 npm，可以很容易得通过 npm 命令来升级，命令如下：\n$ sudo npm install npm -g /usr/local/bin/npm -\u003e /usr/local/lib/node_modules/npm/bin/npm-cli.js npm@2.14.2 /usr/local/lib/node_modules/npm 如果是 Window 系统使用以下命令即可：\nnpm install npm -g 使用淘宝镜像的命令：\nnpm install -g cnpm –registry=https://registry.npmmirror.com\n全局安装与本地安装 npm 的包安装分为本地安装（local）、全局安装（global）两种，从敲的命令行来看，差别只是有没有-g而已，比如\nnpm install express # 本地安装 npm install express -g # 全局安装 如果出现以下错误：\nnpm err! Error: connect ECONNREFUSED 127.0.0.1:8087 解决办法为：\n$ npm config set proxy null\n查看安装信息 npm list\n── express@4.19.2\nnpm list -g\n使用package.json -node_modules/express/package.json 内容：\nPackage.json 属性说明\nname - 包名。\nversion - 包的版本号。\ndescription - 包的描述。\nhomepage - 包的官网 url 。\nauthor - 包的作者姓名。\ncontributors - 包的其他贡献者姓名。\ndependencies - 依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module 目录下。\nrepository - 包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上。\nmain - main 字段指定了程序的主入口文件，require(‘moduleName’) 就会加载这个文件。这个字段的默认值是模块根目录下面的 index.js。\nkeywords - 关键字\n卸载\nnpm uninstall express npm ls 更新\nnpm update express 创建\nnpm init This utility will walk you through creating a package.json file. It only covers the most common items, and tries to guess sensible defaults.\nSee npm help json for definitive documentation on these fields and exactly what they do.\nUse npm install --save afterwards to install a package and save it as a dependency in the package.json file.\nPress ^C at any time to quit. name: (node_modules) runoob # 模块名 version: (1.0.0) description: Node.js 测试模块(www.runoob.com) # 描述 entry point: (index.js) test command: make test git repository: https://github.com/runoob/runoob.git # Github 地址\nauthor: license: (ISC) About to write to ……/node_modules/package.json: # 生成地址\n{ “name”: “runoob”, “version”: “1.0.0”, “description”: “Node.js 测试模块(www.runoob.com)”, …… }\nIs this ok? (yes) yes\nyes后会生成 package.json npm adduser Username: mcmohd Password: Email: (this IS public) mcmohd@gmail.com\n发布 npm publish\n就可以跟其他模块一样使用 npm 来安装\n🔭Node.js 回调函数 Node.js 异步编程的直接体现就是回调。\n异步编程依托于回调来实现，但不能说使用了回调后程序就异步化了。\n回调函数在完成任务后就会被调用，Node 使用了大量的回调函数，Node 所有 API 都支持回调函数。\n例如，我们可以一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I/O 操作。这就大大提高了 Node.js 的性能，可以处理大量的并发请求。\n回调函数一般作为函数的最后一个参数出现：\nfunction foo1(name, age, callback) { } function foo2(value, callback1, callback2) { } 阻塞代码实例 创建一个文件 x.txt ，内容如下：\nhi hi hi\n创建 main.js 文件, 代码如下：\nvar fs = require(\"fs\"); var data = fs.readFileSync('x.txt'); console.log(data.toString()); console.log(\"程序执行结束!\"); 以上代码执行结果如下：\nnode main.js\nhi hi hi\n程序执行结束!\n非阻塞代码实例 创建一个文件 input.txt ，内容如下：\n菜鸟教程官网地址：www.runoob.com 创建 main.js 文件, 代码如下：\nvar fs = require(\"fs\"); fs.readFile('input.txt', function (err, data) { if (err) return console.error(err); console.log(data.toString()); }); console.log(\"程序执行结束!\"); 以上代码执行结果如下：\nnode main.js\n程序执行结束! hi hi hi 以上两个实例我们了解了阻塞与非阻塞调用的不同。第一个实例在文件读取完后才执行程序。 第二个实例我们不需要等待文件读取完，这样就可以在读取文件时同时执行接下来的代码，大大提高了程序的性能。\n因此，阻塞是按顺序执行的，而非阻塞是不需要按顺序的，所以如果需要处理回调函数的参数，我们就需要写在回调函数内。\n🐞Node.js 事件循环 Node.js 是单进程单线程应用程序，但是因为 V8 引擎提供的异步执行回调接口，通过这些接口可以处理大量的并发，所以性能非常高。\nNode.js 几乎每一个 API 都是支持回调函数的。\nNode.js 基本上所有的事件机制都是用设计模式中观察者模式实现。\nNode.js 单线程类似进入一个while(true)的事件循环，直到没有事件观察者退出，每个异步事件都生成一个事件观察者，如果有事件发生就调用该回调函数.\n事件驱动程序 Node.js 使用事件驱动模型，当web server接收到请求，就把它关闭然后进行处理，然后去服务下一个web请求。\n当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。\n这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。（这也称之为非阻塞式IO或者事件驱动IO）\n在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数。\nEventEmitters -\u003e Events =\u003e\u003c= EventLoop -\u003e Event Handlers\n整个事件驱动的流程就是这么实现的，非常简洁。有点类似于观察者模式，事件相当于一个主题(Subject)，而所有注册到这个事件上的处理函数相当于观察者(Observer)。\nNode.js 有多个内置的事件，我们可以通过引入 events 模块，并通过实例化 EventEmitter 类来绑定和监听事件，如下实例：\n// 引入 events 模块 var events = require('events'); // 创建 eventEmitter 对象 var eventEmitter = new events.EventEmitter(); 以下程序绑定事件处理程序：\n// 绑定事件及事件的处理程序 eventEmitter.on('eventName', eventHandler); 我们可以通过程序触发事件：\n// 触发事件 eventEmitter.emit('eventName'); main.js\n// 引入 events 模块 var events = require('events'); // 创建 eventEmitter 对象 var eventEmitter = new events.EventEmitter(); // 创建事件处理程序 var connectHandler = function connected() { console.log('连接成功。'); // 触发 data_received 事件 eventEmitter.emit('data_received'); } // 绑定 connection 事件处理程序 eventEmitter.on('connection', connectHandler); // 使用匿名函数绑定 data_received 事件 eventEmitter.on('data_received', function(){ console.log('数据接收成功。'); }); // 触发 connection 事件 eventEmitter.emit('connection'); console.log(\"程序执行完毕。\"); connection -\u003e connectHandler -\u003e data_received\nnode main.js 连接成功。 数据接收成功。 程序执行完毕。 Node 应用程序是如何工作的？ 在 Node 应用程序中，执行异步操作的函数将回调函数作为最后一个参数， 回调函数接收错误对象作为第一个参数。\n接下来让我们来重新看下前面的实例，创建一个 x.txt ,文件内容如下：\n//main.js var fs = require(\"fs\"); fs.readFile('x.txt', function (err, data) { if (err){ console.log(err.stack); return; } console.log(data.toString()); }); console.log(\"程序执行完毕\"); 执行 则异步读取x.txt内容 把路劲改成 x1.txt读取错误则log 错误内容\n📔Node.js EventEmitter Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列。\nNode.js 里面的许多对象都会分发事件：一个 net.Server 对象会在每次有新连接时触发一个事件， 一个 fs.readStream 对象会在文件被打开的时候触发一个事件。 所有这些产生事件的对象都是 events.EventEmitter 的实例。\n//main.js 文件 var EventEmitter = require('events').EventEmitter; var event = new EventEmitter(); event.on('some_event', function() { console.log('some_event 事件触发'); }); setTimeout(function() { event.emit('some_event'); }, 10000); 10s后执行 some_event 输出 事件触发\nEventEmitter 的每个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义。对于每个事件，EventEmitter 支持 若干个事件监听器。\n当事件触发时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递。\n//main.js 文件 var events = require('events'); var emitter = new events.EventEmitter(); emitter.on('someEvent', function(arg1, arg2) { console.log('listener1', arg1, arg2); }); emitter.on('someEvent', function(arg1, arg2) { console.log('listener2', arg1, arg2); }); emitter.emit('someEvent', 'arg1 参数', 'arg2 参数'); emitter 为事件 someEvent 注册了两个事件监听器，然后触发了 someEvent 事件。\n运行结果中可以看到两个事件监听器回调函数被先后调用。 这就是EventEmitter最简单的用法。\nEventEmitter 提供了多个属性，如 on 和 emit。on 函数用于绑定事件函数，emit 属性用于触发一个事件。接下来我们来具体看下 EventEmitter 的属性介绍。\n.once 监听器最多只会触发一次，触发后立刻解除该监听器\nvar events = require('events'); var eventEmitter = new events.EventEmitter(); // 监听器 #1 var listener1 = function listener1() { console.log('监听器 listener1 执行。'); } // 监听器 #2 var listener2 = function listener2() { console.log('监听器 listener2 执行。'); } // 绑定 connection 事件，处理函数为 listener1 eventEmitter.addListener('connection', listener1); // 绑定 connection 事件，处理函数为 listener2 eventEmitter.on('connection', listener2); var eventListeners = eventEmitter.listenerCount('connection'); console.log(eventListeners + \" 个监听器监听连接事件。\"); // 处理 connection 事件 eventEmitter.emit('connection'); // 移除监绑定的 listener1 函数 eventEmitter.removeListener('connection', listener1); console.log(\"listener1 不再受监听。\"); // 触发连接事件 eventEmitter.emit('connection'); eventListeners = eventEmitter.listenerCount('connection'); console.log(eventListeners + \" 个监听器监听连接事件。\"); // 绑定 connection 事件，处理函数为 listener2 eventEmitter.on('connection', listener2); eventEmitter.emit('connection'); eventListeners = eventEmitter.listenerCount('connection'); console.log(eventListeners + \" 个监听器监听连接事件。\"); console.log(\"程序执行完毕。\"); error 事件 EventEmitter 定义了一个特殊的事件 error，它包含了错误的语义，我们在遇到 异常的时候通常会触发 error 事件。\n当 error 被触发时，EventEmitter 规定如果没有响 应的监听器，Node.js 会把它当作异常，退出程序并输出错误信息。\n我们一般要为会触发 error 事件的对象设置监听器，避免遇到错误后整个程序崩溃。例如：\n继承 EventEmitter 大多数时候我们不会直接使用 EventEmitter，而是在对象中继承它。包括 fs、net、 http 在内的，只要是支持事件响应的核心模块都是 EventEmitter 的子类。\n为什么要这样做呢？原因有两点：\n首先，具有某个实体功能的对象实现事件符合语义， 事件的监听和发生应该是一个对象的方法。\n其次 JavaScript 的对象机制是基于原型的，支持 部分多重继承，继承 EventEmitter 不会打乱对象原有的继承关系。\n⛏ Node.js Buffer JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。\n但在处理像TCP流或文件流时，必须使用到二进制数据。因此在 Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区。\n在 Node.js 中，Buffer 类是随 Node 内核一起发布的核心库。Buffer 库为 Node.js 带来了一种存储原始数据的方法，可以让 Node.js 处理二进制数据，每当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库。原始数据存储在 Buffer 类的实例中。一个 Buffer 类似于一个整数数组，但它对应于 V8 堆内存之外的一块原始内存。\nBuffer 与字符编码\nBuffer 实例一般用于表示编码字符的序列，比如 UTF-8 、 UCS2 、 Base64 、或十六进制编码的数据。 通过使用显式的字符编码，就可以在 Buffer 实例与普通的 JavaScript 字符串之间进行相互转换。\nBuffer.from() 创建对象\nconst buf = Buffer.from('test', 'ascii'); // 输出 72756e6f6f62 console.log(buf.toString('hex')); // 输出 cnVub29i console.log(buf.toString('base64')); //UTF-8 console.log(buf.toString('UTF-8')); //ascii console.log(buf.toString('ascii')); //utf16le console.log(buf.toString('utf16le')); //latin1 console.log(buf.toString('latin1')); Node.js 目前支持的字符编码包括：\nascii - 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的。\nutf8 - 多字节编码的 Unicode 字符。许多网页和其他文档格式都使用 UTF-8 。\nutf16le - 2 或 4 个字节，小字节序编码的 Unicode 字符。支持代理对（U+10000 至 U+10FFFF）。\nucs2 - utf16le 的别名。\nbase64 - Base64 编码。\nlatin1 - 一种把 Buffer 编码成一字节编码的字符串的方式。\nbinary - latin1 的别名。\nhex - 将每个字节编码为两个十六进制字符。\n创建 Buffer 类 Buffer 提供了以下 API 来创建 Buffer 类：\nBuffer.alloc(size[, fill[, encoding]])： 返回一个指定大小的 Buffer 实例，如果没有设置 fill，则默认填满 0 Buffer.allocUnsafe(size)： 返回一个指定大小的 Buffer 实例，但是它不会被初始化，所以它可能包含敏感的数据 Buffer.allocUnsafeSlow(size) Buffer.from(array)： 返回一个被 array 的值初始化的新的 Buffer 实例（传入的 array 的元素只能是数字，不然就会自动被 0 覆盖） Buffer.from(arrayBuffer[, byteOffset[, length]])： 返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer。 Buffer.from(buffer)： 复制传入的 Buffer 实例的数据，并返回一个新的 Buffer 实例 Buffer.from(string[, encoding])： 返回一个被 string 的值初始化的新的 Buffer 实例\n写入缓冲区 语法 写入 Node 缓冲区的语法如下所示：\nbuf.write(string[, offset[, length]][, encoding]) 参数 参数描述如下：\nstring - 写入缓冲区的字符串。\noffset - 缓冲区开始写入的索引值，默认为 0 。\nlength - 写入的字节数，默认为 buffer.length\nencoding - 使用的编码。默认为 ‘utf8’ 。\n根据 encoding 的字符编码写入 string 到 buf 中的 offset 位置。 length 参数是写入的字节数。 如果 buf 没有足够的空间保存整个字符串，则只会写入 string 的一部分。 只部分解码的字符不会被写入。\n返回值 返回实际写入的大小。如果 buffer 空间不足， 则只会写入部分字符串。\n实例\nbuf = Buffer.alloc(256); len = buf.write(\"123123\"); console.log(\"写入字节数 : \"+ len); 从缓冲区读取数据 语法 读取 Node 缓冲区数据的语法如下所示：\nbuf.toString([encoding[, start[, end]]]) 参数 参数描述如下：\nencoding - 使用的编码。默认为 ‘utf8’ 。\nstart - 指定开始读取的索引位置，默认为 0。\nend - 结束位置，默认为缓冲区的末尾。\n返回值 解码缓冲区数据并使用指定的编码返回字符串。\n实例\nbuf = Buffer.alloc(26); for (var i = 0 ; i \u003c 26 ; i++) { buf[i] = i + 97; } console.log( buf.toString('ascii')); // 输出: abcdefghijklmnopqrstuvwxyz console.log( buf.toString('ascii',0,5)); //使用 'ascii' 编码, 并输出: abcde console.log( buf.toString('utf8',0,5)); // 使用 'utf8' 编码, 并输出: abcde console.log( buf.toString(undefined,0,5)); // 使用默认的 'utf8' 编码, 并输出: abcde 将 Buffer 转换为 JSON 对象 语法 将 Node Buffer 转换为 JSON 对象的函数语法格式如下：\nbuf.toJSON() const buf = Buffer.from([0x1, 0x2, 0x3, 0x4, 0x5]); const json = JSON.stringify(buf); // 输出: {\"type\":\"Buffer\",\"data\":[1,2,3,4,5]} console.log(json); const copy = JSON.parse(json, (key, value) =\u003e { return value \u0026\u0026 value.type === 'Buffer' ? Buffer.from(value.data) : value; }); // 输出: console.log(copy); 缓冲区合并 语法 Node 缓冲区合并的语法如下所示：\nBuffer.concat(list[, totalLength]) var buffer1 = Buffer.from(('123')); var buffer2 = Buffer.from(('test')); var buffer3 = Buffer.concat([buffer1,buffer2]); console.log(\"buffer3 内容: \" + buffer3.toString()); 缓冲区比较 语法 Node Buffer 比较的函数语法如下所示, 该方法在 Node.js v0.12.2 版本引入：\nbuf.compare(otherBuffer); var buffer1 = Buffer.from('ABC'); var buffer2 = Buffer.from('ABCD'); var result = buffer1.compare(buffer2); if(result \u003c 0) { console.log(buffer1 + \" 在 \" + buffer2 + \"之前\"); }else if(result == 0){ console.log(buffer1 + \" 与 \" + buffer2 + \"相同\"); }else { console.log(buffer1 + \" 在 \" + buffer2 + \"之后\"); } 拷贝缓冲区 语法 Node 缓冲区拷贝语法如下所示：\nbuf.copy(targetBuffer[, targetStart[, sourceStart[, sourceEnd]]]) var buf1 = Buffer.from('abcdefghijkl'); var buf2 = Buffer.from('123'); //将 buf2 插入到 buf1 指定位置上 buf2.copy(buf1, 2); console.log(buf1.toString()); 缓冲区裁剪 Node 缓冲区裁剪语法如下所示：\nbuf.slice([start[, end]]) var buffer1 = Buffer.from('TEST123TEST'); // 剪切缓冲区 var buffer2 = buffer1.slice(0,2); console.log(\"buffer2 content: \" + buffer2.toString()); 缓冲区长度 语法 Node 缓冲区长度计算语法如下所示：\nbuf.length; var buffer = Buffer.from('123123123'); // 缓冲区长度 console.log(\"buffer length: \" + buffer.length); 👨‍💻Node.js Stream Node.js Stream(流)\nStream 是一个抽象接口，Node 中有很多对象实现了这个接口。例如，对http 服务器发起请求的request 对象就是一个 Stream，还有stdout（标准输出）。\nNode.js，Stream 有四种流类型：\nReadable - 可读操作。\nWritable - 可写操作。\nDuplex - 可读可写操作.\nTransform - 操作被写入数据，然后读出结果。\n所有的 Stream 对象都是 EventEmitter 的实例。常用的事件有：\ndata - 当有数据可读时触发。\nend - 没有更多的数据可读时触发。\nerror - 在接收和写入过程中发生错误时触发。\nfinish - 所有数据已被写入到底层系统时触发。\nvar fs = require(\"fs\"); var data = ''; // 创建可读流 var readerStream = fs.createReadStream('x.txt'); // 设置编码为 utf8。 readerStream.setEncoding('UTF8'); // 处理流事件 --\u003e data, end, and error readerStream.on('data', function(chunk) { data += chunk; }); readerStream.on('end',function(){ console.log(data); }); readerStream.on('error', function(err){ console.log(err.stack); }); console.log(\"程序执行完毕\"); 写入流\nvar fs = require(\"fs\"); var data = ''; var dataw = 'w123w'; var ws = fs.createWriteStream('x.txt'); ws.write(dataw); ws.end(); console.log(\"数据写入成功！\"); 管道流 管道提供了一个输出流到输入流的机制。通常我们用于从一个流中获取数据并将数据传递到另外一个流中。\nvar fs = require(\"fs\"); // 创建一个可读流 var readerStream = fs.createReadStream('x.txt'); // 创建一个可写流 var writerStream = fs.createWriteStream('output.txt'); // 管道读写操作 // 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中 readerStream.pipe(writerStream); console.log(\"程序执行完毕\"); 链式流 链式是通过连接输出流到另外一个流并创建多个流操作链的机制。链式流一般用于管道操作。\n接下来我们就是用管道和链式来压缩和解压文件。\nvar fs = require(\"fs\"); var zlib = require('zlib'); // 压缩 input.txt 文件为 input.txt.gz fs.createReadStream('x.txt') .pipe(zlib.createGzip()) .pipe(fs.createWriteStream('input.txt.gz')); console.log(\"文件压缩完成。\"); var fs = require(\"fs\"); var zlib = require('zlib'); // 解压 input.txt.gz 文件为 input.txt fs.createReadStream('input.txt.gz') .pipe(zlib.createGunzip()) .pipe(fs.createWriteStream('input2.txt')); console.log(\"文件解压完成。\"); 📝Node.js 模块系统 ~~\n为了让Node.js的文件可以相互调用，Node.js提供了一个简单的模块系统。\n模块是Node.js 应用程序的基本组成部分，文件和模块是一一对应的。换言之，一个 Node.js 文件就是一个模块，这个文件可能是JavaScript 代码、JSON 或者编译过的C/C++ 扩展。\n//hello.js exports.world1 = function() { console.log(\"hello world node.js \") } //test.js var hello = require('./hello'); hello.world1(); hello.js 通过 exports 对象把 world1 作为模块的访问接口，在 main.js 中通过 require(’./hello’) 加载这个模块，然后就可以直接访 问 hello.js 中 exports 对象的成员函数了。\n//hello.js function Hello() { var name; this.setName = function(thyName) { name = thyName; }; this.sayHello = function() { console.log('Hello ' + name); }; }; module.exports = Hello; //test.js var Hello = require('./hello'); hello = new Hello(); hello.setName('vvv'); hello.sayHello(); 模块接口的唯一变化是使用 module.exports = Hello 代替了exports.world = function(){}。 在外部引用该模块时，其接口对象就是要输出的 Hello 对象本身，而不是原先的 exports。\nexports 和 module.exports 的使用\n如果要对外暴露属性或方法，就用 exports 就行，要暴露对象(类似class，包含了很多属性和方法)，就用 module.exports。\nPS 模块加载 从文件模块缓存中加载 尽管原生模块与文件模块的优先级不同，但是都会优先从文件模块的缓存中加载已经存在的模块。\n从原生模块加载 原生模块的优先级仅次于文件模块缓存的优先级。require 方法在解析文件名之后，优先检查模块是否在原生模块列表中。以http模块为例，尽管在目录下存在一个 http/http.js/http.node/http.json 文件，require(“http”) 都不会从这些文件中加载，而是从原生模块中加载。\n原生模块也有一个缓存区，同样也是优先从缓存区加载。如果缓存区没有被加载过，则调用原生模块的加载方式进行加载和执行。\n从文件加载 当文件模块缓存中不存在，而且不是原生模块的时候，Node.js 会解析 require 方法传入的参数，并从文件系统中加载实际的文件，加载过程中的包装和编译细节在前一节中已经介绍过，这里我们将详细描述查找文件模块的过程，其中，也有一些细节值得知晓。\nrequire方法接受以下几种参数的传递：\nhttp、fs、path等，原生模块。 ./mod或../mod，相对路径的文件模块。 /pathtomodule/mod，绝对路径的文件模块。 mod，非原生模块的文件模块。\n🔄nodejs 加载c++ 在Node.js中加载C++代码，通常是通过编写一个C++的扩展模块，然后通过Node.js的require方法加载这个模块。这可以通过Node.js的原生扩展模块API实现，也可以通过N-API实现，这是一个为构建可以在多个Node.js版本上工作的原生扩展模块而设计的API。\n以下是一个简单的例子，展示如何创建一个C++扩展模块并在Node.js中使用它。\n首先，你需要安装一个名为node-gyp的工具，这是一个用来编译C++扩展模块的工具：\nnpm install -g node-gyp 然后，创建一个名为binding.gyp的文件，它描述了如何构建扩展模块：\n{ \"targets\": [ { \"target_name\": \"addon\", \"sources\": [ \"addon.cc\" ] } ] } 接下来，创建一个C++源文件，例如addon.cc，它包含了你的C++代码：\n#include namespace demo { using v8::FunctionCallbackInfo; using v8::Isolate; using v8::Local; using v8::NewStringType; using v8::Object; using v8::String; using v8::Value; void Method(const FunctionCallbackInfo\u003cValue\u003e\u0026 args) { Isolate* isolate = args.GetIsolate(); args.GetReturnValue().Set(String::NewFromUtf8(isolate, \"world\", NewStringType::kNormal).ToLocalChecked()); } void Initialize(Local\u003cObject\u003e exports) { NODE_SET_METHOD(exports, \"hello\", Method); } NODE_MODULE(NODE_GYP_MODULE_NAME, Initialize) } // namespace demo 确保在binding.gyp文件的同一目录下，运行以下命令来构建扩展模块：\nnode-gyp configure build 这将生成一个编译好的扩展模块，你可以在Node.js中通过require来加载并使用它：\nconst addon = require('./build/Release/addon.node'); console.log(addon.hello()); // 输出: world 在这个例子中，C++模块导出了一个名为hello的方法，当在Node.js中调用这个方法时，它返回字符串\"world\"。\n🙋‍♀️Node.js 函数 在 JavaScript中，一个函数可以作为另一个函数的参数。我们可以先定义一个函数，然后传递，也可以在传递参数的地方直接定义函数。\nNode.js 中函数的使用与 JavaScript 类似，举例来说，你可以这样做：\nfunction say(word) { console.log(word); } function execute(someFunction, value) { someFunction(value); } execute(say, \"Hello\"); 以上代码中，我们把 say 函数作为 execute 函数的第一个变量进行了传递。这里传递的不是 say 的返回值，而是 say 本身！\n这样一来， say 就变成了execute 中的本地变量 someFunction ，execute 可以通过调用 someFunction() （带括号的形式）来使用 say 函数。\n当然，因为 say 有一个变量， execute 在调用 someFunction 时可以传递这样一个变量。\n匿名函数 function execute(someFunction, value) { someFunction(value); } execute(function(word){ console.log(word) }, \"Hello\"); 传递\nvar http = require(\"http\"); function onRequest(request, response) { response.writeHead(200, {\"Content-Type\": \"text/plain\"}); response.write(\"Hello World\"); response.end(); } http.createServer(onRequest).listen(8888); ==\u003e\nvar http = require(\"http\"); http.createServer(function(request, response) { response.writeHead(200, {\"Content-Type\": \"text/plain\"}); response.write(\"Hello World\"); response.end(); }).listen(8888); 🙋‍♂Node.js 箭头函数 在Node.js中，箭头函数是一种简洁写法，用于声明匿名函数。它们最常用于回调函数和事件监听器等场景。箭头函数的语法很简单，它的基本格式如下：\n(param1, param2, ...) =\u003e { // 函数体 return something; } const numbers = [1, 2, 3, 4, 5]; const doubled = numbers.map(number =\u003e number * 2); console.log(doubled); // 输出: [2, 4, 6, 8, 10] setTimeout(() =\u003e { console.log('hihihi.'); }, 2000); 以上决策图看起来有点复杂，我认为有三点比较重要：\n箭头函数适合于无复杂逻辑或者无副作用的纯函数场景下，例如用在 map 、 reduce 、 filter 的回调函数定义中； 不要在最外层定义箭头函数，因为在函数内部操作 this 会很容易污染全局作用域。最起码在箭头函数外部包一层普通函数，将 this 控制在可见的范围内； 如开头所述，箭头函数最吸引人的地方是简洁。在有多层函数嵌套的情况下，箭头函数的简洁性并没有很大的提升，反而影响了函数的作用范围的识别度，这种情况不建议使用箭头函数。\n🧪Node.js 路由 在 Node.js 中，路由（Routing）是指确定如何响应对特定端点（URL 路径）的 HTTP 请求的过程。\n我们要为路由提供请求的 URL 和其他需要的 GET 及 POST 参数，随后路由需要根据这些数据来执行相应的代码。\n因此，我们需要查看 HTTP 请求，从中提取出请求的 URL 以及 GET/POST 参数。这一功能应当属于路由还是服务器（甚至作为一个模块自身的功能）确实值得探讨，但这里暂定其为我们的HTTP服务器的功能。\n我们需要的所有数据都会包含在 request 对象中，该对象作为 onRequest() 回调函数的第一个参数传递。但是为了解析这些数据，我们需要额外的 Node.JS 模块，它们分别是 url 和 querystring 模块。\nurl.parse(string).query | url.parse(string).pathname | | | | | ++++++ ++++++++++++++++++- http://localhost:8888/start?foo=bar\u0026hello=world +++ +++– | | | | querystring.parse(queryString)[“foo”] | | querystring.parse(queryString)[“hello”] 现在我们来给 onRequest() 函数加上一些逻辑，用来找出浏览器请求的 URL 路径：\nrouter.js\nfunction route(pathname) { console.log(\"About to route a request for \" + pathname); } exports.route = route; server.js\nvar http = require(\"http\"); var url = require(\"url\"); function start(route) { function onRequest(request, response) { var pathname = url.parse(request.url).pathname; console.log(\"Request for \" + pathname + \" received.\"); route(pathname); response.writeHead(200, {\"Content-Type\": \"text/plain\"}); response.write(\"Hello World\"); response.end(); } http.createServer(onRequest).listen(8888); console.log(\"Server has started.\"); } exports.start = start; //test.js var server = require(\"./server\"); var router = require(\"./router\"); server.start(router.route); node test.js 🙏Node.js 全局对象 javaScript 中有一个特殊的对象，称为全局对象（Global Object），它及其所有属性都可以在程序的任何地方访问，即全局变量。\n在浏览器 JavaScript 中，通常 window 是全局对象， 而 Node.js 中的全局对象是 global，所有全局变量（除了 global 本身以外）都是 global 对象的属性。\n在 Node.js 我们可以直接访问到 global 的属性，而不需要在应用中包含它。\n全局对象与全局变量 global 最根本的作用是作为全局变量的宿主。按照 ECMAScript 的定义，满足以下条 件的变量是全局变量：\n在最外层定义的变量； 全局对象的属性； 隐式定义的变量（未定义直接赋值的变量）。 当你定义一个全局变量时，这个变量同时也会成为全局对象的属性，反之亦然。需要注 意的是，在 Node.js 中你不可能在最外层定义变量，因为所有用户代码都是属于当前模块的， 而模块本身不是最外层上下文。\n注意： 最好不要使用 var 定义变量以避免引入全局变量，因为全局变量会污染命名空间，提高代码的耦合风险。\n__filename __filename 表示当前正在执行的脚本的文件名。它将输出文件所在位置的绝对路径，且和命令行参数所指定的文件名不一定相同。 如果在模块中，返回的值是模块文件的路径。\n__dirname __dirname 表示当前执行脚本所在的目录。\nsetTimeout(cb, ms) setTimeout(cb, ms) 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。：setTimeout() 只执行一次指定函数。\nclearTimeout(t) clearTimeout( t ) 全局函数用于停止一个之前通过 setTimeout() 创建的定时器。 参数 t 是通过 setTimeout() 函数创建的定时器。\nfunction printHello(){ console.log( \"Hello, World!\"); } // 两秒后执行以上函数 var t = setTimeout(printHello, 2000); // 清除定时器 clearTimeout(t); 执行 main.js 文件，代码如下所示:\nsetInterval(cb, ms) setInterval(cb, ms) 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。\n返回一个代表定时器的句柄值。可以使用 clearInterval(t) 函数来清除定时器。\nsetInterval() 方法会不停地调用函数，直到 clearInterval() 被调用或窗口被关闭。\nfunction printHello(){ console.log( \"Hello, World!\"); } // 两秒后执行以上函数 setInterval(printHello, 2000); console console 用于提供控制台标准输出，它是由 Internet Explorer 的 JScript 引擎提供的调试工具，后来逐渐成为浏览器的实施标准。\nconsole.log console.info console.error console.warn console.time(label) 输出时间，表示计时开始。 console.timeEnd(label) 结束时间，表示计时结束。 console.trace\nconsole.info(\"程序开始执行：\"); var counter = 10; console.log(\"计数: %d\", counter); console.time(\"获取数据\"); // for(var i = 0; i \u003c 100000; i++ ) {} // console.timeEnd('获取数据'); console.info(\"程序执行完毕。\") process process 是一个全局变量，即 global 对象的属性。\nprocess.on('exit', function(code) { // 以下代码永远不会执行 setTimeout(function() { console.log(\"该代码不会执行\"); }, 0); console.log('退出码为:', code); }); console.log(\"程序执行结束\"); Process 属性 Process 提供了很多有用的属性，便于我们更好的控制系统的交互\nstdout 标准输出流 stderr 标准错误流。 stdin 标准输入流。 argv argv 属性返回一个数组，由命令行执行脚本时的各个参数组成。它的第一个成员总是node，第二个成员是脚本文件名，其余成员是脚本文件的参数。 execPath 返回执行当前脚本的 Node 二进制文件的绝对路径。 execArgv 返回一个数组，成员是命令行下执行脚本时，在Node可执行文件与脚本文件之间的命令行参数。 env 返回一个对象，成员为当前 shell 的环境变量 exitCode 进程退出时的代码，如果进程优通过 process.exit() 退出，不需要指定退出码。 version Node 的版本，比如v0.10.18 config 一个包含用来编译当前 node 执行文件的 javascript 配置选项的对象。它与运行 ./configure 脚本生成的 “config.gypi” 文件相同。 pid 当前进程的进程号。 title 进程名，默认值为\"node\"，可以自定义该值。 platform 运行程序所在的平台系统 ‘darwin’, ‘freebsd’, ’linux’, ‘sunos’ 或 ‘win32’ arch 当前 CPU 的架构：‘arm’、‘ia32’ 或者 ‘x64’。 mainModule require.main 的备选方法。不同点，如果主模块在运行时改变，require.main可能会继续返回老的模块。可以认为，这两者引用了同一个模块。\n// 输出到终端 process.stdout.write(\"Hello World!\" + \"\\n\"); // 通过参数读取 process.argv.forEach(function(val, index, array) { console.log(index + ': ' + val); }); // 获取执行路径 console.log(process.execPath); // 平台信息 console.log(process.platform); // 输出当前目录 console.log('当前目录: ' + process.cwd()); // 输出当前版本 console.log('当前版本: ' + process.version); // 输出内存使用情况 console.log(process.memoryUsage()); 🔭Node.js MySQL npm install mysql select\nvar mysql = require('mysql'); var connection = mysql.createConnection({ host : 'localhost', user : 'root', password : '123456789', //pwd port: '30306', database: 'IMDB' }); connection.connect(); var sql = 'SELECT * FROM IMConfig;'; console.log(sql); //查 connection.query(sql,function (err, result) { if(err){ console.log('[SELECT ERROR] - ',err.message); return; } console.log('++++++++++++++++++++++++--SELECT+++++++++++++++++++++++++++-'); console.log(result); console.log('++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\\n\\n'); }); connection.end(); ERROR 1045 (28000): Access denied for user ‘root‘@‘localhost‘ (using password: YES) 这边是通过docker安装的mysql，登录报错 root@f4a3881e5f06:/# mysql -uroot -p Enter password: 123456 ERROR 1045 (28000): Access denied for user ‘root’@’localhost’ (using password: YES)\n如果常规的命令 mysql -uroot -p无法登录，使用命令尝试：\nmysql -u root -h 127.0.0.1 -p\nError: ER_NOT_SUPPORTED_AUTH_MODE: Client does not support authentication protocol requested mysql -u root -p ALTER USER ‘root’@’%’ IDENTIFIED WITH mysql_native_password BY ‘123456789’; flush privileges;\ninsert\nconnection.connect(); var addSql = 'INSERT INTO IMConfig(ConfigID,UserID,ConfigName,ConfigCreateTime,ConfigType,ConfigSn) VALUES(0,?,?,?,?,?)'; var addSqlParams = ['1', '11','2023-01-01', '1','1']; //增 connection.query(addSql,addSqlParams,function (err, result) { if(err){ console.log('[INSERT ERROR] - ',err.message); return; } console.log('++++++++++++++++++++++++--INSERT+++++++++++++++++++++++++++-'); //console.log('INSERT ID:',result.insertId); console.log('INSERT ID:',result); console.log('+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--\\n\\n'); }); connection.end(); ER_NO_SUCH_TABLE: Table ‘IMDB.IMCONFIG’ doesn’t exist 中英文错误 ER_WRONG_VALUE_COUNT_ON_ROW: Column count doesn’t match value count at row 1 字段错误 ER_TRUNCATED_WRONG_VALUE: Incorrect datetime value: ‘2023-01-01T16:00:00.000Z’ for column ‘ConfigCreateTime’ at row 1 字段类型\nupdate\n//update connection.connect(); var modSql = 'UPDATE IMConfig SET ConfigName = ?,ConfigType = ?,ConfigSn = ? WHERE ConfigId = ?'; var modSqlParams = ['lang', '2','1',5]; //改 connection.query(modSql,modSqlParams,function (err, result) { if(err){ console.log('[UPDATE ERROR] - ',err.message); return; } console.log('++++++++++++++++++++++++--UPDATE+++++++++++++++++++++++++++-'); console.log('UPDATE affectedRows',result.affectedRows); console.log('+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--\\n\\n'); }); connection.end(); delete\nconnection.connect(); var delSql = 'DELETE FROM IMConfig where ConfigID=5'; //删 connection.query(delSql,function (err, result) { if(err){ console.log('[DELETE ERROR] - ',err.message); return; } console.log('++++++++++++++++++++++++--DELETE+++++++++++++++++++++++++++-'); console.log('DELETE affectedRows',result.affectedRows); console.log('+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--\\n\\n'); }); connection.end(); 🧵Node.js Socket socket client\n//sk var net = require('net'); var client = net.connect('6001', 'xxxx', function(){ console.log('已经与服务器连接'); client.write('Yes\\r\\n'); }); client.on('data', function(data){ console.log(data.toString()); client.end();//one msg end }); client.on('end', function(){ console.log('客户端连接中断'); }); ","wordCount":"2579","inLanguage":"en","datePublished":"2024-05-17T19:00:03Z","dateModified":"2024-05-17T19:00:03Z","author":{"@type":"Person","name":"dwd"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://qfsyso.github.io/posts/nodejs-base/"},"publisher":{"@type":"Organization","name":"MLOG","logo":{"@type":"ImageObject","url":"https://qfsyso.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://qfsyso.github.io/ accesskey=h title="MLOG (Alt + H)">MLOG</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://qfsyso.github.io/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://qfsyso.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://qfsyso.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Nodejs base</h1><div class=post-meta><span title='2024-05-17 19:00:03 +0000 UTC'>May 17, 2024</span>&nbsp;·&nbsp;13 min&nbsp;·&nbsp;dwd</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#nodejs%e5%ae%89%e8%a3%85 aria-label=🛠Node.js安装>🛠Node.js安装</a><ul><li><a href=#debian-nodejs aria-label="debian nodejs">debian nodejs</a></li></ul></li><li><a href=#helloworld aria-label=💬helloworld>💬helloworld</a></li><li><a href=#nodejs-%e5%88%9b%e5%bb%ba%e7%ac%ac%e4%b8%80%e4%b8%aa%e5%ba%94%e7%94%a8 aria-label="👩‍🏫Node.js 创建第一个应用">👩‍🏫Node.js 创建第一个应用</a><ul><li><a href=#require-%e6%8c%87%e4%bb%a4 aria-label="require 指令">require 指令</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%8e%a5%e6%94%b6%e5%93%8d%e5%ba%94%e8%af%b7%e6%b1%82 aria-label=创建服务器/接收响应请求>创建服务器/接收响应请求</a></li></ul></li><li><a href=#npm%e4%bd%bf%e7%94%a8 aria-label=🚀npm使用>🚀npm使用</a><ul><li><a href=#%e5%85%a8%e5%b1%80%e5%ae%89%e8%a3%85%e4%b8%8e%e6%9c%ac%e5%9c%b0%e5%ae%89%e8%a3%85 aria-label=全局安装与本地安装>全局安装与本地安装</a></li><li><a href=#%e6%9f%a5%e7%9c%8b%e5%ae%89%e8%a3%85%e4%bf%a1%e6%81%af aria-label=查看安装信息>查看安装信息</a></li></ul></li><li><a href=#nodejs-%e5%9b%9e%e8%b0%83%e5%87%bd%e6%95%b0 aria-label="🔭Node.js 回调函数">🔭Node.js 回调函数</a><ul><li><a href=#%e9%98%bb%e5%a1%9e%e4%bb%a3%e7%a0%81%e5%ae%9e%e4%be%8b aria-label=阻塞代码实例>阻塞代码实例</a></li><li><a href=#%e9%9d%9e%e9%98%bb%e5%a1%9e%e4%bb%a3%e7%a0%81%e5%ae%9e%e4%be%8b aria-label=非阻塞代码实例>非阻塞代码实例</a></li></ul></li><li><a href=#nodejs-%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af aria-label="🐞Node.js 事件循环">🐞Node.js 事件循环</a><ul><li><a href=#%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8%e7%a8%8b%e5%ba%8f aria-label=事件驱动程序>事件驱动程序</a></li><li><a href=#node-%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e6%98%af%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c%e7%9a%84 aria-label="Node 应用程序是如何工作的？">Node 应用程序是如何工作的？</a></li></ul></li><li><a href=#nodejs-eventemitter aria-label="📔Node.js EventEmitter">📔Node.js EventEmitter</a></li><li><a href=#-nodejs-buffer aria-label="⛏ Node.js Buffer">⛏ Node.js Buffer</a><ul><li><a href=#%e5%88%9b%e5%bb%ba-buffer-%e7%b1%bb aria-label="创建 Buffer 类">创建 Buffer 类</a></li><li><a href=#%e5%86%99%e5%85%a5%e7%bc%93%e5%86%b2%e5%8c%ba aria-label=写入缓冲区>写入缓冲区</a></li><li><a href=#%e4%bb%8e%e7%bc%93%e5%86%b2%e5%8c%ba%e8%af%bb%e5%8f%96%e6%95%b0%e6%8d%ae aria-label=从缓冲区读取数据>从缓冲区读取数据</a></li><li><a href=#%e7%bc%93%e5%86%b2%e5%8c%ba%e5%90%88%e5%b9%b6 aria-label=缓冲区合并>缓冲区合并</a></li><li><a href=#%e7%bc%93%e5%86%b2%e5%8c%ba%e6%af%94%e8%be%83 aria-label=缓冲区比较>缓冲区比较</a></li><li><a href=#%e6%8b%b7%e8%b4%9d%e7%bc%93%e5%86%b2%e5%8c%ba aria-label=拷贝缓冲区>拷贝缓冲区</a></li><li><a href=#%e7%bc%93%e5%86%b2%e5%8c%ba%e8%a3%81%e5%89%aa aria-label=缓冲区裁剪>缓冲区裁剪</a></li><li><a href=#%e7%bc%93%e5%86%b2%e5%8c%ba%e9%95%bf%e5%ba%a6 aria-label=缓冲区长度>缓冲区长度</a></li></ul></li><li><a href=#nodejs-stream aria-label="👨‍💻Node.js Stream">👨‍💻Node.js Stream</a></li><li><a href=#nodejs-%e6%a8%a1%e5%9d%97%e7%b3%bb%e7%bb%9f aria-label="📝Node.js 模块系统">📝Node.js 模块系统</a></li><li><a href=#nodejs-%e5%8a%a0%e8%bd%bdc aria-label="🔄nodejs 加载c++">🔄nodejs 加载c++</a></li><li><a href=#nodejs-%e5%87%bd%e6%95%b0 aria-label="🙋‍♀️Node.js 函数">🙋‍♀️Node.js 函数</a><ul><li><a href=#%e5%8c%bf%e5%90%8d%e5%87%bd%e6%95%b0 aria-label=匿名函数>匿名函数</a></li></ul></li><li><a href=#nodejs-%e7%ae%ad%e5%a4%b4%e5%87%bd%e6%95%b0 aria-label="🙋‍♂Node.js 箭头函数">🙋‍♂Node.js 箭头函数</a></li><li><a href=#nodejs-%e8%b7%af%e7%94%b1 aria-label="🧪Node.js 路由">🧪Node.js 路由</a></li><li><a href=#nodejs-%e5%85%a8%e5%b1%80%e5%af%b9%e8%b1%a1 aria-label="🙏Node.js 全局对象">🙏Node.js 全局对象</a><ul><li><a href=#__filename aria-label=__filename>__filename</a></li><li><a href=#__dirname aria-label=__dirname>__dirname</a></li><li><a href=#settimeoutcb-ms aria-label="setTimeout(cb, ms)">setTimeout(cb, ms)</a></li><li><a href=#cleartimeoutt aria-label=clearTimeout(t)>clearTimeout(t)</a></li><li><a href=#setintervalcb-ms aria-label="setInterval(cb, ms)">setInterval(cb, ms)</a></li><li><a href=#console aria-label=console>console</a></li><li><a href=#process aria-label=process>process</a></li><li><a href=#process-%e5%b1%9e%e6%80%a7 aria-label="Process 属性">Process 属性</a></li></ul></li><li><a href=#nodejs-mysql aria-label="🔭Node.js MySQL">🔭Node.js MySQL</a><ul><li><a href=#error-1045-28000-access-denied-for-user-rootlocalhost-using-password-yes aria-label="ERROR 1045 (28000): Access denied for user ‘root‘@‘localhost‘ (using password: YES)">ERROR 1045 (28000): Access denied for user ‘root‘@‘localhost‘ (using password: YES)</a></li><li><a href=#error-er_not_supported_auth_mode-client-does-not-support-authentication-protocol-requested aria-label="Error: ER_NOT_SUPPORTED_AUTH_MODE: Client does not support authentication protocol requested">Error: ER_NOT_SUPPORTED_AUTH_MODE: Client does not support authentication protocol requested</a></li></ul></li><li><a href=#nodejs-socket aria-label="🧵Node.js Socket">🧵Node.js Socket</a></li></ul></div></details></div><div class=post-content><p>简单的说 Node.js 就是运行在服务端的 JavaScript。</p><p>Node.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。</p><p>Node.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。</p><h1 id=nodejs安装>🛠Node.js安装<a hidden class=anchor aria-hidden=true href=#nodejs安装>#</a></h1><p>Node.js安装在上一篇文章Debian Node.js HEXO 有讲到</p><p>截至目前最新的版本是20.12.2</p><p>#查看版本
node -v
v20.12.2</p><p>win下可以在官网下载安装
<a href=https://nodejs.org/en/download>https://nodejs.org/en/download</a></p><h2 id=debian-nodejs>debian nodejs<a hidden class=anchor aria-hidden=true href=#debian-nodejs>#</a></h2><p>node 14版本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ apt-get update
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -fsSL https://deb.nodesource.com/setup_14.x | sudo -E bash -
</span></span></code></pre></div><p>#如果提示sudo 命令没有找到，一定要下载，执行apt-get install sudo -y 即可，然后再执行上述命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ apt-get install nodejs -y
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ node --version  //验证
</span></span></code></pre></div><p>当然如果需要安装<strong>node20</strong>版本，只需将上述命令替换为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
</span></span></code></pre></div><h1 id=helloworld>💬helloworld<a hidden class=anchor aria-hidden=true href=#helloworld>#</a></h1><p>hi.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;hello world node.js &#34;</span>) <span style=color:#75715e>// like javascript~ 
</span></span></span></code></pre></div><p>node hi.js
[20240504n11]</p><h1 id=nodejs-创建第一个应用>👩‍🏫Node.js 创建第一个应用<a hidden class=anchor aria-hidden=true href=#nodejs-创建第一个应用>#</a></h1><h2 id=require-指令>require 指令<a hidden class=anchor aria-hidden=true href=#require-指令>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;http&#34;</span>);
</span></span></code></pre></div><h2 id=创建服务器接收响应请求>创建服务器/接收响应请求<a hidden class=anchor aria-hidden=true href=#创建服务器接收响应请求>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;http&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>createServer</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 发送 HTTP 头部 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// HTTP 状态值: 200 : OK
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 内容类型: text/plain
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>writeHead</span>(<span style=color:#ae81ff>200</span>, {<span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;text/plain&#39;</span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 发送响应数据 &#34;Hello World&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>end</span>(<span style=color:#e6db74>&#39;Hello World\n&#39;</span>);
</span></span><span style=display:flex><span>}).<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>8888</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 终端打印如下信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Server running at http://127.0.0.1:1200/&#39;</span>);
</span></span></code></pre></div><h1 id=npm使用>🚀npm使用<a hidden class=anchor aria-hidden=true href=#npm使用>#</a></h1><p>npm 是包管理工具
允许用户从NPM服务器下载别人编写的第三方包到本地使用。
允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。
允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。</p><p>npm -v</p><p>如果你安装的是旧版本的 npm，可以很容易得通过 npm 命令来升级，命令如下：</p><p>$ sudo npm install npm -g
/usr/local/bin/npm -> /usr/local/lib/node_modules/npm/bin/npm-cli.js
<a href=mailto:npm@2.14.2>npm@2.14.2</a> /usr/local/lib/node_modules/npm
如果是 Window 系统使用以下命令即可：</p><p>npm install npm -g
使用淘宝镜像的命令：</p><p>npm install -g cnpm &ndash;registry=https://registry.npmmirror.com</p><h2 id=全局安装与本地安装>全局安装与本地安装<a hidden class=anchor aria-hidden=true href=#全局安装与本地安装>#</a></h2><p>npm 的包安装分为本地安装（local）、全局安装（global）两种，从敲的命令行来看，差别只是有没有-g而已，比如</p><p>npm install express # 本地安装
npm install express -g # 全局安装
如果出现以下错误：</p><p>npm err! Error: connect ECONNREFUSED 127.0.0.1:8087
解决办法为：</p><p>$ npm config set proxy null</p><h2 id=查看安装信息>查看安装信息<a hidden class=anchor aria-hidden=true href=#查看安装信息>#</a></h2><p>npm list</p><p>── <a href=mailto:express@4.19.2>express@4.19.2</a></p><p>npm list -g</p><p>使用package.json
-node_modules/express/package.json 内容：</p><p>Package.json 属性说明</p><p>name - 包名。</p><p>version - 包的版本号。</p><p>description - 包的描述。</p><p>homepage - 包的官网 url 。</p><p>author - 包的作者姓名。</p><p>contributors - 包的其他贡献者姓名。</p><p>dependencies - 依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module 目录下。</p><p>repository - 包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上。</p><p>main - main 字段指定了程序的主入口文件，require(&lsquo;moduleName&rsquo;) 就会加载这个文件。这个字段的默认值是模块根目录下面的 index.js。</p><p>keywords - 关键字</p><p>卸载</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm uninstall express
</span></span><span style=display:flex><span>npm ls
</span></span></code></pre></div><p>更新</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm update express
</span></span></code></pre></div><p>创建</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm init
</span></span></code></pre></div><p>This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.</p><p>See <code>npm help json</code> for definitive documentation on these fields
and exactly what they do.</p><p>Use <code>npm install &lt;pkg> --save</code> afterwards to install a package and
save it as a dependency in the package.json file.</p><p>Press ^C at any time to quit.
name: (node_modules) runoob # 模块名
version: (1.0.0)
description: Node.js 测试模块(<a href=https://www.runoob.com>www.runoob.com</a>) # 描述
entry point: (index.js)
test command: make test
git repository: <a href=https://github.com/runoob/runoob.git>https://github.com/runoob/runoob.git</a> # Github 地址</p><p>author:
license: (ISC)
About to write to ……/node_modules/package.json: # 生成地址</p><p>{
&ldquo;name&rdquo;: &ldquo;runoob&rdquo;,
&ldquo;version&rdquo;: &ldquo;1.0.0&rdquo;,
&ldquo;description&rdquo;: &ldquo;Node.js 测试模块(<a href=https://www.runoob.com>www.runoob.com</a>)&rdquo;,
……
}</p><p>Is this ok? (yes) yes</p><p>yes后会生成 package.json
npm adduser
Username: mcmohd
Password:
Email: (this IS public) <a href=mailto:mcmohd@gmail.com>mcmohd@gmail.com</a></p><p>发布
npm publish</p><p>就可以跟其他模块一样使用 npm 来安装</p><h1 id=nodejs-回调函数>🔭Node.js 回调函数<a hidden class=anchor aria-hidden=true href=#nodejs-回调函数>#</a></h1><p>Node.js 异步编程的直接体现就是回调。</p><p>异步编程依托于回调来实现，但不能说使用了回调后程序就异步化了。</p><p>回调函数在完成任务后就会被调用，Node 使用了大量的回调函数，Node 所有 API 都支持回调函数。</p><p>例如，我们可以一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I/O 操作。这就大大提高了 Node.js 的性能，可以处理大量的并发请求。</p><p>回调函数一般作为函数的最后一个参数出现：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>foo1</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>age</span>, <span style=color:#a6e22e>callback</span>) { }
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>foo2</span>(<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>callback1</span>, <span style=color:#a6e22e>callback2</span>) { }
</span></span></code></pre></div><h2 id=阻塞代码实例>阻塞代码实例<a hidden class=anchor aria-hidden=true href=#阻塞代码实例>#</a></h2><p>创建一个文件 x.txt ，内容如下：</p><p>hi hi hi</p><p>创建 main.js 文件, 代码如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#e6db74>&#39;x.txt&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行结束!&#34;</span>);
</span></span></code></pre></div><p>以上代码执行结果如下：</p><p>node main.js</p><p>hi hi hi</p><p>程序执行结束!</p><h2 id=非阻塞代码实例>非阻塞代码实例<a hidden class=anchor aria-hidden=true href=#非阻塞代码实例>#</a></h2><p>创建一个文件 input.txt ，内容如下：</p><p>菜鸟教程官网地址：www.runoob.com
创建 main.js 文件, 代码如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFile</span>(<span style=color:#e6db74>&#39;input.txt&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>err</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行结束!&#34;</span>);
</span></span></code></pre></div><p>以上代码执行结果如下：</p><p>node main.js</p><p>程序执行结束!
hi hi hi
以上两个实例我们了解了阻塞与非阻塞调用的不同。第一个实例在文件读取完后才执行程序。 第二个实例我们不需要等待文件读取完，这样就可以在读取文件时同时执行接下来的代码，大大提高了程序的性能。</p><p>因此，阻塞是按顺序执行的，而非阻塞是不需要按顺序的，所以如果需要处理回调函数的参数，我们就需要写在回调函数内。</p><h1 id=nodejs-事件循环>🐞Node.js 事件循环<a hidden class=anchor aria-hidden=true href=#nodejs-事件循环>#</a></h1><p>Node.js 是单进程单线程应用程序，但是因为 V8 引擎提供的异步执行回调接口，通过这些接口可以处理大量的并发，所以性能非常高。</p><p>Node.js 几乎每一个 API 都是支持回调函数的。</p><p>Node.js 基本上所有的事件机制都是用设计模式中观察者模式实现。</p><p>Node.js 单线程类似进入一个while(true)的事件循环，直到没有事件观察者退出，每个异步事件都生成一个事件观察者，如果有事件发生就调用该回调函数.</p><h2 id=事件驱动程序>事件驱动程序<a hidden class=anchor aria-hidden=true href=#事件驱动程序>#</a></h2><p>Node.js 使用事件驱动模型，当web server接收到请求，就把它关闭然后进行处理，然后去服务下一个web请求。</p><p>当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。</p><p>这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。（这也称之为非阻塞式IO或者事件驱动IO）</p><p>在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数。</p><p>EventEmitters -> Events =>&lt;= EventLoop -> Event Handlers</p><p>整个事件驱动的流程就是这么实现的，非常简洁。有点类似于观察者模式，事件相当于一个主题(Subject)，而所有注册到这个事件上的处理函数相当于观察者(Observer)。</p><p>Node.js 有多个内置的事件，我们可以通过引入 events 模块，并通过实例化 EventEmitter 类来绑定和监听事件，如下实例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 引入 events 模块
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>events</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;events&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建 eventEmitter 对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>eventEmitter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>events</span>.<span style=color:#a6e22e>EventEmitter</span>();
</span></span></code></pre></div><p>以下程序绑定事件处理程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 绑定事件及事件的处理程序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;eventName&#39;</span>, <span style=color:#a6e22e>eventHandler</span>);
</span></span></code></pre></div><p>我们可以通过程序触发事件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 触发事件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;eventName&#39;</span>);
</span></span></code></pre></div><p>main.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 引入 events 模块
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>events</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;events&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建 eventEmitter 对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>eventEmitter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>events</span>.<span style=color:#a6e22e>EventEmitter</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建事件处理程序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>connectHandler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>connected</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;连接成功。&#39;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 触发 data_received 事件 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;data_received&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 绑定 connection 事件处理程序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;connection&#39;</span>, <span style=color:#a6e22e>connectHandler</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用匿名函数绑定 data_received 事件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data_received&#39;</span>, <span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;数据接收成功。&#39;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 触发 connection 事件 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;connection&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行完毕。&#34;</span>);
</span></span></code></pre></div><p>connection -> connectHandler -> data_received</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-BASH data-lang=BASH><span style=display:flex><span>node main.js
</span></span><span style=display:flex><span>连接成功。
</span></span><span style=display:flex><span>数据接收成功。
</span></span><span style=display:flex><span>程序执行完毕。
</span></span></code></pre></div><h2 id=node-应用程序是如何工作的>Node 应用程序是如何工作的？<a hidden class=anchor aria-hidden=true href=#node-应用程序是如何工作的>#</a></h2><p>在 Node 应用程序中，执行异步操作的函数将回调函数作为最后一个参数， 回调函数接收错误对象作为第一个参数。</p><p>接下来让我们来重新看下前面的实例，创建一个 x.txt ,文件内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//main.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFile</span>(<span style=color:#e6db74>&#39;x.txt&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>stack</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行完毕&#34;</span>);
</span></span></code></pre></div><p>执行 则异步读取x.txt内容
把路劲改成 x1.txt读取错误则log 错误内容</p><h1 id=nodejs-eventemitter>📔Node.js EventEmitter<a hidden class=anchor aria-hidden=true href=#nodejs-eventemitter>#</a></h1><p>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列。</p><p>Node.js 里面的许多对象都会分发事件：一个 net.Server 对象会在每次有新连接时触发一个事件， 一个 fs.readStream 对象会在文件被打开的时候触发一个事件。 所有这些产生事件的对象都是 events.EventEmitter 的实例。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//main.js 文件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>EventEmitter</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;events&#39;</span>).<span style=color:#a6e22e>EventEmitter</span>; 
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>EventEmitter</span>(); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;some_event&#39;</span>, <span style=color:#66d9ef>function</span>() { 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;some_event 事件触发&#39;</span>); 
</span></span><span style=display:flex><span>}); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>setTimeout</span>(<span style=color:#66d9ef>function</span>() { 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;some_event&#39;</span>); 
</span></span><span style=display:flex><span>}, <span style=color:#ae81ff>10000</span>); 
</span></span></code></pre></div><p>10s后执行 some_event 输出 事件触发</p><p>EventEmitter 的每个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义。对于每个事件，EventEmitter 支持 若干个事件监听器。</p><p>当事件触发时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//main.js 文件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>events</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;events&#39;</span>); 
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>emitter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>events</span>.<span style=color:#a6e22e>EventEmitter</span>(); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>emitter</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;someEvent&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>arg1</span>, <span style=color:#a6e22e>arg2</span>) { 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;listener1&#39;</span>, <span style=color:#a6e22e>arg1</span>, <span style=color:#a6e22e>arg2</span>); 
</span></span><span style=display:flex><span>}); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>emitter</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;someEvent&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>arg1</span>, <span style=color:#a6e22e>arg2</span>) { 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;listener2&#39;</span>, <span style=color:#a6e22e>arg1</span>, <span style=color:#a6e22e>arg2</span>); 
</span></span><span style=display:flex><span>}); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>emitter</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;someEvent&#39;</span>, <span style=color:#e6db74>&#39;arg1 参数&#39;</span>, <span style=color:#e6db74>&#39;arg2 参数&#39;</span>); 
</span></span></code></pre></div><p>emitter 为事件 someEvent 注册了两个事件监听器，然后触发了 someEvent 事件。</p><p>运行结果中可以看到两个事件监听器回调函数被先后调用。 这就是EventEmitter最简单的用法。</p><p>EventEmitter 提供了多个属性，如 on 和 emit。on 函数用于绑定事件函数，emit 属性用于触发一个事件。接下来我们来具体看下 EventEmitter 的属性介绍。</p><p>.once 监听器最多只会触发一次，触发后立刻解除该监听器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>events</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;events&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>eventEmitter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>events</span>.<span style=color:#a6e22e>EventEmitter</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 监听器 #1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>listener1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>listener1</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;监听器 listener1 执行。&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 监听器 #2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>listener2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>listener2</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;监听器 listener2 执行。&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 绑定 connection 事件，处理函数为 listener1 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>addListener</span>(<span style=color:#e6db74>&#39;connection&#39;</span>, <span style=color:#a6e22e>listener1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 绑定 connection 事件，处理函数为 listener2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;connection&#39;</span>, <span style=color:#a6e22e>listener2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>eventListeners</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>listenerCount</span>(<span style=color:#e6db74>&#39;connection&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>eventListeners</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; 个监听器监听连接事件。&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 处理 connection 事件 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;connection&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 移除监绑定的 listener1 函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>removeListener</span>(<span style=color:#e6db74>&#39;connection&#39;</span>, <span style=color:#a6e22e>listener1</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;listener1 不再受监听。&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 触发连接事件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;connection&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>eventListeners</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>listenerCount</span>(<span style=color:#e6db74>&#39;connection&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>eventListeners</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; 个监听器监听连接事件。&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 绑定 connection 事件，处理函数为 listener2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;connection&#39;</span>, <span style=color:#a6e22e>listener2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;connection&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>eventListeners</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>eventEmitter</span>.<span style=color:#a6e22e>listenerCount</span>(<span style=color:#e6db74>&#39;connection&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>eventListeners</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; 个监听器监听连接事件。&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行完毕。&#34;</span>);
</span></span></code></pre></div><p>error 事件
EventEmitter 定义了一个特殊的事件 error，它包含了错误的语义，我们在遇到 异常的时候通常会触发 error 事件。</p><p>当 error 被触发时，EventEmitter 规定如果没有响 应的监听器，Node.js 会把它当作异常，退出程序并输出错误信息。</p><p>我们一般要为会触发 error 事件的对象设置监听器，避免遇到错误后整个程序崩溃。例如：</p><p>继承 EventEmitter
大多数时候我们不会直接使用 EventEmitter，而是在对象中继承它。包括 fs、net、 http 在内的，只要是支持事件响应的核心模块都是 EventEmitter 的子类。</p><p>为什么要这样做呢？原因有两点：</p><p>首先，具有某个实体功能的对象实现事件符合语义， 事件的监听和发生应该是一个对象的方法。</p><p>其次 JavaScript 的对象机制是基于原型的，支持 部分多重继承，继承 EventEmitter 不会打乱对象原有的继承关系。</p><h1 id=-nodejs-buffer>⛏ Node.js Buffer<a hidden class=anchor aria-hidden=true href=#-nodejs-buffer>#</a></h1><p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。</p><p>但在处理像TCP流或文件流时，必须使用到二进制数据。因此在 Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区。</p><p>在 Node.js 中，Buffer 类是随 Node 内核一起发布的核心库。Buffer 库为 Node.js 带来了一种存储原始数据的方法，可以让 Node.js 处理二进制数据，每当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库。原始数据存储在 Buffer 类的实例中。一个 Buffer 类似于一个整数数组，但它对应于 V8 堆内存之外的一块原始内存。</p><p>Buffer 与字符编码</p><p>Buffer 实例一般用于表示编码字符的序列，比如 UTF-8 、 UCS2 、 Base64 、或十六进制编码的数据。 通过使用显式的字符编码，就可以在 Buffer 实例与普通的 JavaScript 字符串之间进行相互转换。</p><p>Buffer.from() 创建对象</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>buf</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;test&#39;</span>, <span style=color:#e6db74>&#39;ascii&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出 72756e6f6f62
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;hex&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出 cnVub29i
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;base64&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//UTF-8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;UTF-8&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//ascii 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;ascii&#39;</span>));
</span></span><span style=display:flex><span>    <span style=color:#75715e>//utf16le
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;utf16le&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//latin1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;latin1&#39;</span>));
</span></span></code></pre></div><p>Node.js 目前支持的字符编码包括：</p><p>ascii - 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的。</p><p>utf8 - 多字节编码的 Unicode 字符。许多网页和其他文档格式都使用 UTF-8 。</p><p>utf16le - 2 或 4 个字节，小字节序编码的 Unicode 字符。支持代理对（U+10000 至 U+10FFFF）。</p><p>ucs2 - utf16le 的别名。</p><p>base64 - Base64 编码。</p><p>latin1 - 一种把 Buffer 编码成一字节编码的字符串的方式。</p><p>binary - latin1 的别名。</p><p>hex - 将每个字节编码为两个十六进制字符。</p><h2 id=创建-buffer-类>创建 Buffer 类<a hidden class=anchor aria-hidden=true href=#创建-buffer-类>#</a></h2><p>Buffer 提供了以下 API 来创建 Buffer 类：</p><p>Buffer.alloc(size[, fill[, encoding]])： 返回一个指定大小的 Buffer 实例，如果没有设置 fill，则默认填满 0
Buffer.allocUnsafe(size)： 返回一个指定大小的 Buffer 实例，但是它不会被初始化，所以它可能包含敏感的数据
Buffer.allocUnsafeSlow(size)
Buffer.from(array)： 返回一个被 array 的值初始化的新的 Buffer 实例（传入的 array 的元素只能是数字，不然就会自动被 0 覆盖）
Buffer.from(arrayBuffer[, byteOffset[, length]])： 返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer。
Buffer.from(buffer)： 复制传入的 Buffer 实例的数据，并返回一个新的 Buffer 实例
Buffer.from(string[, encoding])： 返回一个被 string 的值初始化的新的 Buffer 实例</p><h2 id=写入缓冲区>写入缓冲区<a hidden class=anchor aria-hidden=true href=#写入缓冲区>#</a></h2><p>语法
写入 Node 缓冲区的语法如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>write</span>(<span style=color:#a6e22e>string</span>[, <span style=color:#a6e22e>offset</span>[, <span style=color:#a6e22e>length</span>]][, <span style=color:#a6e22e>encoding</span>])
</span></span></code></pre></div><p>参数
参数描述如下：</p><p>string - 写入缓冲区的字符串。</p><p>offset - 缓冲区开始写入的索引值，默认为 0 。</p><p>length - 写入的字节数，默认为 buffer.length</p><p>encoding - 使用的编码。默认为 &lsquo;utf8&rsquo; 。</p><p>根据 encoding 的字符编码写入 string 到 buf 中的 offset 位置。 length 参数是写入的字节数。 如果 buf 没有足够的空间保存整个字符串，则只会写入 string 的一部分。 只部分解码的字符不会被写入。</p><p>返回值
返回实际写入的大小。如果 buffer 空间不足， 则只会写入部分字符串。</p><p>实例</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>alloc</span>(<span style=color:#ae81ff>256</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>len</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#34;123123&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;写入字节数 : &#34;</span><span style=color:#f92672>+</span>  <span style=color:#a6e22e>len</span>);
</span></span></code></pre></div><h2 id=从缓冲区读取数据>从缓冲区读取数据<a hidden class=anchor aria-hidden=true href=#从缓冲区读取数据>#</a></h2><p>语法
读取 Node 缓冲区数据的语法如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>([<span style=color:#a6e22e>encoding</span>[, <span style=color:#a6e22e>start</span>[, <span style=color:#a6e22e>end</span>]]])
</span></span></code></pre></div><p>参数
参数描述如下：</p><p>encoding - 使用的编码。默认为 &lsquo;utf8&rsquo; 。</p><p>start - 指定开始读取的索引位置，默认为 0。</p><p>end - 结束位置，默认为缓冲区的末尾。</p><p>返回值
解码缓冲区数据并使用指定的编码返回字符串。</p><p>实例</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>alloc</span>(<span style=color:#ae81ff>26</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> ; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>26</span> ; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>97</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;ascii&#39;</span>));       <span style=color:#75715e>// 输出: abcdefghijklmnopqrstuvwxyz
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;ascii&#39;</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>5</span>));   <span style=color:#75715e>//使用 &#39;ascii&#39; 编码, 并输出: abcde
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;utf8&#39;</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>5</span>));    <span style=color:#75715e>// 使用 &#39;utf8&#39; 编码, 并输出: abcde
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toString</span>(<span style=color:#66d9ef>undefined</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>5</span>)); <span style=color:#75715e>// 使用默认的 &#39;utf8&#39; 编码, 并输出: abcde
</span></span></span></code></pre></div><p>将 Buffer 转换为 JSON 对象
语法
将 Node Buffer 转换为 JSON 对象的函数语法格式如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>toJSON</span>()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>buf</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>([<span style=color:#ae81ff>0x1</span>, <span style=color:#ae81ff>0x2</span>, <span style=color:#ae81ff>0x3</span>, <span style=color:#ae81ff>0x4</span>, <span style=color:#ae81ff>0x5</span>]);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>json</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>buf</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出: {&#34;type&#34;:&#34;Buffer&#34;,&#34;data&#34;:[1,2,3,4,5]}
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>json</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>copy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>json</span>, (<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;Buffer&#39;</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>data</span>) <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出: &lt;Buffer 01 02 03 04 05&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>copy</span>);
</span></span></code></pre></div><h2 id=缓冲区合并>缓冲区合并<a hidden class=anchor aria-hidden=true href=#缓冲区合并>#</a></h2><p>语法
Node 缓冲区合并的语法如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>list</span>[, <span style=color:#a6e22e>totalLength</span>])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>((<span style=color:#e6db74>&#39;123&#39;</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>((<span style=color:#e6db74>&#39;test&#39;</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>concat</span>([<span style=color:#a6e22e>buffer1</span>,<span style=color:#a6e22e>buffer2</span>]);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;buffer3 内容: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>buffer3</span>.<span style=color:#a6e22e>toString</span>());
</span></span></code></pre></div><h2 id=缓冲区比较>缓冲区比较<a hidden class=anchor aria-hidden=true href=#缓冲区比较>#</a></h2><p>语法
Node Buffer 比较的函数语法如下所示, 该方法在 Node.js v0.12.2 版本引入：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>compare</span>(<span style=color:#a6e22e>otherBuffer</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;ABC&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;ABCD&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>buffer1</span>.<span style=color:#a6e22e>compare</span>(<span style=color:#a6e22e>buffer2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>result</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buffer1</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; 在 &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>buffer2</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;之前&#34;</span>);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>result</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buffer1</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; 与 &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>buffer2</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;相同&#34;</span>);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buffer1</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; 在 &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>buffer2</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;之后&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=拷贝缓冲区>拷贝缓冲区<a hidden class=anchor aria-hidden=true href=#拷贝缓冲区>#</a></h2><p>语法
Node 缓冲区拷贝语法如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>copy</span>(<span style=color:#a6e22e>targetBuffer</span>[, <span style=color:#a6e22e>targetStart</span>[, <span style=color:#a6e22e>sourceStart</span>[, <span style=color:#a6e22e>sourceEnd</span>]]])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buf1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;abcdefghijkl&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buf2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;123&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//将 buf2 插入到 buf1 指定位置上
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>buf2</span>.<span style=color:#a6e22e>copy</span>(<span style=color:#a6e22e>buf1</span>, <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buf1</span>.<span style=color:#a6e22e>toString</span>());
</span></span></code></pre></div><h2 id=缓冲区裁剪>缓冲区裁剪<a hidden class=anchor aria-hidden=true href=#缓冲区裁剪>#</a></h2><p>Node 缓冲区裁剪语法如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>slice</span>([<span style=color:#a6e22e>start</span>[, <span style=color:#a6e22e>end</span>]])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;TEST123TEST&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 剪切缓冲区
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>buffer1</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;buffer2 content: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>buffer2</span>.<span style=color:#a6e22e>toString</span>());
</span></span></code></pre></div><h2 id=缓冲区长度>缓冲区长度<a hidden class=anchor aria-hidden=true href=#缓冲区长度>#</a></h2><p>语法
Node 缓冲区长度计算语法如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;123123123&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//  缓冲区长度
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;buffer length: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>length</span>);
</span></span></code></pre></div><h1 id=nodejs-stream>👨‍💻Node.js Stream<a hidden class=anchor aria-hidden=true href=#nodejs-stream>#</a></h1><p>Node.js Stream(流)</p><p>Stream 是一个抽象接口，Node 中有很多对象实现了这个接口。例如，对http 服务器发起请求的request 对象就是一个 Stream，还有stdout（标准输出）。</p><p>Node.js，Stream 有四种流类型：</p><p>Readable - 可读操作。</p><p>Writable - 可写操作。</p><p>Duplex - 可读可写操作.</p><p>Transform - 操作被写入数据，然后读出结果。</p><p>所有的 Stream 对象都是 EventEmitter 的实例。常用的事件有：</p><p>data - 当有数据可读时触发。</p><p>end - 没有更多的数据可读时触发。</p><p>error - 在接收和写入过程中发生错误时触发。</p><p>finish - 所有数据已被写入到底层系统时触发。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建可读流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>readerStream</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createReadStream</span>(<span style=color:#e6db74>&#39;x.txt&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 设置编码为 utf8。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>readerStream</span>.<span style=color:#a6e22e>setEncoding</span>(<span style=color:#e6db74>&#39;UTF8&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 处理流事件 --&gt; data, end, and error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>readerStream</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>chunk</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>chunk</span>;
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readerStream</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;end&#39;</span>,<span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readerStream</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;error&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>stack</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行完毕&#34;</span>);
</span></span></code></pre></div><p>写入流</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dataw</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;w123w&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ws</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createWriteStream</span>(<span style=color:#e6db74>&#39;x.txt&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>ws</span>.<span style=color:#a6e22e>write</span>(<span style=color:#a6e22e>dataw</span>);    
</span></span><span style=display:flex><span><span style=color:#a6e22e>ws</span>.<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;数据写入成功！&#34;</span>);  
</span></span></code></pre></div><p>管道流
管道提供了一个输出流到输入流的机制。通常我们用于从一个流中获取数据并将数据传递到另外一个流中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建一个可读流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>readerStream</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createReadStream</span>(<span style=color:#e6db74>&#39;x.txt&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建一个可写流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>writerStream</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createWriteStream</span>(<span style=color:#e6db74>&#39;output.txt&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 管道读写操作
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>readerStream</span>.<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>writerStream</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行完毕&#34;</span>);
</span></span></code></pre></div><p>链式流
链式是通过连接输出流到另外一个流并创建多个流操作链的机制。链式流一般用于管道操作。</p><p>接下来我们就是用管道和链式来压缩和解压文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>zlib</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;zlib&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 压缩 input.txt 文件为 input.txt.gz
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createReadStream</span>(<span style=color:#e6db74>&#39;x.txt&#39;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>zlib</span>.<span style=color:#a6e22e>createGzip</span>())
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createWriteStream</span>(<span style=color:#e6db74>&#39;input.txt.gz&#39;</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;文件压缩完成。&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>zlib</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;zlib&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 解压 input.txt.gz 文件为 input.txt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createReadStream</span>(<span style=color:#e6db74>&#39;input.txt.gz&#39;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>zlib</span>.<span style=color:#a6e22e>createGunzip</span>())
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createWriteStream</span>(<span style=color:#e6db74>&#39;input2.txt&#39;</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;文件解压完成。&#34;</span>);
</span></span></code></pre></div><h1 id=nodejs-模块系统>📝Node.js 模块系统<a hidden class=anchor aria-hidden=true href=#nodejs-模块系统>#</a></h1><p>~~</p><p>为了让Node.js的文件可以相互调用，Node.js提供了一个简单的模块系统。</p><p>模块是Node.js 应用程序的基本组成部分，文件和模块是一一对应的。换言之，一个 Node.js 文件就是一个模块，这个文件可能是JavaScript 代码、JSON 或者编译过的C/C++ 扩展。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//hello.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>world1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;hello world node.js &#34;</span>) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//test.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>hello</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./hello&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>hello</span>.<span style=color:#a6e22e>world1</span>();
</span></span></code></pre></div><p>hello.js 通过 exports 对象把 world1 作为模块的访问接口，在 main.js 中通过 require(&rsquo;./hello&rsquo;) 加载这个模块，然后就可以直接访 问 hello.js 中 exports 对象的成员函数了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//hello.js 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Hello</span>() { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>name</span>; 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setName</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>thyName</span>) { 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>thyName</span>; 
</span></span><span style=display:flex><span>    }; 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sayHello</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() { 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Hello &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>name</span>); 
</span></span><span style=display:flex><span>    }; 
</span></span><span style=display:flex><span>}; 
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Hello</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//test.js 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>Hello</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./hello&#39;</span>); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>hello</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hello</span>(); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>hello</span>.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#39;vvv&#39;</span>); 
</span></span><span style=display:flex><span><span style=color:#a6e22e>hello</span>.<span style=color:#a6e22e>sayHello</span>(); 
</span></span></code></pre></div><p>模块接口的唯一变化是使用 module.exports = Hello 代替了exports.world = function(){}。 在外部引用该模块时，其接口对象就是要输出的 Hello 对象本身，而不是原先的 exports。</p><p>exports 和 module.exports 的使用</p><p>如果要对外暴露属性或方法，就用 exports 就行，要暴露对象(类似class，包含了很多属性和方法)，就用 module.exports。</p><p>PS 模块加载
从文件模块缓存中加载
尽管原生模块与文件模块的优先级不同，但是都会优先从文件模块的缓存中加载已经存在的模块。</p><p>从原生模块加载
原生模块的优先级仅次于文件模块缓存的优先级。require 方法在解析文件名之后，优先检查模块是否在原生模块列表中。以http模块为例，尽管在目录下存在一个 http/http.js/http.node/http.json 文件，require(&ldquo;http&rdquo;) 都不会从这些文件中加载，而是从原生模块中加载。</p><p>原生模块也有一个缓存区，同样也是优先从缓存区加载。如果缓存区没有被加载过，则调用原生模块的加载方式进行加载和执行。</p><p>从文件加载
当文件模块缓存中不存在，而且不是原生模块的时候，Node.js 会解析 require 方法传入的参数，并从文件系统中加载实际的文件，加载过程中的包装和编译细节在前一节中已经介绍过，这里我们将详细描述查找文件模块的过程，其中，也有一些细节值得知晓。</p><p>require方法接受以下几种参数的传递：</p><p>http、fs、path等，原生模块。
./mod或../mod，相对路径的文件模块。
/pathtomodule/mod，绝对路径的文件模块。
mod，非原生模块的文件模块。</p><h1 id=nodejs-加载c>🔄nodejs 加载c++<a hidden class=anchor aria-hidden=true href=#nodejs-加载c>#</a></h1><p>在Node.js中加载C++代码，通常是通过编写一个C++的扩展模块，然后通过Node.js的require方法加载这个模块。这可以通过Node.js的原生扩展模块API实现，也可以通过N-API实现，这是一个为构建可以在多个Node.js版本上工作的原生扩展模块而设计的API。</p><p>以下是一个简单的例子，展示如何创建一个C++扩展模块并在Node.js中使用它。</p><p>首先，你需要安装一个名为node-gyp的工具，这是一个用来编译C++扩展模块的工具：</p><p>npm install -g node-gyp
然后，创建一个名为binding.gyp的文件，它描述了如何构建扩展模块：</p><pre tabindex=0><code class=language-gyp data-lang=gyp>{
  &#34;targets&#34;: [
    {
      &#34;target_name&#34;: &#34;addon&#34;,
      &#34;sources&#34;: [ &#34;addon.cc&#34; ]
    }
  ]
}
</code></pre><p>接下来，创建一个C++源文件，例如addon.cc，它包含了你的C++代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;node.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> demo {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> v8<span style=color:#f92672>::</span>FunctionCallbackInfo;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> v8<span style=color:#f92672>::</span>Isolate;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> v8<span style=color:#f92672>::</span>Local;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> v8<span style=color:#f92672>::</span>NewStringType;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> v8<span style=color:#f92672>::</span>Object;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> v8<span style=color:#f92672>::</span>String;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> v8<span style=color:#f92672>::</span>Value;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>Method</span>(<span style=color:#66d9ef>const</span> FunctionCallbackInfo<span style=color:#f92672>&lt;</span>Value<span style=color:#f92672>&gt;&amp;</span> args) {
</span></span><span style=display:flex><span>  Isolate<span style=color:#f92672>*</span> isolate <span style=color:#f92672>=</span> args.GetIsolate();
</span></span><span style=display:flex><span>  args.GetReturnValue().Set(String<span style=color:#f92672>::</span>NewFromUtf8(isolate, <span style=color:#e6db74>&#34;world&#34;</span>, NewStringType<span style=color:#f92672>::</span>kNormal).ToLocalChecked());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>Initialize</span>(Local<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> exports) {
</span></span><span style=display:flex><span>  NODE_SET_METHOD(exports, <span style=color:#e6db74>&#34;hello&#34;</span>, Method);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NODE_MODULE(NODE_GYP_MODULE_NAME, Initialize)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}  <span style=color:#75715e>// namespace demo
</span></span></span></code></pre></div><p>确保在binding.gyp文件的同一目录下，运行以下命令来构建扩展模块：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>node-gyp configure build
</span></span></code></pre></div><p>这将生成一个编译好的扩展模块，你可以在Node.js中通过require来加载并使用它：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>addon</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./build/Release/addon.node&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>addon</span>.<span style=color:#a6e22e>hello</span>());  <span style=color:#75715e>// 输出: world
</span></span></span></code></pre></div><p>在这个例子中，C++模块导出了一个名为hello的方法，当在Node.js中调用这个方法时，它返回字符串"world"。</p><h1 id=nodejs-函数>🙋‍♀️Node.js 函数<a hidden class=anchor aria-hidden=true href=#nodejs-函数>#</a></h1><p>在 JavaScript中，一个函数可以作为另一个函数的参数。我们可以先定义一个函数，然后传递，也可以在传递参数的地方直接定义函数。</p><p>Node.js 中函数的使用与 JavaScript 类似，举例来说，你可以这样做：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>say</span>(<span style=color:#a6e22e>word</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>word</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>someFunction</span>, <span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>someFunction</span>(<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>say</span>, <span style=color:#e6db74>&#34;Hello&#34;</span>);
</span></span></code></pre></div><p>以上代码中，我们把 say 函数作为 execute 函数的第一个变量进行了传递。这里传递的不是 say 的返回值，而是 say 本身！</p><p>这样一来， say 就变成了execute 中的本地变量 someFunction ，execute 可以通过调用 someFunction() （带括号的形式）来使用 say 函数。</p><p>当然，因为 say 有一个变量， execute 在调用 someFunction 时可以传递这样一个变量。</p><h2 id=匿名函数>匿名函数<a hidden class=anchor aria-hidden=true href=#匿名函数>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>someFunction</span>, <span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>someFunction</span>(<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>execute</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>word</span>){ <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>word</span>) }, <span style=color:#e6db74>&#34;Hello&#34;</span>);
</span></span></code></pre></div><p>传递</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;http&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onRequest</span>(<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>writeHead</span>(<span style=color:#ae81ff>200</span>, {<span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text/plain&#34;</span>});
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#34;Hello World&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>createServer</span>(<span style=color:#a6e22e>onRequest</span>).<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>8888</span>);
</span></span></code></pre></div><p>==></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;http&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>createServer</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>writeHead</span>(<span style=color:#ae81ff>200</span>, {<span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text/plain&#34;</span>});
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#34;Hello World&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span>}).<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>8888</span>);
</span></span></code></pre></div><h1 id=nodejs-箭头函数>🙋‍♂Node.js 箭头函数<a hidden class=anchor aria-hidden=true href=#nodejs-箭头函数>#</a></h1><p>在Node.js中，箭头函数是一种简洁写法，用于声明匿名函数。它们最常用于回调函数和事件监听器等场景。箭头函数的语法很简单，它的基本格式如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>(<span style=color:#a6e22e>param1</span>, <span style=color:#a6e22e>param2</span>, ...) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 函数体
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>something</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>numbers</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>doubled</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>numbers</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>number</span> =&gt; <span style=color:#a6e22e>number</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>doubled</span>); <span style=color:#75715e>// 输出: [2, 4, 6, 8, 10]
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>setTimeout</span>(() =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;hihihi.&#39;</span>);
</span></span><span style=display:flex><span>}, <span style=color:#ae81ff>2000</span>);
</span></span></code></pre></div><p>以上决策图看起来有点复杂，我认为有三点比较重要：</p><p>箭头函数适合于无复杂逻辑或者无副作用的纯函数场景下，例如用在 map 、 reduce 、 filter 的回调函数定义中；
不要在最外层定义箭头函数，因为在函数内部操作 this 会很容易污染全局作用域。最起码在箭头函数外部包一层普通函数，将 this 控制在可见的范围内；
如开头所述，箭头函数最吸引人的地方是简洁。在有多层函数嵌套的情况下，箭头函数的简洁性并没有很大的提升，反而影响了函数的作用范围的识别度，这种情况不建议使用箭头函数。</p><h1 id=nodejs-路由>🧪Node.js 路由<a hidden class=anchor aria-hidden=true href=#nodejs-路由>#</a></h1><p>在 Node.js 中，路由（Routing）是指确定如何响应对特定端点（URL 路径）的 HTTP 请求的过程。</p><p>我们要为路由提供请求的 URL 和其他需要的 GET 及 POST 参数，随后路由需要根据这些数据来执行相应的代码。</p><p>因此，我们需要查看 HTTP 请求，从中提取出请求的 URL 以及 GET/POST 参数。这一功能应当属于路由还是服务器（甚至作为一个模块自身的功能）确实值得探讨，但这里暂定其为我们的HTTP服务器的功能。</p><p>我们需要的所有数据都会包含在 request 对象中，该对象作为 onRequest() 回调函数的第一个参数传递。但是为了解析这些数据，我们需要额外的 Node.JS 模块，它们分别是 url 和 querystring 模块。</p><pre><code>                url.parse(string).query
                                        |
        url.parse(string).pathname      |
                    |                   |
                    |                   |
                  ++++++ ++++++++++++++++++-
</code></pre><p>http://localhost:8888/start?foo=bar&amp;hello=world
+++ +++&ndash;
| |
| |
querystring.parse(queryString)[&ldquo;foo&rdquo;] |
|
querystring.parse(queryString)[&ldquo;hello&rdquo;]
现在我们来给 onRequest() 函数加上一些逻辑，用来找出浏览器请求的 URL 路径：</p><p>router.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>route</span>(<span style=color:#a6e22e>pathname</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;About to route a request for &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>pathname</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>route</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>route</span>;
</span></span></code></pre></div><p>server.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;http&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;url&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>start</span>(<span style=color:#a6e22e>route</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onRequest</span>(<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>url</span>).<span style=color:#a6e22e>pathname</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Request for &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>pathname</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; received.&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>route</span>(<span style=color:#a6e22e>pathname</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>writeHead</span>(<span style=color:#ae81ff>200</span>, {<span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text/plain&#34;</span>});
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#34;Hello World&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>createServer</span>(<span style=color:#a6e22e>onRequest</span>).<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>8888</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Server has started.&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>start</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>start</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//test.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;./server&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;./router&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>start</span>(<span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>route</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>node  test.js 
</span></span></code></pre></div><h1 id=nodejs-全局对象>🙏Node.js 全局对象<a hidden class=anchor aria-hidden=true href=#nodejs-全局对象>#</a></h1><p>javaScript 中有一个特殊的对象，称为全局对象（Global Object），它及其所有属性都可以在程序的任何地方访问，即全局变量。</p><p>在浏览器 JavaScript 中，通常 window 是全局对象， 而 Node.js 中的全局对象是 global，所有全局变量（除了 global 本身以外）都是 global 对象的属性。</p><p>在 Node.js 我们可以直接访问到 global 的属性，而不需要在应用中包含它。</p><p>全局对象与全局变量
global 最根本的作用是作为全局变量的宿主。按照 ECMAScript 的定义，满足以下条 件的变量是全局变量：</p><p>在最外层定义的变量；
全局对象的属性；
隐式定义的变量（未定义直接赋值的变量）。
当你定义一个全局变量时，这个变量同时也会成为全局对象的属性，反之亦然。需要注 意的是，在 Node.js 中你不可能在最外层定义变量，因为所有用户代码都是属于当前模块的， 而模块本身不是最外层上下文。</p><p>注意： 最好不要使用 var 定义变量以避免引入全局变量，因为全局变量会污染命名空间，提高代码的耦合风险。</p><h2 id=__filename>__filename<a hidden class=anchor aria-hidden=true href=#__filename>#</a></h2><p>__filename 表示当前正在执行的脚本的文件名。它将输出文件所在位置的绝对路径，且和命令行参数所指定的文件名不一定相同。 如果在模块中，返回的值是模块文件的路径。</p><h2 id=__dirname>__dirname<a hidden class=anchor aria-hidden=true href=#__dirname>#</a></h2><p>__dirname 表示当前执行脚本所在的目录。</p><h2 id=settimeoutcb-ms>setTimeout(cb, ms)<a hidden class=anchor aria-hidden=true href=#settimeoutcb-ms>#</a></h2><p>setTimeout(cb, ms) 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。：setTimeout() 只执行一次指定函数。</p><h2 id=cleartimeoutt>clearTimeout(t)<a hidden class=anchor aria-hidden=true href=#cleartimeoutt>#</a></h2><p>clearTimeout( t ) 全局函数用于停止一个之前通过 setTimeout() 创建的定时器。 参数 t 是通过 setTimeout() 函数创建的定时器。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>printHello</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#e6db74>&#34;Hello, World!&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 两秒后执行以上函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>t</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>printHello</span>, <span style=color:#ae81ff>2000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 清除定时器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>clearTimeout</span>(<span style=color:#a6e22e>t</span>);
</span></span></code></pre></div><p>执行 main.js 文件，代码如下所示:</p><h2 id=setintervalcb-ms>setInterval(cb, ms)<a hidden class=anchor aria-hidden=true href=#setintervalcb-ms>#</a></h2><p>setInterval(cb, ms) 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。</p><p>返回一个代表定时器的句柄值。可以使用 clearInterval(t) 函数来清除定时器。</p><p>setInterval() 方法会不停地调用函数，直到 clearInterval() 被调用或窗口被关闭。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>printHello</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#e6db74>&#34;Hello, World!&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 两秒后执行以上函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>setInterval</span>(<span style=color:#a6e22e>printHello</span>, <span style=color:#ae81ff>2000</span>);
</span></span></code></pre></div><h2 id=console>console<a hidden class=anchor aria-hidden=true href=#console>#</a></h2><p>console 用于提供控制台标准输出，它是由 Internet Explorer 的 JScript 引擎提供的调试工具，后来逐渐成为浏览器的实施标准。</p><pre><code>console.log
console.info
console.error
console.warn
</code></pre><p>console.time(label)
输出时间，表示计时开始。
console.timeEnd(label)
结束时间，表示计时结束。
console.trace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;程序开始执行：&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>counter</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;计数: %d&#34;</span>, <span style=color:#a6e22e>counter</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>time</span>(<span style=color:#e6db74>&#34;获取数据&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>  )
</span></span><span style=display:flex><span>{}
</span></span><span style=display:flex><span><span style=color:#75715e>// 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>timeEnd</span>(<span style=color:#e6db74>&#39;获取数据&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;程序执行完毕。&#34;</span>)
</span></span></code></pre></div><h2 id=process>process<a hidden class=anchor aria-hidden=true href=#process>#</a></h2><p>process 是一个全局变量，即 global 对象的属性。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;exit&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>code</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 以下代码永远不会执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>setTimeout</span>(<span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;该代码不会执行&#34;</span>);
</span></span><span style=display:flex><span>  }, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;退出码为:&#39;</span>, <span style=color:#a6e22e>code</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;程序执行结束&#34;</span>);
</span></span></code></pre></div><h2 id=process-属性>Process 属性<a hidden class=anchor aria-hidden=true href=#process-属性>#</a></h2><p>Process 提供了很多有用的属性，便于我们更好的控制系统的交互</p><pre><code>stdout
</code></pre><p>标准输出流
stderr
标准错误流。
stdin
标准输入流。
argv
argv 属性返回一个数组，由命令行执行脚本时的各个参数组成。它的第一个成员总是node，第二个成员是脚本文件名，其余成员是脚本文件的参数。
execPath
返回执行当前脚本的 Node 二进制文件的绝对路径。
execArgv
返回一个数组，成员是命令行下执行脚本时，在Node可执行文件与脚本文件之间的命令行参数。
env
返回一个对象，成员为当前 shell 的环境变量
exitCode
进程退出时的代码，如果进程优通过 process.exit() 退出，不需要指定退出码。
version
Node 的版本，比如v0.10.18
config
一个包含用来编译当前 node 执行文件的 javascript 配置选项的对象。它与运行 ./configure 脚本生成的 &ldquo;config.gypi&rdquo; 文件相同。
pid
当前进程的进程号。
title
进程名，默认值为"node"，可以自定义该值。
platform
运行程序所在的平台系统 &lsquo;darwin&rsquo;, &lsquo;freebsd&rsquo;, &rsquo;linux&rsquo;, &lsquo;sunos&rsquo; 或 &lsquo;win32&rsquo;
arch
当前 CPU 的架构：&lsquo;arm&rsquo;、&lsquo;ia32&rsquo; 或者 &lsquo;x64&rsquo;。
mainModule
require.main 的备选方法。不同点，如果主模块在运行时改变，require.main可能会继续返回老的模块。可以认为，这两者引用了同一个模块。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 输出到终端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>stdout</span>.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#34;Hello World!&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;\n&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 通过参数读取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>argv</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>val</span>, <span style=color:#a6e22e>index</span>, <span style=color:#a6e22e>array</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>index</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>val</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取执行路径
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>execPath</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 平台信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>platform</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出当前目录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;当前目录: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>cwd</span>());
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出当前版本
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;当前版本: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>version</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// 输出内存使用情况
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>memoryUsage</span>());
</span></span></code></pre></div><h1 id=nodejs-mysql>🔭Node.js MySQL<a hidden class=anchor aria-hidden=true href=#nodejs-mysql>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install mysql
</span></span></code></pre></div><p>select</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>mysql</span>  <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;mysql&#39;</span>);  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>connection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql</span>.<span style=color:#a6e22e>createConnection</span>({     
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>host</span>     <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;localhost&#39;</span>,       
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>user</span>     <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;root&#39;</span>,              
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>password</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;123456789&#39;</span>,   <span style=color:#75715e>//pwd  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;30306&#39;</span>,                   
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>database</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;IMDB&#39;</span> 
</span></span><span style=display:flex><span>}); 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>connect</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span>  <span style=color:#a6e22e>sql</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SELECT * FROM IMConfig;&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>sql</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//查
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>query</span>(<span style=color:#a6e22e>sql</span>,<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>err</span>){
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[SELECT ERROR] - &#39;</span>,<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;++++++++++++++++++++++++--SELECT+++++++++++++++++++++++++++-&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n\n&#39;</span>);  
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>end</span>();
</span></span></code></pre></div><h2 id=error-1045-28000-access-denied-for-user-rootlocalhost-using-password-yes>ERROR 1045 (28000): Access denied for user ‘root‘@‘localhost‘ (using password: YES)<a hidden class=anchor aria-hidden=true href=#error-1045-28000-access-denied-for-user-rootlocalhost-using-password-yes>#</a></h2><p>这边是通过docker安装的mysql，登录报错
root@f4a3881e5f06:/# mysql -uroot -p<br>Enter password: 123456
ERROR 1045 (28000): Access denied for user &lsquo;root&rsquo;@&rsquo;localhost&rsquo; (using password: YES)</p><p>如果常规的命令 mysql -uroot -p无法登录，使用命令尝试：</p><p>mysql -u root -h 127.0.0.1 -p</p><h2 id=error-er_not_supported_auth_mode-client-does-not-support-authentication-protocol-requested>Error: ER_NOT_SUPPORTED_AUTH_MODE: Client does not support authentication protocol requested<a hidden class=anchor aria-hidden=true href=#error-er_not_supported_auth_mode-client-does-not-support-authentication-protocol-requested>#</a></h2><p>mysql -u root -p
ALTER USER &lsquo;root&rsquo;@&rsquo;%&rsquo; IDENTIFIED WITH mysql_native_password BY &lsquo;123456789&rsquo;;
flush privileges;</p><p>insert</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>connect</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span>  <span style=color:#a6e22e>addSql</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;INSERT INTO IMConfig(ConfigID,UserID,ConfigName,ConfigCreateTime,ConfigType,ConfigSn) VALUES(0,?,?,?,?,?)&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span>  <span style=color:#a6e22e>addSqlParams</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;11&#39;</span>,<span style=color:#e6db74>&#39;2023-01-01&#39;</span>, <span style=color:#e6db74>&#39;1&#39;</span>,<span style=color:#e6db74>&#39;1&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#75715e>//增
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>query</span>(<span style=color:#a6e22e>addSql</span>,<span style=color:#a6e22e>addSqlParams</span>,<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>err</span>){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[INSERT ERROR] - &#39;</span>,<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }        
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;++++++++++++++++++++++++--INSERT+++++++++++++++++++++++++++-&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#75715e>//console.log(&#39;INSERT ID:&#39;,result.insertId);        
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;INSERT ID:&#39;</span>,<span style=color:#a6e22e>result</span>);        
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--\n\n&#39;</span>);  
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>end</span>();
</span></span></code></pre></div><p>ER_NO_SUCH_TABLE: Table &lsquo;IMDB.IMCONFIG&rsquo; doesn&rsquo;t exist
中英文错误
ER_WRONG_VALUE_COUNT_ON_ROW: Column count doesn&rsquo;t match value count at row 1
字段错误
ER_TRUNCATED_WRONG_VALUE: Incorrect datetime value: &lsquo;2023-01-01T16:00:00.000Z&rsquo; for column &lsquo;ConfigCreateTime&rsquo; at row 1
字段类型</p><p>update</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//update 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>connect</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>modSql</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE IMConfig SET ConfigName = ?,ConfigType = ?,ConfigSn = ? WHERE ConfigId = ?&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>modSqlParams</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;lang&#39;</span>, <span style=color:#e6db74>&#39;2&#39;</span>,<span style=color:#e6db74>&#39;1&#39;</span>,<span style=color:#ae81ff>5</span>];
</span></span><span style=display:flex><span><span style=color:#75715e>//改
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>query</span>(<span style=color:#a6e22e>modSql</span>,<span style=color:#a6e22e>modSqlParams</span>,<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>err</span>){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[UPDATE ERROR] - &#39;</span>,<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }        
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;++++++++++++++++++++++++--UPDATE+++++++++++++++++++++++++++-&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;UPDATE affectedRows&#39;</span>,<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>affectedRows</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--\n\n&#39;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>end</span>();
</span></span></code></pre></div><p>delete</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>connect</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>delSql</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DELETE FROM IMConfig where ConfigID=5&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>//删
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>query</span>(<span style=color:#a6e22e>delSql</span>,<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>err</span>){
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;[DELETE ERROR] - &#39;</span>,<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }        
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;++++++++++++++++++++++++--DELETE+++++++++++++++++++++++++++-&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;DELETE affectedRows&#39;</span>,<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>affectedRows</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--\n\n&#39;</span>);  
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>end</span>();
</span></span></code></pre></div><h1 id=nodejs-socket>🧵Node.js Socket<a hidden class=anchor aria-hidden=true href=#nodejs-socket>#</a></h1><p>socket client</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//sk
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>net</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;net&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;6001&#39;</span>, <span style=color:#e6db74>&#39;xxxx&#39;</span>, <span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;已经与服务器连接&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39;Yes\r\n&#39;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>end</span>();<span style=color:#75715e>//one msg end
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;end&#39;</span>, <span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;客户端连接中断&#39;</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://qfsyso.github.io/tags/node/>Node</a></li><li><a href=https://qfsyso.github.io/tags/helloworld/>Helloworld</a></li><li><a href=https://qfsyso.github.io/tags/buffer/>Buffer</a></li><li><a href=https://qfsyso.github.io/tags/stream/>Stream</a></li><li><a href=https://qfsyso.github.io/tags/c++/>C++</a></li><li><a href=https://qfsyso.github.io/tags/router/>Router</a></li><li><a href=https://qfsyso.github.io/tags/mysql/>MySQL</a></li><li><a href=https://qfsyso.github.io/tags/socket/>Socket</a></li></ul><nav class=paginav><a class=prev href=https://qfsyso.github.io/posts/nodejs-study/><span class=title>« Prev</span><br><span>Nodejs Study</span>
</a><a class=next href=https://qfsyso.github.io/posts/harmonyos-photos-column-swiper-grid/><span class=title>Next »</span><br><span>HarmonyOS Photos Column Swiper Grid</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs base on x" href="https://x.com/intent/tweet/?text=Nodejs%20base&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f&amp;hashtags=Node%2cHelloworld%2cBuffer%2cStream%2cC%2b%2b%2cRouter%2cMySQL%2cSocket"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs base on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f&amp;title=Nodejs%20base&amp;summary=Nodejs%20base&amp;source=https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs base on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f&title=Nodejs%20base"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs base on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs base on whatsapp" href="https://api.whatsapp.com/send?text=Nodejs%20base%20-%20https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs base on telegram" href="https://telegram.me/share/url?text=Nodejs%20base&amp;url=https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs base on ycombinator" href="https://news.ycombinator.com/submitlink?t=Nodejs%20base&u=https%3a%2f%2fqfsyso.github.io%2fposts%2fnodejs-base%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><div class=wtime><div class=wtime2>CST<span id=beijingTime></span> GMT <span id=londonTime></span> EST <span id=newYorkTime></span> PST<span id=losAngelesTime></span></div><div class=wtime2 style=display:none>东京<span id=tokyoTime></span></div><div class=wtime2 style=display:none>欧洲-巴黎<span id=parisTime></span></div><div class=wtime2 style=display:none>UTC<span id=utcTime></span></div></div><span>&copy; 2025 <a href=https://qfsyso.github.io/>MLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><script type=text/javascript>const timeZoneOffsets={beijing:8,tokyo:9,paris:[1,2],london:[0,1],newYork:[-5,-4],losAngeles:[-8,-7]};function padZero(e){return e<10?"0"+e:e}function formatTime(e){const t=e.getFullYear(),n=padZero(e.getMonth()+1),s=padZero(e.getDate()),o=padZero(e.getHours()),i=padZero(e.getMinutes()),a=padZero(e.getSeconds());return`${t}-${n}-${s} ${o}:${i}:${a}`}function isDaylightSavingTime(e,t){const o=e.getMonth(),n=new Date(e.getFullYear(),3,8,2,0,0),s=new Date(e.getFullYear(),10,1,2,0,0);return(t==="paris"||t==="london"||t==="newYork"||t==="losAngeles")&&e>=n&&e<s}function updateTime(){const e=new Date,t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),n=formatTime(t);document.getElementById("utcTime").innerHTML=n;for(const n in timeZoneOffsets){const e=timeZoneOffsets[n];let s;Array.isArray(e)?s=isDaylightSavingTime(t,n)?e[1]:e[0]:s=e;const o=new Date(t.getTime()+s*60*60*1e3);document.getElementById(n+"Time").innerHTML=formatTime(o)}setTimeout(updateTime,1e3)}window.onload=function(){updateTime()};function notfound(e){var n=e.src,t=n.split("/"),s=t[t.length-1];e.src="https://47.115.223.75:8080/group1/v2/"+s+"?timestamp="+Date.now(),e.onerror=null}</script></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>